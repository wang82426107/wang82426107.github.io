<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>骚栋の博客</title>
  <meta name="author" content="神经骚栋">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="骚栋の博客"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="骚栋の博客" type="application/atom+xml">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<link rel="stylesheet" href="/css/style.css">
  <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-368771XX-X']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>

<body>
  <header id="header" class='normal_mode'>
    <nav id="main-nav">
  <ul class='container'>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
  </header>
  <div id="content" class="container">
    <div id="cover">
	<div id="profile" alt="http://ww1.sinaimg.cn/large/6cea169fjw1edgyzma1xcj21kw16ohba.jpg">
		<a href="/">
			<div class="logo">
				<img src="/logo.png" alt="Profile Picture">
			</div>
			<div id="title">骚栋の博客</div>
		</a>

		
		 <ul class="my-socials">
  
  <li>
  	<a href="https://github.com/your_id" class="github" target="_blank">
  		<i class="fa fa-github"></i>
  	</a>
  </li>
  
  <li>
  	<a href="http://weibo.com/your_id" class="weibo" target="_blank">
  		<i class="fa fa-weibo"></i>
  	</a>
  </li>
  
 
</ul>
	</div>
</div>


  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2016-03-07T09:16:47.000Z"><a href="/2016/03/07/华山论剑之Apple Pay/">週一, 3月 7 2016, 5:16:47 下午</a></time>

  
    <h1 class="title"><a href="/2016/03/07/华山论剑之Apple Pay/">华山论剑之Apple Pay</a></h1>
  



<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <blockquote>
<p>####如果你恨他,就让他舔门口的棒棒糖 ———-军哥</p>
</blockquote>
<hr>
<p>#####在发布近两年、历经各种周折之后，苹果公司的Apple Pay移动支付服务终于在2016年2月18日来到了中国大陆.对中国用户来说，移动支付其实已经不是什么陌生事物，抢红包和支付宝早完成用户启蒙。但与这两者有区别的是，Apple Pay只是苹果搭建的一个支付服务，它链接银行、店面及用户，但又不像支付宝那样把钱存在自己这。</p>
<p>#####对于技术人员的我们,不管其市场如何,当我们看到一个新的技术的时候,我们就应该想着如何去使用它,今天作为前端开发者的我就对ApplePay进行一个简单的讲解.<br><br></p>
<p>###商业证书的配置<br></p>
<p>#####当我们使用到ApplePay的时候,首先就是要到我们的开发者中心配置一个证书,这个证书就叫做商业证书,下面我们就看一下商业证书配置的相关问题吧.</p>
<p>#####首相我们进入到我们证书页面,当我们进入我们的证书页面之后,首先我们需要如图添加一个商业证书.<br><img src="http://upload-images.jianshu.io/upload_images/1396375-cc4d3625df18ee16.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####进入到下面的页面的时候,我们要填写我们的类型名称以及我们的ID,根据要求填写即可.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1396375-44c5a0583b5fbd5f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####完成之后点击一下,进入如下的页面<br><img src="http://upload-images.jianshu.io/upload_images/1396375-51e948dd0fa5e3a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####当然了这样我们并没有配置完成.点击register 注册,然后返回到上一页面.如图 找到我们所配置的文件.然后我们就要对我们的证书进行进一步的配置😁,<br><img src="http://upload-images.jianshu.io/upload_images/1396375-6642aac5f65deccd.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####点击Edit进入详情页面<br><img src="http://upload-images.jianshu.io/upload_images/1396375-c92b49d4751bf8ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####不解释,直接点击下一步就可.<br><img src="http://upload-images.jianshu.io/upload_images/1396375-15ec1cab657fd7b5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####点击下一步之后我们进入如下的页面,这时候跟我们配置证书一个,我们需要从钥匙串中配置一个申请文件出来.<br><img src="http://upload-images.jianshu.io/upload_images/1396375-995d1870f7ae1af9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####首先先打开我们的钥匙串🔑,如下图进行下一步.点击”证书助理”,然后点击 “从证书颁发机构请求而证书”.<br><img src="http://upload-images.jianshu.io/upload_images/1396375-c91c8cb401a32f1a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####然后进行如下图的的操作,电子邮箱可以填写的稍微随意一点,😃</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1396375-2cf92d87cd20dcf8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####填写完整之后,我们点击继续即可,然后我们就需要上传我们的证书请求文件了.<br><img src="http://upload-images.jianshu.io/upload_images/1396375-183d2adb2e4b634e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####完成之后,就点击下载我们的商业证书就行.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1396375-adb799b103718ecf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####证书配置完了,就要配置我们App ID 和 工程的描述文件.我们首先配置一下App ID,App ID的配置和前面的差不多,唯一的区别就是我们需要勾选Apply Pay功能. 如图所示<br><img src="http://upload-images.jianshu.io/upload_images/1396375-9996ce478e8f559c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####当我们点击下一步的时候,发现Apply Pay 的状态是黄色的,所以我们就需要把他变成可用状态.<br><img src="http://upload-images.jianshu.io/upload_images/1396375-5264de08fed22d62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####我们点击Regiser注册完成之后,就在我们的APP ID列表中找到对应的APP ID信息.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1396375-21fb2c34caec1ad1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####如图,找到对应的Apply Pay 信息</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1396375-361c8467e728a8c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####进入选择证书的页面,选择我们的证书.<br><img src="http://upload-images.jianshu.io/upload_images/1396375-f03b55bc7ddc9b86.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####看完下面三张图  我们的App ID  的配置就完成了.<br><img src="http://upload-images.jianshu.io/upload_images/1396375-4ff8c9d3aa7a711c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1396375-93c27251f64eeb36.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1396375-6f7c25271b2377e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<hr>
<p></p>
<p>#描述文件</p>
<hr>
<p>####上面的App ID  我们已经配置完成了,下面我们就配置我们的 描述文件.<br><img src="http://upload-images.jianshu.io/upload_images/1396375-144a5f326cd08cf0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####选择对应的ID<br><img src="http://upload-images.jianshu.io/upload_images/1396375-12542bc5025e674c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####完成之后下载我们的描述文件就行.<br><img src="http://upload-images.jianshu.io/upload_images/1396375-ed82ebb0d938090d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>###注意:这里有个问题是关于证书的,就是我们的证书不管怎么下载都会显示的状态是证书是无效的或者证书是未知机构颁发的. 我们需要做的就是去网上下两个证书. 如图所示</p>
</blockquote>
<hr>
<p>####<a href="http://www.apple.com/certificateauthority/" target="_blank" rel="external">—-&gt;点击前往证书下载页面</a></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1396375-a8689aaf100166b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<hr>
<p><br></p>
<p>##工程配置</p>
<p>####当我们完成了我们的证书的配置之后,我们就需要到我们的工程中配置我们的Apple Pay了,首先就要先查看我们的ID.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1396375-a84110d4870bc14a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####ID查看完成之后就配置我们的Apply Pay 相关的信息.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1396375-b276bb7cf9274656.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>####当然了,我们还是要配置我们的商业证书和描述文件的</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1396375-c1d3363c74b78385.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<hr>
<p><br></p>
<p>#代码部分</p>
<hr>
<p>####当我们的上面两个整完之后,我们就要开始我们的代码部分了.因为是测试,所以我就简单的用storyboard做一下.代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#import &quot;ViewController.h&quot;</span><br><span class="line"></span><br><span class="line">//我们要使用Apple Pay 首先要先导入两个库</span><br><span class="line">#import &lt;PassKit/PassKit.h&gt;</span><br><span class="line"></span><br><span class="line">#import &lt;AddressBook/AddressBook.h&gt;</span><br><span class="line"></span><br><span class="line">//这里要遵守一个协议.</span><br><span class="line">@interface ViewController ()&lt;PKPaymentAuthorizationViewControllerDelegate&gt;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//这里我使用storyboard用一个按钮拖成一个事件</span><br><span class="line">- (IBAction)payAction:(id)sender &#123;</span><br><span class="line">    </span><br><span class="line">    //首先我们要先确定设备是否支持Apple Pay功能,现在支持Apple Pay功能功能的有iPhone 6，iPhone 6 Plus，iPhone 6s， iPhone 6s Plus；iPad Air 2，iPad mini 3，iPad mini 4，iPad Pro；还有Apple Watch.</span><br><span class="line">    if ([PKPaymentAuthorizationViewController canMakePayments]) &#123;</span><br><span class="line">        </span><br><span class="line">        //我们首先创建一个请求支付PKPaymentRequest类的对象</span><br><span class="line">        PKPaymentRequest *request = [[PKPaymentRequest  alloc]init];</span><br><span class="line">        </span><br><span class="line">        //然后设置支付的商品的目录  NSDecimalNumber是用于记录商品的价格的一个类</span><br><span class="line">        PKPaymentSummaryItem * item1 = [PKPaymentSummaryItem summaryItemWithLabel:@&quot;栋哥的87键黑轴纪念版键盘&quot; amount:[NSDecimalNumber decimalNumberWithString:@&quot;400&quot;]];</span><br><span class="line">        </span><br><span class="line">        PKPaymentSummaryItem * item2 = [PKPaymentSummaryItem summaryItemWithLabel:@&quot;栋哥的IE3.0纪念版鼠标&quot; amount:[NSDecimalNumber decimalNumberWithString:@&quot;200&quot;]];</span><br><span class="line">        </span><br><span class="line">        PKPaymentSummaryItem * item3 = [PKPaymentSummaryItem summaryItemWithLabel:@&quot;栋哥的赛睿纪念版霜冻之蓝耳机&quot; amount:[NSDecimalNumber decimalNumberWithString:@&quot;1000&quot;]];</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        PKPaymentSummaryItem * item4 = [PKPaymentSummaryItem summaryItemWithLabel:@&quot;神经骚栋&quot; amount:[NSDecimalNumber decimalNumberWithString:@&quot;6000&quot;] type:PKPaymentSummaryItemTypeFinal];</span><br><span class="line">        </span><br><span class="line">        //设置paymentSummaryItems的数组元素.</span><br><span class="line">        request.paymentSummaryItems = @[item1,item2,item3,item4];</span><br><span class="line">        </span><br><span class="line">        //指定国家区域编号</span><br><span class="line">        request.countryCode = @&quot;CN&quot;;</span><br><span class="line">        </span><br><span class="line">        //指定国家货币种类,在下面我会说到各国的货币种类都叫什么,现在我们就用RMB来说吧</span><br><span class="line">        request.currencyCode = @&quot;CNY&quot;;</span><br><span class="line">        </span><br><span class="line">        //然后指定支持的网上银行支付手段</span><br><span class="line">        request.supportedNetworks = @[PKPaymentNetworkMasterCard,PKPaymentNetworkVisa];</span><br><span class="line">        </span><br><span class="line">        //指定App需要的商业ID</span><br><span class="line">        request.merchantIdentifier = @&quot;merchant.com.Dong.ApplePay&quot;;</span><br><span class="line">        </span><br><span class="line">        //指定支付的权限的范围限制</span><br><span class="line">        request.merchantCapabilities = PKMerchantCapabilityEMV;</span><br><span class="line">        </span><br><span class="line">        //设置订单接受的地址</span><br><span class="line">        request.requiredBillingAddressFields = PKAddressFieldEmail | PKAddressFieldPostalAddress;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        /***********************request支付请求已经设置完成**********************/</span><br><span class="line">        </span><br><span class="line">        //设置支付页面的相关信息</span><br><span class="line">        PKPaymentAuthorizationViewController *payMentVC = [[PKPaymentAuthorizationViewController alloc]initWithPaymentRequest:request];</span><br><span class="line">        </span><br><span class="line">        //设置代理</span><br><span class="line">        payMentVC.delegate = self;</span><br><span class="line">        </span><br><span class="line">        if (!payMentVC) &#123;</span><br><span class="line">            </span><br><span class="line">            NSLog(@&quot;支付页面失败!&quot;);</span><br><span class="line">            </span><br><span class="line">        &#125;else&#123;</span><br><span class="line">        </span><br><span class="line">            [self presentViewController:payMentVC animated:YES completion:nil];</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    &#125;else&#123;</span><br><span class="line">    </span><br><span class="line">        NSLog(@&quot;设备不支持Apply Pay 功能!&quot;);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>####当我们完成上面的工作之后,就要必须完成下面的两个代理方法.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#pragma mark----支付过程中调用这个方法-----</span><br><span class="line"></span><br><span class="line">//payment就是支付的对象相关的所有信息都存在这个对象当中.</span><br><span class="line">-(void)paymentAuthorizationViewController:(PKPaymentAuthorizationViewController *)controller didAuthorizePayment:(PKPayment *)payment completion:(void (^)(PKPaymentAuthorizationStatus))completion&#123;</span><br><span class="line"></span><br><span class="line">    //获取到服务器发给用户的token.token里面含有成功或者是失败的信息.</span><br><span class="line">    PKPaymentToken *token = payment.token;</span><br><span class="line">    </span><br><span class="line">    //拿到订单人相关的信息,其实包括地址,姓名,邮箱等等</span><br><span class="line">    NSString *name = payment.billingContact.name.nickname;</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;%@&quot;,name);</span><br><span class="line">    </span><br><span class="line">    //上面的token和name发送到自己的服务器,由自己的服务器和商家进行接口的调用返回一个结果,我们将这个返回的结果再与客户端的用户进行交互,</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    //状态结果的类为PKPaymentAuthorizationStatus,因为我们做的是测试,所以我们就先指定他为成功</span><br><span class="line">    PKPaymentAuthorizationStatus status = PKPaymentAuthorizationStatusSuccess;</span><br><span class="line">    </span><br><span class="line">    completion(status);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark----支付完成-----</span><br><span class="line"></span><br><span class="line">-(void)paymentAuthorizationViewControllerDidFinish:(PKPaymentAuthorizationViewController *)controller&#123;</span><br><span class="line"></span><br><span class="line">    //隐藏支付界面</span><br><span class="line">    [controller dismissViewControllerAnimated:YES completion:nil];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p></p>
<p>###下面就是世界主要货币的英文简写表,希望对大家有所帮助..</p>
<table>
<thead>
<tr>
<th>国家货币名称</th>
<th style="text-align:center">货币英文简写</th>
</tr>
</thead>
<tbody>
<tr>
<td>人民币</td>
<td style="text-align:center">CNY</td>
</tr>
<tr>
<td>英镑</td>
<td style="text-align:center">GBP</td>
</tr>
<tr>
<td>比利时法郎</td>
<td style="text-align:center">BEF</td>
</tr>
<tr>
<td>新西兰元</td>
<td style="text-align:center">NZD</td>
</tr>
<tr>
<td>港币</td>
<td style="text-align:center">HKD</td>
</tr>
<tr>
<td>意大利里拉</td>
<td style="text-align:center">ITL</td>
</tr>
<tr>
<td>奥地利先令</td>
<td style="text-align:center">ATS</td>
</tr>
<tr>
<td>美元</td>
<td style="text-align:center">USD</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>国家货币名称</th>
<th style="text-align:center">货币英文简写</th>
</tr>
</thead>
<tbody>
<tr>
<td>日元</td>
<td style="text-align:center">JPY</td>
</tr>
<tr>
<td>挪威克朗</td>
<td style="text-align:center">NOK</td>
</tr>
<tr>
<td>瑞士法郎</td>
<td style="text-align:center">CHF</td>
</tr>
<tr>
<td>加拿大元</td>
<td style="text-align:center">CAD</td>
</tr>
<tr>
<td>泰国铢</td>
<td style="text-align:center">THB</td>
</tr>
<tr>
<td>德国马克</td>
<td style="text-align:center">DEM</td>
</tr>
<tr>
<td>澳大利亚元</td>
<td style="text-align:center">AUD</td>
</tr>
<tr>
<td>丹麦克朗</td>
<td style="text-align:center">DKK</td>
</tr>
<tr>
<td>法国法郎</td>
<td style="text-align:center">FRF</td>
</tr>
<tr>
<td>西班牙比塞塔</td>
<td style="text-align:center">ESP</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>国家货币名称</th>
<th style="text-align:center">货币英文简写</th>
</tr>
</thead>
<tbody>
<tr>
<td>菲律宾比索</td>
<td style="text-align:center">PHP</td>
</tr>
<tr>
<td>新加坡元</td>
<td style="text-align:center">SGD</td>
</tr>
<tr>
<td>欧元</td>
<td style="text-align:center">EUR</td>
</tr>
<tr>
<td>瑞典克朗</td>
<td style="text-align:center">SEK</td>
</tr>
<tr>
<td>荷兰盾</td>
<td style="text-align:center">NLG</td>
</tr>
<tr>
<td>芬兰马克</td>
<td style="text-align:center">FIM</td>
</tr>
<tr>
<td>澳门元</td>
<td style="text-align:center">MOP</td>
</tr>
</tbody>
</table>
<p></p>
<p>####代码我都做了详细的注释,如果还有不懂的,可以参考我的Demo 以及 下面的资料</p>
<p>####<a href="http://yun.baidu.com/share/link?shareid=1076887904&amp;uk=4079807053" target="_blank" rel="external">——–&gt;点击下载Demo</a></p>
<p>####<a href="http://www.coderqi.com/2016/02/25/AppPay/#more" target="_blank" rel="external">——–&gt;点击进入codeqi博客</a></p>
<p></p>
<p>###今天的Apply Pay就介绍到这,😃,如果大家有什么意见可以给我留言.</p>

      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2016/03/07/华山论剑之Apple Pay/#more" class="more-link"><i class="fa fa-chevron-right"></i>Read More</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://yoursite.com/2016/03/07/华山论剑之Apple Pay/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2016/03/07/华山论剑之Apple Pay/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2016-03-07T09:16:47.000Z"><a href="/2016/03/07/华山论剑之浅谈ios单例/">週一, 3月 7 2016, 5:16:47 下午</a></time>

  
    <h1 class="title"><a href="/2016/03/07/华山论剑之浅谈ios单例/">华山论剑之Apple Pay</a></h1>
  



<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <p>##华山论剑之浅谈iOS单例<br><br></p>
<blockquote>
<p>####<strong>“不管真单例还是伪单例,种地就用史丹利!”</strong>   ——栋哥</p>
</blockquote>
<p></p>
<p>####今天就简单的谈一下单例的创建和使用,单例就是一个只有一个实例对象的类,单例的特点就是当单例对象被创建出来的时候就会一直存在,直到程序被杀死,单例对象才会从内存中释放掉,单例为什么会有这样的特性呢?这是因为单例对象是存在于内存中的静态区的,所以它的生命周期特别的长.那么我们都在什么时候用到单例呢?当我们需要对一个事件只执行一次的时候,比如网络解析的时候,我们需要一个单例存储我们的网络数据,这样就可以有效的避免代码的冗杂度了.当然了,单例的使用有利也有弊,他的有利之处在于他可以有效的避免代码的冗杂度,但是由于单例的生命周期导致数据的不安全性.同时会让占用的内存不能及时的得到释放,影响了系统的运行效率.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1396375-bbd653fd3b849780.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p></p>
<p>##伪单例</p>
<p>####相比于完整单例,伪单例的创建就相对简单的多了.伪单例对象只需要对其初始化方法进行修改就行.现在我们就创建一个伪单例对象Person.在Person.h文件中我们要声明一个类方法用于单例的初始化.单例的类型可以多种多样,不一定就是NSObject的子类.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface Person : NSObject</span><br><span class="line"></span><br><span class="line">+(instancetype)defaultPerson;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>####我们在Person.m文件中就要defaultPerson进行实现了.这里实现的方式有两种一种是使用@synchronized进行加锁操作,另外一种是使用GCD进行加锁.<br><br>@synchronized进行加锁.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;Person.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation Person</span><br><span class="line"></span><br><span class="line">static Person *person = nil;</span><br><span class="line"></span><br><span class="line">+(instancetype)defaultPerson&#123;</span><br><span class="line"></span><br><span class="line">    @synchronized(self) &#123;</span><br><span class="line">        </span><br><span class="line">        if (nil == person) &#123;</span><br><span class="line">            </span><br><span class="line">            person = [[Person alloc]init];</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">   </span><br><span class="line">    &#125;</span><br><span class="line">    return person;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p><br>使用GCD进行加锁.  dispatch_once这个线程之后只会走一次.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;Person.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation Person</span><br><span class="line"></span><br><span class="line">static Person *person = nil;</span><br><span class="line"></span><br><span class="line">+(instancetype)defaultPerson&#123;</span><br><span class="line">    </span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        </span><br><span class="line">        person = [[Person alloc] init];</span><br><span class="line">        </span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    return person;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>####这样我们创建出来的对象全局就唯一存在了,其实这是不完整的,因为如果有 对该对象进行copy mutableCopy copyWithZone 等操作时，就不是同一份对象了。所以完整单例就是要对这些方法进行重写.<br><br><br></p>
<p>##完整单例</p>
<p>####相对于伪单例,完整单例需要重写的方法有两个方向,一个是初始化方法,另外一个就是copy的一系列的方法.我们先看一下初始化方法.</p>
<p><br>创建单例的方法,我们会使用到allocWithZone这个方法避免出现死循环.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">static Person *person = nil;</span><br><span class="line"></span><br><span class="line">+(instancetype)defaultPerson&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    @synchronized(self)&#123;</span><br><span class="line">        if (nil == person) &#123;</span><br><span class="line">            </span><br><span class="line">            person = [[super allocWithZone:nil] init]; // 避免死循环</span><br><span class="line">            // 如果 在单例类里面重写了 allocWithZone 方法 ，在创建单例对象时 使用 [[DataHandle alloc] init] 创建，会死循环。</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return person;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们看一下 allocWithZone 和alloc 方法是如何修改的.这样就保证再次开辟空间也是同一个对象了.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ (instancetype)allocWithZone:(struct _NSZone *)zone</span><br><span class="line">&#123;</span><br><span class="line">    return [Person defaultPerson];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)alloc</span><br><span class="line">&#123;</span><br><span class="line">    return [Person defaultPerson];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>再看一下剩下的copy一系列的方法的修改,返回值全部是自己本身,这样保障不管怎么复制都是同一个对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (id)copy</span><br><span class="line">&#123;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)mutableCopy</span><br><span class="line">&#123;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (id)copyWithZone:(struct _NSZone *)zone</span><br><span class="line">&#123;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当然了,在MRC环境下.引用计数我们是这样做的修改的,因为只有一个实例对象,所以引用计数对实例对象实际上是没有任何意义的.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)retain</span><br><span class="line">&#123;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (oneway void)release</span><br><span class="line">&#123;</span><br><span class="line">    // nothing</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)autorelease</span><br><span class="line">&#123;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSUInteger)retainCount</span><br><span class="line">&#123;</span><br><span class="line">    return NSUIntegerMax; // 返回整形最大值。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2016/03/07/华山论剑之浅谈ios单例/#more" class="more-link"><i class="fa fa-chevron-right"></i>Read More</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://yoursite.com/2016/03/07/华山论剑之浅谈ios单例/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2016/03/07/华山论剑之浅谈ios单例/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>

<script src="/js/jquery.anystretch.min.js"></script>
<script src="/js/cover.js"></script>

    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div>
  
  &copy; 2016 神经骚栋
  
</div>
Powered by <a href="http://zespia.tw/hexo/" title="Hexo" target="_blank" rel="external">Hexo</a> and <a href="http://pages.github.com/" title="GitHub Pages" target="_blank" rel="external">GitHub Pages</a>

<div class="clearfix"></div></footer>
  
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>




    <script type="text/javascript">
        (function(){

            $(window).scroll(function(){

                var scrollTop = $(window).scrollTop();
                if ( scrollTop >200 ){
                    $("#main-nav").removeClass('normal_mode').addClass('top_mode');
                } else{
                    $("#main-nav").removeClass('top_mode').addClass('normal_mode');
                }

            });

        })();
    </script>



  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
  (function($){
    $('.fancybox').fancybox({
      'titlePosition': 'inside'
    });
  })(jQuery);
  </script>



    
    <script type="text/javascript">
      var duoshuoQuery = {short_name:"your_id"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = 'http://static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0] 
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>



<script type="text/javascript">
  
  $(function(){

    $('.title').hover(
      function() {      
        $(this).stop().animate(
          {'marginLeft': '10px'}, 200
        );   
      }, 
      function() {       
        $(this).stop().animate({'marginLeft': '0px'}, 200);      
      
    });   

  });

</script>


</body>
</html>