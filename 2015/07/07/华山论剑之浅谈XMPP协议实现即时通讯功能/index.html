<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="ä¼˜ç§€çš„ä»£ç æ˜¯å®ƒè‡ªå·±æœ€å¥½çš„æ–‡æ¡£ã€‚å½“ä½ è€ƒè™‘è¦æ·»åŠ ä¸€ä¸ªæ³¨é‡Šæ—¶ï¼Œé—®é—®è‡ªå·±ï¼Œâ€œå¦‚ä½•èƒ½æ”¹è¿›è¿™æ®µä»£ç ï¼Œä»¥è®©å®ƒä¸éœ€è¦æ³¨é‡Šï¼Ÿâ€

XMPPç®€ä»‹
XMPPæ˜¯ä¸€ç§åŸºäºæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„å­é›†XMLçš„åè®®ï¼Œå®ƒç»§æ‰¿äº†åœ¨XMLç¯å¢ƒä¸­çµæ´»çš„å‘å±•æ€§ã€‚å› æ­¤ï¼ŒåŸºäºXMPPçš„åº”ç”¨å…·æœ‰è¶…å¼ºçš„å¯æ‰©å±•æ€§ã€‚ç»è¿‡æ‰©å±•ä»¥åçš„XMPPå¯ä»¥é€šè¿‡å‘é€æ‰©å±•çš„ä¿¡æ¯æ¥å¤„ç†ç”¨æˆ·çš„éœ€æ±‚ï¼Œä»¥åŠåœ¨XMPPçš„é¡¶ç«¯å»ºç«‹å¦‚å†…å®¹å‘å¸ƒç³»ç»Ÿå’ŒåŸºäºåœ°å€çš„æœåŠ¡ç­‰åº”ç”¨ç¨‹åºã€‚è€Œä¸”ï¼ŒXM">
<meta property="og:type" content="article">
<meta property="og:title" content="åå±±è®ºå‰‘ä¹‹æµ…è°ˆXMPPåè®®å®ç°å³æ—¶é€šè®¯åŠŸèƒ½">
<meta property="og:url" content="http://yoursite.com/2015/07/07/åå±±è®ºå‰‘ä¹‹æµ…è°ˆXMPPåè®®å®ç°å³æ—¶é€šè®¯åŠŸèƒ½/index.html">
<meta property="og:site_name" content="Coder-Dong">
<meta property="og:description" content="ä¼˜ç§€çš„ä»£ç æ˜¯å®ƒè‡ªå·±æœ€å¥½çš„æ–‡æ¡£ã€‚å½“ä½ è€ƒè™‘è¦æ·»åŠ ä¸€ä¸ªæ³¨é‡Šæ—¶ï¼Œé—®é—®è‡ªå·±ï¼Œâ€œå¦‚ä½•èƒ½æ”¹è¿›è¿™æ®µä»£ç ï¼Œä»¥è®©å®ƒä¸éœ€è¦æ³¨é‡Šï¼Ÿâ€

XMPPç®€ä»‹
XMPPæ˜¯ä¸€ç§åŸºäºæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„å­é›†XMLçš„åè®®ï¼Œå®ƒç»§æ‰¿äº†åœ¨XMLç¯å¢ƒä¸­çµæ´»çš„å‘å±•æ€§ã€‚å› æ­¤ï¼ŒåŸºäºXMPPçš„åº”ç”¨å…·æœ‰è¶…å¼ºçš„å¯æ‰©å±•æ€§ã€‚ç»è¿‡æ‰©å±•ä»¥åçš„XMPPå¯ä»¥é€šè¿‡å‘é€æ‰©å±•çš„ä¿¡æ¯æ¥å¤„ç†ç”¨æˆ·çš„éœ€æ±‚ï¼Œä»¥åŠåœ¨XMPPçš„é¡¶ç«¯å»ºç«‹å¦‚å†…å®¹å‘å¸ƒç³»ç»Ÿå’ŒåŸºäºåœ°å€çš„æœåŠ¡ç­‰åº”ç”¨ç¨‹åºã€‚è€Œä¸”ï¼ŒXM">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1f1qkk1clv9j30mo0ftt8w.jpg
">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1f1qkmltqyqj30mo0ftjsb.jpg
">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1f1qkotv4wgj30yg0idjsx.jpg
">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1f1qkqxe6elj30yg0ghdhm.jpg
">
<meta property="og:updated_time" content="2016-03-09T06:04:11.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="åå±±è®ºå‰‘ä¹‹æµ…è°ˆXMPPåè®®å®ç°å³æ—¶é€šè®¯åŠŸèƒ½">
<meta name="twitter:description" content="ä¼˜ç§€çš„ä»£ç æ˜¯å®ƒè‡ªå·±æœ€å¥½çš„æ–‡æ¡£ã€‚å½“ä½ è€ƒè™‘è¦æ·»åŠ ä¸€ä¸ªæ³¨é‡Šæ—¶ï¼Œé—®é—®è‡ªå·±ï¼Œâ€œå¦‚ä½•èƒ½æ”¹è¿›è¿™æ®µä»£ç ï¼Œä»¥è®©å®ƒä¸éœ€è¦æ³¨é‡Šï¼Ÿâ€

XMPPç®€ä»‹
XMPPæ˜¯ä¸€ç§åŸºäºæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„å­é›†XMLçš„åè®®ï¼Œå®ƒç»§æ‰¿äº†åœ¨XMLç¯å¢ƒä¸­çµæ´»çš„å‘å±•æ€§ã€‚å› æ­¤ï¼ŒåŸºäºXMPPçš„åº”ç”¨å…·æœ‰è¶…å¼ºçš„å¯æ‰©å±•æ€§ã€‚ç»è¿‡æ‰©å±•ä»¥åçš„XMPPå¯ä»¥é€šè¿‡å‘é€æ‰©å±•çš„ä¿¡æ¯æ¥å¤„ç†ç”¨æˆ·çš„éœ€æ±‚ï¼Œä»¥åŠåœ¨XMPPçš„é¡¶ç«¯å»ºç«‹å¦‚å†…å®¹å‘å¸ƒç³»ç»Ÿå’ŒåŸºäºåœ°å€çš„æœåŠ¡ç­‰åº”ç”¨ç¨‹åºã€‚è€Œä¸”ï¼ŒXM">
<meta name="twitter:image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1f1qkk1clv9j30mo0ftt8w.jpg
">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"hide"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'åšä¸»'
    }
  };
</script>

  <title> åå±±è®ºå‰‘ä¹‹æµ…è°ˆXMPPåè®®å®ç°å³æ—¶é€šè®¯åŠŸèƒ½ | Coder-Dong </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Coder-Dong</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="http://www.ixirong.com/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-heartbeat fa-fw"></i> <br />
            
            å…¬ç›Š404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                åå±±è®ºå‰‘ä¹‹æµ…è°ˆXMPPåè®®å®ç°å³æ—¶é€šè®¯åŠŸèƒ½
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2015-07-07T19:36:18+08:00" content="2015-07-07">
              2015-07-07
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<h6 id="ä¼˜ç§€çš„ä»£ç æ˜¯å®ƒè‡ªå·±æœ€å¥½çš„æ–‡æ¡£ã€‚å½“ä½ è€ƒè™‘è¦æ·»åŠ ä¸€ä¸ªæ³¨é‡Šæ—¶ï¼Œé—®é—®è‡ªå·±ï¼Œâ€œå¦‚ä½•èƒ½æ”¹è¿›è¿™æ®µä»£ç ï¼Œä»¥è®©å®ƒä¸éœ€è¦æ³¨é‡Šï¼Ÿâ€"><a href="#ä¼˜ç§€çš„ä»£ç æ˜¯å®ƒè‡ªå·±æœ€å¥½çš„æ–‡æ¡£ã€‚å½“ä½ è€ƒè™‘è¦æ·»åŠ ä¸€ä¸ªæ³¨é‡Šæ—¶ï¼Œé—®é—®è‡ªå·±ï¼Œâ€œå¦‚ä½•èƒ½æ”¹è¿›è¿™æ®µä»£ç ï¼Œä»¥è®©å®ƒä¸éœ€è¦æ³¨é‡Šï¼Ÿâ€" class="headerlink" title="ä¼˜ç§€çš„ä»£ç æ˜¯å®ƒè‡ªå·±æœ€å¥½çš„æ–‡æ¡£ã€‚å½“ä½ è€ƒè™‘è¦æ·»åŠ ä¸€ä¸ªæ³¨é‡Šæ—¶ï¼Œé—®é—®è‡ªå·±ï¼Œâ€œå¦‚ä½•èƒ½æ”¹è¿›è¿™æ®µä»£ç ï¼Œä»¥è®©å®ƒä¸éœ€è¦æ³¨é‡Šï¼Ÿâ€"></a><strong>ä¼˜ç§€çš„ä»£ç æ˜¯å®ƒè‡ªå·±æœ€å¥½çš„æ–‡æ¡£ã€‚å½“ä½ è€ƒè™‘è¦æ·»åŠ ä¸€ä¸ªæ³¨é‡Šæ—¶ï¼Œé—®é—®è‡ªå·±ï¼Œâ€œå¦‚ä½•èƒ½æ”¹è¿›è¿™æ®µä»£ç ï¼Œä»¥è®©å®ƒä¸éœ€è¦æ³¨é‡Šï¼Ÿâ€</strong></h6></blockquote>
<p><br></p>
<h2 id="XMPPç®€ä»‹"><a href="#XMPPç®€ä»‹" class="headerlink" title="XMPPç®€ä»‹"></a>XMPPç®€ä»‹</h2><blockquote>
<h5 id="XMPPæ˜¯ä¸€ç§åŸºäºæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„å­é›†XMLçš„åè®®ï¼Œå®ƒç»§æ‰¿äº†åœ¨XMLç¯å¢ƒä¸­çµæ´»çš„å‘å±•æ€§ã€‚å› æ­¤ï¼ŒåŸºäºXMPPçš„åº”ç”¨å…·æœ‰è¶…å¼ºçš„å¯æ‰©å±•æ€§ã€‚ç»è¿‡æ‰©å±•ä»¥åçš„XMPPå¯ä»¥é€šè¿‡å‘é€æ‰©å±•çš„ä¿¡æ¯æ¥å¤„ç†ç”¨æˆ·çš„éœ€æ±‚ï¼Œä»¥åŠåœ¨XMPPçš„é¡¶ç«¯å»ºç«‹å¦‚å†…å®¹å‘å¸ƒç³»ç»Ÿå’ŒåŸºäºåœ°å€çš„æœåŠ¡ç­‰åº”ç”¨ç¨‹åºã€‚è€Œä¸”ï¼ŒXMPPåŒ…å«äº†é’ˆå¯¹æœåŠ¡å™¨ç«¯çš„è½¯ä»¶åè®®ï¼Œä½¿ä¹‹èƒ½ä¸å¦ä¸€ä¸ªè¿›è¡Œé€šè¯ï¼Œè¿™ä½¿å¾—å¼€å‘è€…æ›´å®¹æ˜“å»ºç«‹å®¢æˆ·åº”ç”¨ç¨‹åºæˆ–ç»™ä¸€ä¸ªé…å¥½ç³»ç»Ÿæ·»åŠ åŠŸèƒ½ã€‚"><a href="#XMPPæ˜¯ä¸€ç§åŸºäºæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„å­é›†XMLçš„åè®®ï¼Œå®ƒç»§æ‰¿äº†åœ¨XMLç¯å¢ƒä¸­çµæ´»çš„å‘å±•æ€§ã€‚å› æ­¤ï¼ŒåŸºäºXMPPçš„åº”ç”¨å…·æœ‰è¶…å¼ºçš„å¯æ‰©å±•æ€§ã€‚ç»è¿‡æ‰©å±•ä»¥åçš„XMPPå¯ä»¥é€šè¿‡å‘é€æ‰©å±•çš„ä¿¡æ¯æ¥å¤„ç†ç”¨æˆ·çš„éœ€æ±‚ï¼Œä»¥åŠåœ¨XMPPçš„é¡¶ç«¯å»ºç«‹å¦‚å†…å®¹å‘å¸ƒç³»ç»Ÿå’ŒåŸºäºåœ°å€çš„æœåŠ¡ç­‰åº”ç”¨ç¨‹åºã€‚è€Œä¸”ï¼ŒXMPPåŒ…å«äº†é’ˆå¯¹æœåŠ¡å™¨ç«¯çš„è½¯ä»¶åè®®ï¼Œä½¿ä¹‹èƒ½ä¸å¦ä¸€ä¸ªè¿›è¡Œé€šè¯ï¼Œè¿™ä½¿å¾—å¼€å‘è€…æ›´å®¹æ˜“å»ºç«‹å®¢æˆ·åº”ç”¨ç¨‹åºæˆ–ç»™ä¸€ä¸ªé…å¥½ç³»ç»Ÿæ·»åŠ åŠŸèƒ½ã€‚" class="headerlink" title="XMPPæ˜¯ä¸€ç§åŸºäºæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„å­é›†XMLçš„åè®®ï¼Œå®ƒç»§æ‰¿äº†åœ¨XMLç¯å¢ƒä¸­çµæ´»çš„å‘å±•æ€§ã€‚å› æ­¤ï¼ŒåŸºäºXMPPçš„åº”ç”¨å…·æœ‰è¶…å¼ºçš„å¯æ‰©å±•æ€§ã€‚ç»è¿‡æ‰©å±•ä»¥åçš„XMPPå¯ä»¥é€šè¿‡å‘é€æ‰©å±•çš„ä¿¡æ¯æ¥å¤„ç†ç”¨æˆ·çš„éœ€æ±‚ï¼Œä»¥åŠåœ¨XMPPçš„é¡¶ç«¯å»ºç«‹å¦‚å†…å®¹å‘å¸ƒç³»ç»Ÿå’ŒåŸºäºåœ°å€çš„æœåŠ¡ç­‰åº”ç”¨ç¨‹åºã€‚è€Œä¸”ï¼ŒXMPPåŒ…å«äº†é’ˆå¯¹æœåŠ¡å™¨ç«¯çš„è½¯ä»¶åè®®ï¼Œä½¿ä¹‹èƒ½ä¸å¦ä¸€ä¸ªè¿›è¡Œé€šè¯ï¼Œè¿™ä½¿å¾—å¼€å‘è€…æ›´å®¹æ˜“å»ºç«‹å®¢æˆ·åº”ç”¨ç¨‹åºæˆ–ç»™ä¸€ä¸ªé…å¥½ç³»ç»Ÿæ·»åŠ åŠŸèƒ½ã€‚"></a>XMPPæ˜¯ä¸€ç§åŸºäºæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„å­é›†XMLçš„åè®®ï¼Œå®ƒç»§æ‰¿äº†åœ¨XMLç¯å¢ƒä¸­çµæ´»çš„å‘å±•æ€§ã€‚å› æ­¤ï¼ŒåŸºäºXMPPçš„åº”ç”¨å…·æœ‰è¶…å¼ºçš„å¯æ‰©å±•æ€§ã€‚ç»è¿‡æ‰©å±•ä»¥åçš„XMPPå¯ä»¥é€šè¿‡å‘é€æ‰©å±•çš„ä¿¡æ¯æ¥å¤„ç†ç”¨æˆ·çš„éœ€æ±‚ï¼Œä»¥åŠåœ¨XMPPçš„é¡¶ç«¯å»ºç«‹å¦‚å†…å®¹å‘å¸ƒç³»ç»Ÿå’ŒåŸºäºåœ°å€çš„æœåŠ¡ç­‰åº”ç”¨ç¨‹åºã€‚è€Œä¸”ï¼ŒXMPPåŒ…å«äº†é’ˆå¯¹æœåŠ¡å™¨ç«¯çš„è½¯ä»¶åè®®ï¼Œä½¿ä¹‹èƒ½ä¸å¦ä¸€ä¸ªè¿›è¡Œé€šè¯ï¼Œè¿™ä½¿å¾—å¼€å‘è€…æ›´å®¹æ˜“å»ºç«‹å®¢æˆ·åº”ç”¨ç¨‹åºæˆ–ç»™ä¸€ä¸ªé…å¥½ç³»ç»Ÿæ·»åŠ åŠŸèƒ½ã€‚</h5></blockquote>
<a id="more"></a>
<p><img src="http://ww1.sinaimg.cn/large/0060lm7Tgw1f1qkk1clv9j30mo0ftt8w.jpg
" alt="â€œç¥ç»éªšæ ‹â€/"></p>
<p><br></p>
<h2 id="XMPPåè®®çš„å®ç°åŸç†è¿‡ç¨‹"><a href="#XMPPåè®®çš„å®ç°åŸç†è¿‡ç¨‹" class="headerlink" title="XMPPåè®®çš„å®ç°åŸç†è¿‡ç¨‹"></a>XMPPåè®®çš„å®ç°åŸç†è¿‡ç¨‹</h2><h4 id="å½“æˆ‘ä»¬çŸ¥é“XMPPæ˜¯ä¸€ç§åè®®çš„æ—¶å€™-æˆ‘ä»¬å¦‚ä½•é€šè¿‡objective-c-ä»£ç å®ç°XMPPåè®®-è¿›è€Œå®ç°æˆ‘ä»¬çš„å³æ—¶é€šè®¯åŠŸèƒ½å‘¢-ä¸‹é¢çš„å›¾ç‰‡å°±æ˜¯ä¸ºæˆ‘ä»¬åšäº†å¾ˆå¥½çš„è§£é‡Š"><a href="#å½“æˆ‘ä»¬çŸ¥é“XMPPæ˜¯ä¸€ç§åè®®çš„æ—¶å€™-æˆ‘ä»¬å¦‚ä½•é€šè¿‡objective-c-ä»£ç å®ç°XMPPåè®®-è¿›è€Œå®ç°æˆ‘ä»¬çš„å³æ—¶é€šè®¯åŠŸèƒ½å‘¢-ä¸‹é¢çš„å›¾ç‰‡å°±æ˜¯ä¸ºæˆ‘ä»¬åšäº†å¾ˆå¥½çš„è§£é‡Š" class="headerlink" title="å½“æˆ‘ä»¬çŸ¥é“XMPPæ˜¯ä¸€ç§åè®®çš„æ—¶å€™,æˆ‘ä»¬å¦‚ä½•é€šè¿‡objective-c ä»£ç å®ç°XMPPåè®®,è¿›è€Œå®ç°æˆ‘ä»¬çš„å³æ—¶é€šè®¯åŠŸèƒ½å‘¢? ä¸‹é¢çš„å›¾ç‰‡å°±æ˜¯ä¸ºæˆ‘ä»¬åšäº†å¾ˆå¥½çš„è§£é‡Š."></a>å½“æˆ‘ä»¬çŸ¥é“XMPPæ˜¯ä¸€ç§åè®®çš„æ—¶å€™,æˆ‘ä»¬å¦‚ä½•é€šè¿‡objective-c ä»£ç å®ç°XMPPåè®®,è¿›è€Œå®ç°æˆ‘ä»¬çš„å³æ—¶é€šè®¯åŠŸèƒ½å‘¢? ä¸‹é¢çš„å›¾ç‰‡å°±æ˜¯ä¸ºæˆ‘ä»¬åšäº†å¾ˆå¥½çš„è§£é‡Š.</h4><p><img src="http://ww1.sinaimg.cn/large/0060lm7Tgw1f1qkmltqyqj30mo0ftjsb.jpg
" alt="â€œç¥ç»éªšæ ‹â€/"></p>
<p><br></p>
<h2 id="XMPPåè®®çš„ä»£ç å®ç°"><a href="#XMPPåè®®çš„ä»£ç å®ç°" class="headerlink" title="XMPPåè®®çš„ä»£ç å®ç°"></a>XMPPåè®®çš„ä»£ç å®ç°</h2><p></p>
<h3 id="1-å‡†å¤‡å·¥ä½œ"><a href="#1-å‡†å¤‡å·¥ä½œ" class="headerlink" title="1.å‡†å¤‡å·¥ä½œ"></a>1.å‡†å¤‡å·¥ä½œ</h3><h4 id="æˆ‘ä»¬åšçš„å®¢æˆ·ç«¯ä¹ŸæœåŠ¡å™¨é€šè®¯é€šé“çš„å®ç°ä»¥åŠæ•°æ®äº¤æµ-é‚£ä¹ˆé¦–å…ˆè¦æœ‰æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨-å½“ç„¶äº†-åœ¨å…¬å¸çš„å¥½è¯´ä¸€äº›-å¦‚æœæ˜¯ä¸ªäººç ”ç©¶æŠ€æœ¯æ€ä¹ˆåŠå‘¢-æˆ‘ä»¬å¯ä»¥è‡ªå·±æ­å»ºä¸€ä¸ªæœåŠ¡å™¨æˆ–è€…ä½¿ç”¨leancloudè¿™ç§ç¬¬ä¸‰æ–¹æœåŠ¡å™¨-è¿™é‡Œæˆ‘ç»™å¤§å®¶æä¾›ä¸€äº›æ­å»ºæœåŠ¡å™¨çš„å·¥å…·-å½“ç„¶äº†-è‡ªå·±æ­å»ºçš„æœåŠ¡å™¨ç”Ÿå‘½æ¯”è¾ƒè„†å¼±-è¯·å¤§å®¶å¥½å¥½çˆ±æŠ¤-è¿˜æœ‰å°±æ˜¯leancloudä¹Ÿæ˜¯æˆ‘æ¨èçš„ä¸€ç§æ–¹æ³•"><a href="#æˆ‘ä»¬åšçš„å®¢æˆ·ç«¯ä¹ŸæœåŠ¡å™¨é€šè®¯é€šé“çš„å®ç°ä»¥åŠæ•°æ®äº¤æµ-é‚£ä¹ˆé¦–å…ˆè¦æœ‰æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨-å½“ç„¶äº†-åœ¨å…¬å¸çš„å¥½è¯´ä¸€äº›-å¦‚æœæ˜¯ä¸ªäººç ”ç©¶æŠ€æœ¯æ€ä¹ˆåŠå‘¢-æˆ‘ä»¬å¯ä»¥è‡ªå·±æ­å»ºä¸€ä¸ªæœåŠ¡å™¨æˆ–è€…ä½¿ç”¨leancloudè¿™ç§ç¬¬ä¸‰æ–¹æœåŠ¡å™¨-è¿™é‡Œæˆ‘ç»™å¤§å®¶æä¾›ä¸€äº›æ­å»ºæœåŠ¡å™¨çš„å·¥å…·-å½“ç„¶äº†-è‡ªå·±æ­å»ºçš„æœåŠ¡å™¨ç”Ÿå‘½æ¯”è¾ƒè„†å¼±-è¯·å¤§å®¶å¥½å¥½çˆ±æŠ¤-è¿˜æœ‰å°±æ˜¯leancloudä¹Ÿæ˜¯æˆ‘æ¨èçš„ä¸€ç§æ–¹æ³•" class="headerlink" title="æˆ‘ä»¬åšçš„å®¢æˆ·ç«¯ä¹ŸæœåŠ¡å™¨é€šè®¯é€šé“çš„å®ç°ä»¥åŠæ•°æ®äº¤æµ,é‚£ä¹ˆé¦–å…ˆè¦æœ‰æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨,å½“ç„¶äº†,åœ¨å…¬å¸çš„å¥½è¯´ä¸€äº›,å¦‚æœæ˜¯ä¸ªäººç ”ç©¶æŠ€æœ¯æ€ä¹ˆåŠå‘¢?æˆ‘ä»¬å¯ä»¥è‡ªå·±æ­å»ºä¸€ä¸ªæœåŠ¡å™¨æˆ–è€…ä½¿ç”¨leancloudè¿™ç§ç¬¬ä¸‰æ–¹æœåŠ¡å™¨,è¿™é‡Œæˆ‘ç»™å¤§å®¶æä¾›ä¸€äº›æ­å»ºæœåŠ¡å™¨çš„å·¥å…·,å½“ç„¶äº†,è‡ªå·±æ­å»ºçš„æœåŠ¡å™¨ç”Ÿå‘½æ¯”è¾ƒè„†å¼±,è¯·å¤§å®¶å¥½å¥½çˆ±æŠ¤~è¿˜æœ‰å°±æ˜¯leancloudä¹Ÿæ˜¯æˆ‘æ¨èçš„ä¸€ç§æ–¹æ³•."></a>æˆ‘ä»¬åšçš„å®¢æˆ·ç«¯ä¹ŸæœåŠ¡å™¨é€šè®¯é€šé“çš„å®ç°ä»¥åŠæ•°æ®äº¤æµ,é‚£ä¹ˆé¦–å…ˆè¦æœ‰æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨,å½“ç„¶äº†,åœ¨å…¬å¸çš„å¥½è¯´ä¸€äº›,å¦‚æœæ˜¯ä¸ªäººç ”ç©¶æŠ€æœ¯æ€ä¹ˆåŠå‘¢?æˆ‘ä»¬å¯ä»¥è‡ªå·±æ­å»ºä¸€ä¸ªæœåŠ¡å™¨æˆ–è€…ä½¿ç”¨leancloudè¿™ç§ç¬¬ä¸‰æ–¹æœåŠ¡å™¨,è¿™é‡Œæˆ‘ç»™å¤§å®¶æä¾›ä¸€äº›æ­å»ºæœåŠ¡å™¨çš„å·¥å…·,å½“ç„¶äº†,è‡ªå·±æ­å»ºçš„æœåŠ¡å™¨ç”Ÿå‘½æ¯”è¾ƒè„†å¼±,è¯·å¤§å®¶å¥½å¥½çˆ±æŠ¤~è¿˜æœ‰å°±æ˜¯leancloudä¹Ÿæ˜¯æˆ‘æ¨èçš„ä¸€ç§æ–¹æ³•.</h4><h4 id="â€”â€“-gt-ç‚¹å‡»å‰å¾€LeanCloudå®˜æ–¹ç½‘ç«™"><a href="#â€”â€“-gt-ç‚¹å‡»å‰å¾€LeanCloudå®˜æ–¹ç½‘ç«™" class="headerlink" title="â€”â€“&gt;ç‚¹å‡»å‰å¾€LeanCloudå®˜æ–¹ç½‘ç«™"></a><a href="https://leancloud.cn/" target="_blank" rel="external">â€”â€“&gt;ç‚¹å‡»å‰å¾€LeanCloudå®˜æ–¹ç½‘ç«™</a></h4><h4 id="â€”â€“-gt-XMPPæœ¬åœ°æœåŠ¡å™¨æ­å»ºå·¥å…·ä¸‹è½½"><a href="#â€”â€“-gt-XMPPæœ¬åœ°æœåŠ¡å™¨æ­å»ºå·¥å…·ä¸‹è½½" class="headerlink" title="â€”â€“&gt;XMPPæœ¬åœ°æœåŠ¡å™¨æ­å»ºå·¥å…·ä¸‹è½½"></a><a href="http://yun.baidu.com/share/link?shareid=3391082706&amp;uk=4079807053/" target="_blank" rel="external">â€”â€“&gt;XMPPæœ¬åœ°æœåŠ¡å™¨æ­å»ºå·¥å…·ä¸‹è½½</a></h4><p><br> </p>
<h3 id="2-OCæ­å»ºClientå’Œè¿æ¥é€šé“"><a href="#2-OCæ­å»ºClientå’Œè¿æ¥é€šé“" class="headerlink" title="2.OCæ­å»ºClientå’Œè¿æ¥é€šé“"></a>2.OCæ­å»ºClientå’Œè¿æ¥é€šé“</h3><p></p>
<h4 id="å·¥ç¨‹å®Œæˆç›®æ ‡"><a href="#å·¥ç¨‹å®Œæˆç›®æ ‡" class="headerlink" title="å·¥ç¨‹å®Œæˆç›®æ ‡:"></a>å·¥ç¨‹å®Œæˆç›®æ ‡:</h4><pre><code>1.åˆ›å»ºé€šè®¯é€šé“å¹¶å®Œæˆè´¦å·å¯†ç çš„ç™»å½•
2.åˆ›å»ºé€šé“å¹¶å®Œæˆè´¦å·çš„ç”³è¯·
3.å¥½å‹åˆ—è¡¨çš„è·å–å’Œæ˜¾ç¤º
4.å³æ—¶é€šè®¯åŠŸèƒ½çš„å®ç°
</code></pre><h4 id="é¦–å…ˆ-æˆ‘ä»¬éœ€è¦å¯¼å…¥æˆ‘ä»¬çš„æ‰€éœ€è¦å¯¼å…¥çš„-XMPPFramework-PS-ç‚¹å‡»æ‰“å¼€ä¸‹è½½-å®Œæˆä¹‹åç›´æ¥è§£å‹æ‹–åˆ°å·¥ç¨‹ä¸­ğŸ˜ƒ-è¿˜æœ‰æ‰‹åŠ¨çš„å¯¼å…¥ä¸¤ä¸ªåº“-å¦‚ä¸‹"><a href="#é¦–å…ˆ-æˆ‘ä»¬éœ€è¦å¯¼å…¥æˆ‘ä»¬çš„æ‰€éœ€è¦å¯¼å…¥çš„-XMPPFramework-PS-ç‚¹å‡»æ‰“å¼€ä¸‹è½½-å®Œæˆä¹‹åç›´æ¥è§£å‹æ‹–åˆ°å·¥ç¨‹ä¸­ğŸ˜ƒ-è¿˜æœ‰æ‰‹åŠ¨çš„å¯¼å…¥ä¸¤ä¸ªåº“-å¦‚ä¸‹" class="headerlink" title="é¦–å…ˆ,æˆ‘ä»¬éœ€è¦å¯¼å…¥æˆ‘ä»¬çš„æ‰€éœ€è¦å¯¼å…¥çš„ XMPPFramework (PS:ç‚¹å‡»æ‰“å¼€ä¸‹è½½,å®Œæˆä¹‹åç›´æ¥è§£å‹æ‹–åˆ°å·¥ç¨‹ä¸­ğŸ˜ƒ),è¿˜æœ‰æ‰‹åŠ¨çš„å¯¼å…¥ä¸¤ä¸ªåº“.å¦‚ä¸‹."></a>é¦–å…ˆ,æˆ‘ä»¬éœ€è¦å¯¼å…¥æˆ‘ä»¬çš„æ‰€éœ€è¦å¯¼å…¥çš„ <a href="http://yun.baidu.com/share/link?shareid=2277041742&amp;uk=4079807053" target="_blank" rel="external">XMPPFramework</a> (PS:ç‚¹å‡»æ‰“å¼€ä¸‹è½½,å®Œæˆä¹‹åç›´æ¥è§£å‹æ‹–åˆ°å·¥ç¨‹ä¸­ğŸ˜ƒ),è¿˜æœ‰æ‰‹åŠ¨çš„å¯¼å…¥ä¸¤ä¸ªåº“.å¦‚ä¸‹.</h4><blockquote>
<p>libxml2.tbd</p>
<p>libresolv.tbd</p>
</blockquote>
<h4 id="ç„¶å-æˆ‘ä»¬å°±è¦é…ç½®æˆ‘ä»¬çš„build-settingé¡µé¢çš„è®¾ç½®-search-paths-é€‰æ·»åŠ ä¸€ä¸ªå­—æ®µ-æ·»åŠ å¦‚ä¸‹"><a href="#ç„¶å-æˆ‘ä»¬å°±è¦é…ç½®æˆ‘ä»¬çš„build-settingé¡µé¢çš„è®¾ç½®-search-paths-é€‰æ·»åŠ ä¸€ä¸ªå­—æ®µ-æ·»åŠ å¦‚ä¸‹" class="headerlink" title="ç„¶å,æˆ‘ä»¬å°±è¦é…ç½®æˆ‘ä»¬çš„build settingé¡µé¢çš„è®¾ç½® search paths é€‰æ·»åŠ ä¸€ä¸ªå­—æ®µ,æ·»åŠ å¦‚ä¸‹"></a>ç„¶å,æˆ‘ä»¬å°±è¦é…ç½®æˆ‘ä»¬çš„build settingé¡µé¢çš„è®¾ç½® search paths é€‰æ·»åŠ ä¸€ä¸ªå­—æ®µ,æ·»åŠ å¦‚ä¸‹</h4><blockquote>
<p>/usr/include/libxml2</p>
</blockquote>
<p><img src="http://ww1.sinaimg.cn/large/0060lm7Tgw1f1qkotv4wgj30yg0idjsx.jpg
" alt="â€œç¥ç»éªšæ ‹â€/"></p>
<p><br></p>
<h4 id="å®Œæˆä¸Šé¢çš„è®¾ç½®ä¹‹å-æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå•ä¾‹ç±»XMPPManager-ç”¨å®ƒæ¥åˆ›å»ºé€šè®¯é€šé“å®ç°ä¸Šé¢çš„å››ä¸ªåŠŸèƒ½"><a href="#å®Œæˆä¸Šé¢çš„è®¾ç½®ä¹‹å-æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå•ä¾‹ç±»XMPPManager-ç”¨å®ƒæ¥åˆ›å»ºé€šè®¯é€šé“å®ç°ä¸Šé¢çš„å››ä¸ªåŠŸèƒ½" class="headerlink" title="å®Œæˆä¸Šé¢çš„è®¾ç½®ä¹‹å  æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå•ä¾‹ç±»XMPPManager,ç”¨å®ƒæ¥åˆ›å»ºé€šè®¯é€šé“å®ç°ä¸Šé¢çš„å››ä¸ªåŠŸèƒ½."></a>å®Œæˆä¸Šé¢çš„è®¾ç½®ä¹‹å  æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå•ä¾‹ç±»XMPPManager,ç”¨å®ƒæ¥åˆ›å»ºé€šè®¯é€šé“å®ç°ä¸Šé¢çš„å››ä¸ªåŠŸèƒ½.</h4><p>XMPPManager.hä¸­å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">#import &quot;XMPPFramework.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@interface XMPPManager : NSObject</span><br><span class="line"></span><br><span class="line">//é€šè®¯ç®¡é“</span><br><span class="line">@property(nonatomic,strong)XMPPStream *stream;</span><br><span class="line"></span><br><span class="line">//å’Œé€šè®¯å½•å¯¹è±¡å¾ˆåƒ,ç”¨æ¥ç®¡ç†å¥½å‹ç±»~</span><br><span class="line">@property(nonatomic,strong)XMPPRoster *roster;</span><br><span class="line"></span><br><span class="line">//XMPPèŠå¤©æ¶ˆæ¯æœ¬åœ°åŒ–å¤„ç†å¯¹è±¡</span><br><span class="line">@property(nonatomic,strong)XMPPMessageArchiving *messageArchiving;</span><br><span class="line"></span><br><span class="line">//æ¶ˆæ¯ä¸Šä¸‹æ–‡å¯¹è±¡</span><br><span class="line">@property(nonatomic,strong)NSManagedObjectContext *messageContext;</span><br><span class="line"></span><br><span class="line">+(instancetype)defaulManager;</span><br><span class="line"></span><br><span class="line">-(void)LoginWithUserName:(NSString *)name AndPassWord:(NSString *)password;</span><br><span class="line"></span><br><span class="line">-(void)RegiserWithUserName:(NSString *)name AndPassWord:(NSString *)password;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//ä¸æœåŠ¡å™¨æ–­å¼€é“¾æ¥</span><br><span class="line">-(void)disconnectWithServer;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="XMPPManager-hæ–‡ä»¶çš„è§£é‡Š"><a href="#XMPPManager-hæ–‡ä»¶çš„è§£é‡Š" class="headerlink" title="XMPPManager.hæ–‡ä»¶çš„è§£é‡Š:"></a>XMPPManager.hæ–‡ä»¶çš„è§£é‡Š:</h4><h5 id="stream-è¿™æ˜¯Cå’ŒSä¹‹é—´çš„é€šè®¯é€šé“"><a href="#stream-è¿™æ˜¯Cå’ŒSä¹‹é—´çš„é€šè®¯é€šé“" class="headerlink" title="stream : è¿™æ˜¯Cå’ŒSä¹‹é—´çš„é€šè®¯é€šé“."></a>stream : è¿™æ˜¯Cå’ŒSä¹‹é—´çš„é€šè®¯é€šé“.</h5><h5 id="roster-è¿™ä¸ªå±æ€§ç®¡ç†å¥½å‹åˆ—è¡¨çš„ä¸€ä¸ªå±æ€§"><a href="#roster-è¿™ä¸ªå±æ€§ç®¡ç†å¥½å‹åˆ—è¡¨çš„ä¸€ä¸ªå±æ€§" class="headerlink" title="roster : è¿™ä¸ªå±æ€§ç®¡ç†å¥½å‹åˆ—è¡¨çš„ä¸€ä¸ªå±æ€§."></a>roster : è¿™ä¸ªå±æ€§ç®¡ç†å¥½å‹åˆ—è¡¨çš„ä¸€ä¸ªå±æ€§.</h5><h5 id="messageArchiving-è¿™ä¸ªå±æ€§ç”¨æ¥ç®¡ç†æœ¬åœ°èŠå¤©è®°å½•çš„ä¸€ä¸ªç±»"><a href="#messageArchiving-è¿™ä¸ªå±æ€§ç”¨æ¥ç®¡ç†æœ¬åœ°èŠå¤©è®°å½•çš„ä¸€ä¸ªç±»" class="headerlink" title="messageArchiving : è¿™ä¸ªå±æ€§ç”¨æ¥ç®¡ç†æœ¬åœ°èŠå¤©è®°å½•çš„ä¸€ä¸ªç±»"></a>messageArchiving : è¿™ä¸ªå±æ€§ç”¨æ¥ç®¡ç†æœ¬åœ°èŠå¤©è®°å½•çš„ä¸€ä¸ªç±»</h5><h5 id="messageContext-æ¶ˆæ¯ä¸Šä¸‹æ–‡å¯¹è±¡"><a href="#messageContext-æ¶ˆæ¯ä¸Šä¸‹æ–‡å¯¹è±¡" class="headerlink" title="messageContext : æ¶ˆæ¯ä¸Šä¸‹æ–‡å¯¹è±¡."></a>messageContext : æ¶ˆæ¯ä¸Šä¸‹æ–‡å¯¹è±¡.</h5><h5 id="instancetype-defaulManager-åˆ›å»ºå•ä¾‹çš„æ–¹æ³•"><a href="#instancetype-defaulManager-åˆ›å»ºå•ä¾‹çš„æ–¹æ³•" class="headerlink" title="+(instancetype)defaulManager:åˆ›å»ºå•ä¾‹çš„æ–¹æ³•"></a>+(instancetype)defaulManager:åˆ›å»ºå•ä¾‹çš„æ–¹æ³•</h5><h5 id="void-LoginWithUserName-NSString-name-AndPassWord-NSString-password-ç™»å½•çš„æ–¹æ³•"><a href="#void-LoginWithUserName-NSString-name-AndPassWord-NSString-password-ç™»å½•çš„æ–¹æ³•" class="headerlink" title="-(void)LoginWithUserName:(NSString )name AndPassWord:(NSString )password : ç™»å½•çš„æ–¹æ³•"></a>-(void)LoginWithUserName:(NSString <em>)name AndPassWord:(NSString </em>)password : ç™»å½•çš„æ–¹æ³•</h5><h5 id="void-RegiserWithUserName-NSString-name-AndPassWord-NSString-password-æ³¨å†Œæ–°è´¦å·çš„æ–¹æ³•"><a href="#void-RegiserWithUserName-NSString-name-AndPassWord-NSString-password-æ³¨å†Œæ–°è´¦å·çš„æ–¹æ³•" class="headerlink" title="-(void)RegiserWithUserName:(NSString )name AndPassWord:(NSString )password : æ³¨å†Œæ–°è´¦å·çš„æ–¹æ³•"></a>-(void)RegiserWithUserName:(NSString <em>)name AndPassWord:(NSString </em>)password : æ³¨å†Œæ–°è´¦å·çš„æ–¹æ³•</h5><h5 id="void-disconnectWithServer-ä¸æœåŠ¡å™¨æ–­å¼€é“¾æ¥"><a href="#void-disconnectWithServer-ä¸æœåŠ¡å™¨æ–­å¼€é“¾æ¥" class="headerlink" title="-(void)disconnectWithServer;  ä¸æœåŠ¡å™¨æ–­å¼€é“¾æ¥"></a>-(void)disconnectWithServer;  ä¸æœåŠ¡å™¨æ–­å¼€é“¾æ¥</h5></blockquote>
<p></p>
<h4 id="äº†è§£å®Œå„ä¸ªæ–¹æ³•ä¹‹å-æˆ‘ä»¬å°±è¦åœ¨XMPPManager-må®ç°ä¸€ä¸‹-å®ç°å¦‚ä¸‹"><a href="#äº†è§£å®Œå„ä¸ªæ–¹æ³•ä¹‹å-æˆ‘ä»¬å°±è¦åœ¨XMPPManager-må®ç°ä¸€ä¸‹-å®ç°å¦‚ä¸‹" class="headerlink" title="äº†è§£å®Œå„ä¸ªæ–¹æ³•ä¹‹å,æˆ‘ä»¬å°±è¦åœ¨XMPPManager.må®ç°ä¸€ä¸‹,å®ç°å¦‚ä¸‹"></a>äº†è§£å®Œå„ä¸ªæ–¹æ³•ä¹‹å,æˆ‘ä»¬å°±è¦åœ¨XMPPManager.må®ç°ä¸€ä¸‹,å®ç°å¦‚ä¸‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#import &quot;XMPPManager.h&quot;</span><br><span class="line"></span><br><span class="line">//ä»£è¡¨ä¸æœåŠ¡å™¨è¿›è¡Œè¿æ¥çš„ç±»å‹.</span><br><span class="line">typedef enum : NSUInteger &#123;</span><br><span class="line">    DoLgin,</span><br><span class="line">    DORegiser,</span><br><span class="line">&#125; ConnetType;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@interface XMPPManager()&lt;XMPPStreamDelegate,XMPPRosterDelegate,XMPPMessageArchivingStorage&gt;</span><br><span class="line"></span><br><span class="line">@property(nonatomic,strong)NSString *password;</span><br><span class="line"></span><br><span class="line">@property(nonatomic,strong)NSString *regiserPassword;</span><br><span class="line"></span><br><span class="line">//å£°æ˜ä¸€ä¸ªå±æ€§ è®°å½•è¿æ¥çš„ç±»å‹</span><br><span class="line">@property(nonatomic,assign)ConnetType type;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@implementation XMPPManager</span><br><span class="line"></span><br><span class="line">static XMPPManager *manager;</span><br><span class="line"></span><br><span class="line">+(instancetype)defaulManager&#123;</span><br><span class="line"></span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        </span><br><span class="line">        manager  = [[XMPPManager alloc]init];</span><br><span class="line">        </span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    return manager;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-(instancetype)init&#123;</span><br><span class="line"></span><br><span class="line">    if (self = [super init]) &#123;</span><br><span class="line">        </span><br><span class="line">        self.stream = [[XMPPStream alloc]init];</span><br><span class="line">        self.stream.hostName = kHostName;</span><br><span class="line">        self.stream.hostPort = kHostPort;</span><br><span class="line">        //è®¾ç½®streamçš„ä»£ç†</span><br><span class="line">        [self.stream addDelegate:self delegateQueue:dispatch_get_main_queue()];</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        //ä¸‹é¢è¿™ä¸€å †å…¶å®æ˜¯å¯¹rosterå¯¹è±¡è¿›è¡Œåˆå§‹åŒ–.</span><br><span class="line">        //ç³»ç»Ÿå†™å¥½çš„XMPPå­˜å‚¨å¯¹è±¡</span><br><span class="line">        XMPPRosterCoreDataStorage *dataStorage = [XMPPRosterCoreDataStorage sharedInstance];</span><br><span class="line">        </span><br><span class="line">        self.roster = [[XMPPRoster alloc]initWithRosterStorage:dataStorage dispatchQueue:dispatch_get_global_queue(0, 0)];</span><br><span class="line">        </span><br><span class="line">        //æ¿€æ´»roster</span><br><span class="line">        [self.roster activate:self.stream];</span><br><span class="line">        </span><br><span class="line">        //ç»™rosterå¯¹è±¡æŒ‡å®šä»£ç†</span><br><span class="line">        [self.roster addDelegate:self delegateQueue:dispatch_get_main_queue()];</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        //åˆå§‹åŒ–èŠå¤©è®°å½•ç®¡ç†å¯¹è±¡</span><br><span class="line">        </span><br><span class="line">        XMPPMessageArchivingCoreDataStorage  *messageArchivingCoreDataStorage= [XMPPMessageArchivingCoreDataStorage sharedInstance];</span><br><span class="line">        </span><br><span class="line">        self.messageArchiving = [[XMPPMessageArchiving alloc]initWithMessageArchivingStorage:messageArchivingCoreDataStorage dispatchQueue:dispatch_get_main_queue()];</span><br><span class="line">        </span><br><span class="line">        //æ¿€æ´»ç®¡ç†å¯¹è±¡</span><br><span class="line">        [self.messageArchiving activate:self.stream];</span><br><span class="line">        </span><br><span class="line">        //è®¾ç½®ç®¡ç†å¯¹è±¡ä»£ç†</span><br><span class="line">        [self.messageArchiving addDelegate:self delegateQueue:dispatch_get_main_queue()];</span><br><span class="line">        </span><br><span class="line">        self.messageContext = messageArchivingCoreDataStorage.mainThreadManagedObjectContext;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return self;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//ä¸æœåŠ¡å™¨çš„å»ºç«‹é“¾æ¥</span><br><span class="line">-(void)connectToServerWintUser:(NSString *)name&#123;</span><br><span class="line"></span><br><span class="line">    if ([self.stream isConnected]) &#123;</span><br><span class="line">        </span><br><span class="line">        [self.stream disconnect];</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //jid jabberID,æ˜¯åŸºäºjabberåè®®çš„ç”±ç”¨æˆ·åç”Ÿæˆçš„å”¯ä¸€ID</span><br><span class="line">    self.stream.myJID = [XMPPJID jidWithUser:name domain:kDomin resource:kResource];</span><br><span class="line">    </span><br><span class="line">    NSError *error = nil;</span><br><span class="line">    </span><br><span class="line">    //ä¸æœåŠ¡å™¨å»ºç«‹é“¾æ¥.</span><br><span class="line">    [self.stream connectWithTimeout:30.0f error:&amp;error];</span><br><span class="line">    </span><br><span class="line">    if (error != nil) &#123;</span><br><span class="line">        </span><br><span class="line">        @throw [NSException exceptionWithName:@&quot;CQ_Error&quot; reason:@&quot;ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥å¤±è´¥,è¯·æŸ¥çœ‹ä»£ç &quot; userInfo:nil];</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//ä¸æœåŠ¡å™¨æ–­å¼€é“¾æ¥</span><br><span class="line">-(void)disconnectWithServer&#123;</span><br><span class="line">    </span><br><span class="line">    [self.stream disconnect];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)LoginWithUserName:(NSString *)name AndPassWord:(NSString *)password&#123;</span><br><span class="line"></span><br><span class="line">    self.password = password;</span><br><span class="line">    </span><br><span class="line">    self.type = DoLgin;</span><br><span class="line"></span><br><span class="line">    [self connectToServerWintUser:name];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥</span><br><span class="line">-(void)xmppStreamDidConnect:(XMPPStream *)sender&#123;</span><br><span class="line"></span><br><span class="line">    NSLog(@&quot;ä¸æœåŠ¡å™¨å»ºç«‹é“¾æ¥æ­£å¸¸&quot;);</span><br><span class="line">    //ä¸æœåŠ¡å™¨è¿›è¡Œç™»å½•è®¤è¯</span><br><span class="line">    NSError *error = nil;</span><br><span class="line">    </span><br><span class="line">    switch (self.type) &#123;</span><br><span class="line">        case DoLgin:</span><br><span class="line">            [self.stream authenticateWithPassword:self.password error:&amp;error];</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            if (error != nil) &#123;</span><br><span class="line">                </span><br><span class="line">                NSLog(@&quot;è®¤è¯è¿‡ç¨‹å‡ºé”™!&quot;);</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line">            </span><br><span class="line">        case DORegiser:</span><br><span class="line">            </span><br><span class="line">            [self.stream registerWithPassword:self.regiserPassword error:&amp;error];</span><br><span class="line">            </span><br><span class="line">            if (error != nil) &#123;</span><br><span class="line">                </span><br><span class="line">                NSLog(@&quot;æ³¨å†Œè¿‡ç¨‹å‡ºé”™!&quot;);</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)xmppStreamConnectDidTimeout:(XMPPStream *)sender&#123;</span><br><span class="line"></span><br><span class="line">@throw [NSException exceptionWithName:@&quot;CQ_Error&quot; reason:@&quot;ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥è¶…æ—¶,è¯·æŸ¥çœ‹ä»£ç &quot; userInfo:nil];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)RegiserWithUserName:(NSString *)name AndPassWord:(NSString *)password&#123;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    self.type = DORegiser;</span><br><span class="line">    </span><br><span class="line">    self.regiserPassword = password;</span><br><span class="line">    </span><br><span class="line">    [self connectToServerWintUser:name];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="çœ‹å®Œäº†ä¸Šé¢çš„ä»£ç -è¿æˆ‘è‡ªå·±éƒ½è§‰å¾—ä¹±ä¹±çš„-æ‰€ä»¥-æˆ‘ä»¬ä¸€ä¸ªåŠŸèƒ½ä¸€ä¸ªåŠŸèƒ½çœ‹è¿™äº›ä»£ç çš„å®ç°åŸç†"><a href="#çœ‹å®Œäº†ä¸Šé¢çš„ä»£ç -è¿æˆ‘è‡ªå·±éƒ½è§‰å¾—ä¹±ä¹±çš„-æ‰€ä»¥-æˆ‘ä»¬ä¸€ä¸ªåŠŸèƒ½ä¸€ä¸ªåŠŸèƒ½çœ‹è¿™äº›ä»£ç çš„å®ç°åŸç†" class="headerlink" title="çœ‹å®Œäº†ä¸Šé¢çš„ä»£ç ,è¿æˆ‘è‡ªå·±éƒ½è§‰å¾—ä¹±ä¹±çš„,æ‰€ä»¥ æˆ‘ä»¬ä¸€ä¸ªåŠŸèƒ½ä¸€ä¸ªåŠŸèƒ½çœ‹è¿™äº›ä»£ç çš„å®ç°åŸç†,"></a>çœ‹å®Œäº†ä¸Šé¢çš„ä»£ç ,è¿æˆ‘è‡ªå·±éƒ½è§‰å¾—ä¹±ä¹±çš„,æ‰€ä»¥ æˆ‘ä»¬ä¸€ä¸ªåŠŸèƒ½ä¸€ä¸ªåŠŸèƒ½çœ‹è¿™äº›ä»£ç çš„å®ç°åŸç†,</h4><p><br></p>
<h2 id="ç™»å½•åŠŸèƒ½"><a href="#ç™»å½•åŠŸèƒ½" class="headerlink" title="ç™»å½•åŠŸèƒ½"></a>ç™»å½•åŠŸèƒ½</h2><hr>
<h3 id="æˆ‘ä»¬æƒ³è¦ç™»å½•æˆ‘ä»¬çš„æœåŠ¡å™¨-é¦–å…ˆè¦æœ‰æˆ‘ä»¬çš„è´¦å·å’Œå¯†ç -ç„¶åæˆ‘ä»¬å°±éœ€è¦å»ºç«‹é€šé“"><a href="#æˆ‘ä»¬æƒ³è¦ç™»å½•æˆ‘ä»¬çš„æœåŠ¡å™¨-é¦–å…ˆè¦æœ‰æˆ‘ä»¬çš„è´¦å·å’Œå¯†ç -ç„¶åæˆ‘ä»¬å°±éœ€è¦å»ºç«‹é€šé“" class="headerlink" title="æˆ‘ä»¬æƒ³è¦ç™»å½•æˆ‘ä»¬çš„æœåŠ¡å™¨,é¦–å…ˆè¦æœ‰æˆ‘ä»¬çš„è´¦å·å’Œå¯†ç ,ç„¶åæˆ‘ä»¬å°±éœ€è¦å»ºç«‹é€šé“"></a>æˆ‘ä»¬æƒ³è¦ç™»å½•æˆ‘ä»¬çš„æœåŠ¡å™¨,é¦–å…ˆè¦æœ‰æˆ‘ä»¬çš„è´¦å·å’Œå¯†ç ,ç„¶åæˆ‘ä»¬å°±éœ€è¦å»ºç«‹é€šé“</h3><p></p>
<h4 id="a-defaulManager"><a href="#a-defaulManager" class="headerlink" title="(a)defaulManager"></a>(a)<strong><em>defaulManager</em></strong></h4><p></p>
<h5 id="åˆ›å»ºå•ä¾‹è¿™ä¸ªæ–¹æ³•ä¸­å°±æ˜¯åˆ›å»ºäº†æˆ‘ä»¬çš„å•ä¾‹"><a href="#åˆ›å»ºå•ä¾‹è¿™ä¸ªæ–¹æ³•ä¸­å°±æ˜¯åˆ›å»ºäº†æˆ‘ä»¬çš„å•ä¾‹" class="headerlink" title="åˆ›å»ºå•ä¾‹è¿™ä¸ªæ–¹æ³•ä¸­å°±æ˜¯åˆ›å»ºäº†æˆ‘ä»¬çš„å•ä¾‹."></a>åˆ›å»ºå•ä¾‹è¿™ä¸ªæ–¹æ³•ä¸­å°±æ˜¯åˆ›å»ºäº†æˆ‘ä»¬çš„å•ä¾‹.</h5><p></p>
<h4 id="b-init"><a href="#b-init" class="headerlink" title="(b)init"></a>(b)<strong><em>init</em></strong></h4><p></p>
<h5 id="åˆå§‹åŒ–è¿™ä¸ªæ–¹æ³•ä¸­æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„é€šè®¯ç®¡é“å±æ€§streamè¿›è¡Œåˆå§‹åŒ–ä¸€ä¸‹-è®¾ç½®streamæœåŠ¡å™¨IPåœ°å€å’ŒæœåŠ¡å™¨ç«¯å£-è¿˜æœ‰å°±æ˜¯è®¾ç½®streamçš„ä»£ç†å¯¹è±¡-å®ç°XMPPStreamDelegateåè®®æ–¹æ³•-è¿™é‡Œè®¾ç½®ä»£ç†å¯¹è±¡çš„æ–¹æ³•ä¸åŒäºä»¥å‰-è¿™é‡Œæ˜¯ä½¿ç”¨runtimeè®¾è®¡æ¨¡å¼å¯ä»¥ä¸ºstreamè®¾ç½®å¤šä¸ªä»£ç†å¯¹è±¡"><a href="#åˆå§‹åŒ–è¿™ä¸ªæ–¹æ³•ä¸­æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„é€šè®¯ç®¡é“å±æ€§streamè¿›è¡Œåˆå§‹åŒ–ä¸€ä¸‹-è®¾ç½®streamæœåŠ¡å™¨IPåœ°å€å’ŒæœåŠ¡å™¨ç«¯å£-è¿˜æœ‰å°±æ˜¯è®¾ç½®streamçš„ä»£ç†å¯¹è±¡-å®ç°XMPPStreamDelegateåè®®æ–¹æ³•-è¿™é‡Œè®¾ç½®ä»£ç†å¯¹è±¡çš„æ–¹æ³•ä¸åŒäºä»¥å‰-è¿™é‡Œæ˜¯ä½¿ç”¨runtimeè®¾è®¡æ¨¡å¼å¯ä»¥ä¸ºstreamè®¾ç½®å¤šä¸ªä»£ç†å¯¹è±¡" class="headerlink" title="åˆå§‹åŒ–è¿™ä¸ªæ–¹æ³•ä¸­æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„é€šè®¯ç®¡é“å±æ€§streamè¿›è¡Œåˆå§‹åŒ–ä¸€ä¸‹,è®¾ç½®streamæœåŠ¡å™¨IPåœ°å€å’ŒæœåŠ¡å™¨ç«¯å£,è¿˜æœ‰å°±æ˜¯è®¾ç½®streamçš„ä»£ç†å¯¹è±¡.å®ç°XMPPStreamDelegateåè®®æ–¹æ³•.è¿™é‡Œè®¾ç½®ä»£ç†å¯¹è±¡çš„æ–¹æ³•ä¸åŒäºä»¥å‰,è¿™é‡Œæ˜¯ä½¿ç”¨runtimeè®¾è®¡æ¨¡å¼å¯ä»¥ä¸ºstreamè®¾ç½®å¤šä¸ªä»£ç†å¯¹è±¡."></a>åˆå§‹åŒ–è¿™ä¸ªæ–¹æ³•ä¸­æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„é€šè®¯ç®¡é“å±æ€§streamè¿›è¡Œåˆå§‹åŒ–ä¸€ä¸‹,è®¾ç½®streamæœåŠ¡å™¨IPåœ°å€å’ŒæœåŠ¡å™¨ç«¯å£,è¿˜æœ‰å°±æ˜¯è®¾ç½®streamçš„ä»£ç†å¯¹è±¡.å®ç°XMPPStreamDelegateåè®®æ–¹æ³•.è¿™é‡Œè®¾ç½®ä»£ç†å¯¹è±¡çš„æ–¹æ³•ä¸åŒäºä»¥å‰,è¿™é‡Œæ˜¯ä½¿ç”¨runtimeè®¾è®¡æ¨¡å¼å¯ä»¥ä¸ºstreamè®¾ç½®å¤šä¸ªä»£ç†å¯¹è±¡.</h5><p></p>
<h4 id="c-LoginWithUserName-NSString-name-AndPassWord-NSString-password"><a href="#c-LoginWithUserName-NSString-name-AndPassWord-NSString-password" class="headerlink" title="(c)LoginWithUserName:(NSString )name AndPassWord:(NSString )password"></a>(c)<strong><em>LoginWithUserName:(NSString </em>)name AndPassWord:(NSString <em>)password</em></strong></h4><p></p>
<h5 id="è¿™ä¸ªæ–¹æ³•ä¸­é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¿å­˜æˆ‘ä»¬çš„å¯†ç -ç”¨äºä¼ å€¼åˆ°ä¸‹ä¸€ä¸ªæ–¹æ³•ä¸­-self-type-DoLgin-è¿™å¥ä»£ç æœ‰ä½œä½•è§£é‡Šå‘¢-å› ä¸ºä¸ç®¡æ˜¯ç™»å½•å’Œæ³¨å†Œ-æˆ‘ä»¬éƒ½è¦ä¸æˆ‘ä»¬çš„æœåŠ¡å™¨åˆ›å»ºè”ç³»-é‚£ä¹ˆæœåŠ¡å™¨æ˜¯å¦‚ä½•çŸ¥é“æˆ‘ä»¬æ˜¯åˆ›å»ºçš„ä»€ä¹ˆè”ç³»çš„å‘¢-å°±æ˜¯é€šè¿‡è¿™å¥ä»£ç å®ç°çš„-å½“ç„¶äº†-ç°åœ¨ä½ å¯èƒ½å¬å¾—ç³Šæ¶‚-å½“çœ‹åˆ°ä¸‹é¢çš„æ–¹æ³•çš„æ—¶å€™ä½ å°±æ˜ç™½äº†-self-connectToServerWintUser-name-è¿™å¥ä»£ç å°±æ˜¯è¦åˆ›å»ºäºæœåŠ¡å™¨ä¹‹é—´çš„è”ç³»-è¿™æ—¶å€™-è´¦å·nameå°±é€šè¿‡å‚æ•°çš„å½¢å¼ä¼ åˆ°äº†connectToServerWintUserè¿™ä¸ªå‡½æ•°-è€Œpasswordé€šè¿‡å±æ€§çš„ä¼ å€¼åˆ°xmppStreamDidConnect-å½“å®Œæˆé€šé“çš„å»ºç«‹çš„æ—¶å€™æ‰§è¡Œçš„ä»£ç†æ–¹æ³•"><a href="#è¿™ä¸ªæ–¹æ³•ä¸­é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¿å­˜æˆ‘ä»¬çš„å¯†ç -ç”¨äºä¼ å€¼åˆ°ä¸‹ä¸€ä¸ªæ–¹æ³•ä¸­-self-type-DoLgin-è¿™å¥ä»£ç æœ‰ä½œä½•è§£é‡Šå‘¢-å› ä¸ºä¸ç®¡æ˜¯ç™»å½•å’Œæ³¨å†Œ-æˆ‘ä»¬éƒ½è¦ä¸æˆ‘ä»¬çš„æœåŠ¡å™¨åˆ›å»ºè”ç³»-é‚£ä¹ˆæœåŠ¡å™¨æ˜¯å¦‚ä½•çŸ¥é“æˆ‘ä»¬æ˜¯åˆ›å»ºçš„ä»€ä¹ˆè”ç³»çš„å‘¢-å°±æ˜¯é€šè¿‡è¿™å¥ä»£ç å®ç°çš„-å½“ç„¶äº†-ç°åœ¨ä½ å¯èƒ½å¬å¾—ç³Šæ¶‚-å½“çœ‹åˆ°ä¸‹é¢çš„æ–¹æ³•çš„æ—¶å€™ä½ å°±æ˜ç™½äº†-self-connectToServerWintUser-name-è¿™å¥ä»£ç å°±æ˜¯è¦åˆ›å»ºäºæœåŠ¡å™¨ä¹‹é—´çš„è”ç³»-è¿™æ—¶å€™-è´¦å·nameå°±é€šè¿‡å‚æ•°çš„å½¢å¼ä¼ åˆ°äº†connectToServerWintUserè¿™ä¸ªå‡½æ•°-è€Œpasswordé€šè¿‡å±æ€§çš„ä¼ å€¼åˆ°xmppStreamDidConnect-å½“å®Œæˆé€šé“çš„å»ºç«‹çš„æ—¶å€™æ‰§è¡Œçš„ä»£ç†æ–¹æ³•" class="headerlink" title="è¿™ä¸ªæ–¹æ³•ä¸­é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¿å­˜æˆ‘ä»¬çš„å¯†ç ,ç”¨äºä¼ å€¼åˆ°ä¸‹ä¸€ä¸ªæ–¹æ³•ä¸­.self.type = DoLgin;è¿™å¥ä»£ç æœ‰ä½œä½•è§£é‡Šå‘¢?å› ä¸ºä¸ç®¡æ˜¯ç™»å½•å’Œæ³¨å†Œ,æˆ‘ä»¬éƒ½è¦ä¸æˆ‘ä»¬çš„æœåŠ¡å™¨åˆ›å»ºè”ç³»,é‚£ä¹ˆæœåŠ¡å™¨æ˜¯å¦‚ä½•çŸ¥é“æˆ‘ä»¬æ˜¯åˆ›å»ºçš„ä»€ä¹ˆè”ç³»çš„å‘¢?å°±æ˜¯é€šè¿‡è¿™å¥ä»£ç å®ç°çš„,å½“ç„¶äº†,ç°åœ¨ä½ å¯èƒ½å¬å¾—ç³Šæ¶‚,å½“çœ‹åˆ°ä¸‹é¢çš„æ–¹æ³•çš„æ—¶å€™ä½ å°±æ˜ç™½äº†.[self connectToServerWintUser:name];è¿™å¥ä»£ç å°±æ˜¯è¦åˆ›å»ºäºæœåŠ¡å™¨ä¹‹é—´çš„è”ç³».è¿™æ—¶å€™,è´¦å·nameå°±é€šè¿‡å‚æ•°çš„å½¢å¼ä¼ åˆ°äº†connectToServerWintUserè¿™ä¸ªå‡½æ•°,è€Œpasswordé€šè¿‡å±æ€§çš„ä¼ å€¼åˆ°xmppStreamDidConnect(å½“å®Œæˆé€šé“çš„å»ºç«‹çš„æ—¶å€™æ‰§è¡Œçš„ä»£ç†æ–¹æ³•)."></a>è¿™ä¸ªæ–¹æ³•ä¸­é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¿å­˜æˆ‘ä»¬çš„å¯†ç ,ç”¨äºä¼ å€¼åˆ°ä¸‹ä¸€ä¸ªæ–¹æ³•ä¸­.self.type = DoLgin;è¿™å¥ä»£ç æœ‰ä½œä½•è§£é‡Šå‘¢?å› ä¸ºä¸ç®¡æ˜¯ç™»å½•å’Œæ³¨å†Œ,æˆ‘ä»¬éƒ½è¦ä¸æˆ‘ä»¬çš„æœåŠ¡å™¨åˆ›å»ºè”ç³»,é‚£ä¹ˆæœåŠ¡å™¨æ˜¯å¦‚ä½•çŸ¥é“æˆ‘ä»¬æ˜¯åˆ›å»ºçš„ä»€ä¹ˆè”ç³»çš„å‘¢?å°±æ˜¯é€šè¿‡è¿™å¥ä»£ç å®ç°çš„,å½“ç„¶äº†,ç°åœ¨ä½ å¯èƒ½å¬å¾—ç³Šæ¶‚,å½“çœ‹åˆ°ä¸‹é¢çš„æ–¹æ³•çš„æ—¶å€™ä½ å°±æ˜ç™½äº†.[self connectToServerWintUser:name];è¿™å¥ä»£ç å°±æ˜¯è¦åˆ›å»ºäºæœåŠ¡å™¨ä¹‹é—´çš„è”ç³».è¿™æ—¶å€™,è´¦å·nameå°±é€šè¿‡å‚æ•°çš„å½¢å¼ä¼ åˆ°äº†connectToServerWintUserè¿™ä¸ªå‡½æ•°,è€Œpasswordé€šè¿‡å±æ€§çš„ä¼ å€¼åˆ°xmppStreamDidConnect(å½“å®Œæˆé€šé“çš„å»ºç«‹çš„æ—¶å€™æ‰§è¡Œçš„ä»£ç†æ–¹æ³•).</h5><p></p>
<h4 id="d-connectToServerWintUser"><a href="#d-connectToServerWintUser" class="headerlink" title="(d)connectToServerWintUser"></a>(d)<strong><em>connectToServerWintUser</em></strong></h4><p></p>
<h5 id="self-stream-disconnect-è¿™å¥ä»£ç å°±æ˜¯è®©å®¢æˆ·ç«¯æ–­å¼€è¿æ¥é€šé“-ç»¼åˆä¸Šé¢æ¥çœ‹-å½“æˆ‘ä»¬å·²ç»å­˜åœ¨çš„è¿æ¥çš„é€šé“çš„æ—¶å€™-æˆ‘ä»¬å°±ä¼šè®©é€šé“æ–­å¼€-è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢-å› ä¸ºCä¸Sä¹‹é—´çš„é€šé“åªèƒ½åˆ›å»ºä¸€æ¡-å½“æˆ‘ä»¬é‡å¤åˆ›å»ºçš„æ—¶å€™-å°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºå´©æºƒ-æ‰€ä»¥æˆ‘ä»¬è¦ä¿éšœæˆ‘ä»¬çš„é€šé“æ˜¯åªæœ‰ä¸€æ¡çš„-self-stream-connectWithTimeout-30-0f-error-amp-error-è¿™å¥ä»£ç å°±æ˜¯æˆ‘ä»¬åˆ›å»ºé€šé“-å½“ç„¶äº†ç­‰å¾…æ—¶é—´æ˜¯30ç§’"><a href="#self-stream-disconnect-è¿™å¥ä»£ç å°±æ˜¯è®©å®¢æˆ·ç«¯æ–­å¼€è¿æ¥é€šé“-ç»¼åˆä¸Šé¢æ¥çœ‹-å½“æˆ‘ä»¬å·²ç»å­˜åœ¨çš„è¿æ¥çš„é€šé“çš„æ—¶å€™-æˆ‘ä»¬å°±ä¼šè®©é€šé“æ–­å¼€-è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢-å› ä¸ºCä¸Sä¹‹é—´çš„é€šé“åªèƒ½åˆ›å»ºä¸€æ¡-å½“æˆ‘ä»¬é‡å¤åˆ›å»ºçš„æ—¶å€™-å°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºå´©æºƒ-æ‰€ä»¥æˆ‘ä»¬è¦ä¿éšœæˆ‘ä»¬çš„é€šé“æ˜¯åªæœ‰ä¸€æ¡çš„-self-stream-connectWithTimeout-30-0f-error-amp-error-è¿™å¥ä»£ç å°±æ˜¯æˆ‘ä»¬åˆ›å»ºé€šé“-å½“ç„¶äº†ç­‰å¾…æ—¶é—´æ˜¯30ç§’" class="headerlink" title="[self.stream disconnect];è¿™å¥ä»£ç å°±æ˜¯è®©å®¢æˆ·ç«¯æ–­å¼€è¿æ¥é€šé“,ç»¼åˆä¸Šé¢æ¥çœ‹,å½“æˆ‘ä»¬å·²ç»å­˜åœ¨çš„è¿æ¥çš„é€šé“çš„æ—¶å€™,æˆ‘ä»¬å°±ä¼šè®©é€šé“æ–­å¼€,è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢?å› ä¸ºCä¸Sä¹‹é—´çš„é€šé“åªèƒ½åˆ›å»ºä¸€æ¡,å½“æˆ‘ä»¬é‡å¤åˆ›å»ºçš„æ—¶å€™,å°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºå´©æºƒ.æ‰€ä»¥æˆ‘ä»¬è¦ä¿éšœæˆ‘ä»¬çš„é€šé“æ˜¯åªæœ‰ä¸€æ¡çš„.    [self.stream connectWithTimeout:30.0f error:&amp;error];è¿™å¥ä»£ç å°±æ˜¯æˆ‘ä»¬åˆ›å»ºé€šé“,å½“ç„¶äº†ç­‰å¾…æ—¶é—´æ˜¯30ç§’."></a>[self.stream disconnect];è¿™å¥ä»£ç å°±æ˜¯è®©å®¢æˆ·ç«¯æ–­å¼€è¿æ¥é€šé“,ç»¼åˆä¸Šé¢æ¥çœ‹,å½“æˆ‘ä»¬å·²ç»å­˜åœ¨çš„è¿æ¥çš„é€šé“çš„æ—¶å€™,æˆ‘ä»¬å°±ä¼šè®©é€šé“æ–­å¼€,è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢?å› ä¸ºCä¸Sä¹‹é—´çš„é€šé“åªèƒ½åˆ›å»ºä¸€æ¡,å½“æˆ‘ä»¬é‡å¤åˆ›å»ºçš„æ—¶å€™,å°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºå´©æºƒ.æ‰€ä»¥æˆ‘ä»¬è¦ä¿éšœæˆ‘ä»¬çš„é€šé“æ˜¯åªæœ‰ä¸€æ¡çš„.    [self.stream connectWithTimeout:30.0f error:&amp;error];è¿™å¥ä»£ç å°±æ˜¯æˆ‘ä»¬åˆ›å»ºé€šé“,å½“ç„¶äº†ç­‰å¾…æ—¶é—´æ˜¯30ç§’.</h5><p></p>
<h4 id="e-xmppStreamDidConnect"><a href="#e-xmppStreamDidConnect" class="headerlink" title="(e)xmppStreamDidConnect"></a>(e)<strong><em>xmppStreamDidConnect</em></strong></h4><p></p>
<h5 id="è¿™æ˜¯ä¸€ä¸ªä»£ç†çš„æ–¹æ³•-å½“æˆ‘ä»¬å®Œæˆé€šé“çš„åˆ›å»ºä¹‹å-æˆ‘ä»¬å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•-åœ¨è¿™ä¸ªä»£ç†æ–¹æ³•ä¸­æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å¯¹æˆ‘ä»¬çš„å¯†ç è¿›è¡ŒéªŒè¯-self-stream-authenticateWithPassword-self-password-error-amp-error-è¿™å°±æ˜¯ç™»å½•éªŒè¯æˆ‘ä»¬çš„å¯†ç -éªŒè¯æˆåŠŸä¹‹åå°±ä¼šè°ƒç”¨-void-xmppStreamDidAuthenticate-XMPPStream-senderè¿™ä¸ªä»£ç†æ–¹æ³•-éªŒè¯å¤±è´¥å°±ä¼šè°ƒç”¨-void-xmppStream-XMPPStream-sender-didNotAuthenticate-DDXMLElement-error-è¿™ä¸ªä»£ç†æ–¹æ³•-å½“ç„¶äº†-è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯å†™åœ¨æˆ‘ä»¬çš„ç™»å½•é¡µé¢çš„-å› ä¸ºæˆ‘ä»¬éœ€è¦å¯¹ä½¿ç”¨è€…æœ‰ä¸ªç”¨æˆ·çš„äº¤äº’ä¸æ˜¯-æ¯”å¦‚å¼¹å‡ºä¸€ä¸ªå¼¹çª—-æé†’ä¸€ä¸‹ç”¨æˆ·-xmppStreamDidConnectä¸ç®¡æ˜¯æ³¨å†Œå’Œç™»å½•éƒ½ä¼šè°ƒç”¨-æˆ‘ä»¬æ€ä¹ˆåŒºåˆ†å‘¢-æˆ‘ä»¬ç°åœ¨-mæ–‡ä»¶çš„é¡¶éƒ¨è®¾ç½®äº†ä¸€ä¸ªæšä¸¾å€¼-é€šè¿‡æšä¸¾å€¼çš„å€¼åˆ¤æ–­æˆ‘ä»¬æ‰€éœ€è¦çš„æ“ä½œ"><a href="#è¿™æ˜¯ä¸€ä¸ªä»£ç†çš„æ–¹æ³•-å½“æˆ‘ä»¬å®Œæˆé€šé“çš„åˆ›å»ºä¹‹å-æˆ‘ä»¬å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•-åœ¨è¿™ä¸ªä»£ç†æ–¹æ³•ä¸­æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å¯¹æˆ‘ä»¬çš„å¯†ç è¿›è¡ŒéªŒè¯-self-stream-authenticateWithPassword-self-password-error-amp-error-è¿™å°±æ˜¯ç™»å½•éªŒè¯æˆ‘ä»¬çš„å¯†ç -éªŒè¯æˆåŠŸä¹‹åå°±ä¼šè°ƒç”¨-void-xmppStreamDidAuthenticate-XMPPStream-senderè¿™ä¸ªä»£ç†æ–¹æ³•-éªŒè¯å¤±è´¥å°±ä¼šè°ƒç”¨-void-xmppStream-XMPPStream-sender-didNotAuthenticate-DDXMLElement-error-è¿™ä¸ªä»£ç†æ–¹æ³•-å½“ç„¶äº†-è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯å†™åœ¨æˆ‘ä»¬çš„ç™»å½•é¡µé¢çš„-å› ä¸ºæˆ‘ä»¬éœ€è¦å¯¹ä½¿ç”¨è€…æœ‰ä¸ªç”¨æˆ·çš„äº¤äº’ä¸æ˜¯-æ¯”å¦‚å¼¹å‡ºä¸€ä¸ªå¼¹çª—-æé†’ä¸€ä¸‹ç”¨æˆ·-xmppStreamDidConnectä¸ç®¡æ˜¯æ³¨å†Œå’Œç™»å½•éƒ½ä¼šè°ƒç”¨-æˆ‘ä»¬æ€ä¹ˆåŒºåˆ†å‘¢-æˆ‘ä»¬ç°åœ¨-mæ–‡ä»¶çš„é¡¶éƒ¨è®¾ç½®äº†ä¸€ä¸ªæšä¸¾å€¼-é€šè¿‡æšä¸¾å€¼çš„å€¼åˆ¤æ–­æˆ‘ä»¬æ‰€éœ€è¦çš„æ“ä½œ" class="headerlink" title="è¿™æ˜¯ä¸€ä¸ªä»£ç†çš„æ–¹æ³•,å½“æˆ‘ä»¬å®Œæˆé€šé“çš„åˆ›å»ºä¹‹å,æˆ‘ä»¬å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•,åœ¨è¿™ä¸ªä»£ç†æ–¹æ³•ä¸­æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å¯¹æˆ‘ä»¬çš„å¯†ç è¿›è¡ŒéªŒè¯.[self.stream authenticateWithPassword:self.password error:&amp;error];è¿™å°±æ˜¯ç™»å½•éªŒè¯æˆ‘ä»¬çš„å¯†ç .éªŒè¯æˆåŠŸä¹‹åå°±ä¼šè°ƒç”¨-(void)xmppStreamDidAuthenticate:(XMPPStream )senderè¿™ä¸ªä»£ç†æ–¹æ³•,éªŒè¯å¤±è´¥å°±ä¼šè°ƒç”¨-(void)xmppStream:(XMPPStream )sender didNotAuthenticate:(DDXMLElement *)error è¿™ä¸ªä»£ç†æ–¹æ³•,å½“ç„¶äº†,è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯å†™åœ¨æˆ‘ä»¬çš„ç™»å½•é¡µé¢çš„,å› ä¸ºæˆ‘ä»¬éœ€è¦å¯¹ä½¿ç”¨è€…æœ‰ä¸ªç”¨æˆ·çš„äº¤äº’ä¸æ˜¯?æ¯”å¦‚å¼¹å‡ºä¸€ä¸ªå¼¹çª—.æé†’ä¸€ä¸‹ç”¨æˆ·.xmppStreamDidConnectä¸ç®¡æ˜¯æ³¨å†Œå’Œç™»å½•éƒ½ä¼šè°ƒç”¨,æˆ‘ä»¬æ€ä¹ˆåŒºåˆ†å‘¢?æˆ‘ä»¬ç°åœ¨.mæ–‡ä»¶çš„é¡¶éƒ¨è®¾ç½®äº†ä¸€ä¸ªæšä¸¾å€¼,é€šè¿‡æšä¸¾å€¼çš„å€¼åˆ¤æ–­æˆ‘ä»¬æ‰€éœ€è¦çš„æ“ä½œ."></a>è¿™æ˜¯ä¸€ä¸ªä»£ç†çš„æ–¹æ³•,å½“æˆ‘ä»¬å®Œæˆé€šé“çš„åˆ›å»ºä¹‹å,æˆ‘ä»¬å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•,åœ¨è¿™ä¸ªä»£ç†æ–¹æ³•ä¸­æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å¯¹æˆ‘ä»¬çš„å¯†ç è¿›è¡ŒéªŒè¯.[self.stream authenticateWithPassword:self.password error:&amp;error];è¿™å°±æ˜¯ç™»å½•éªŒè¯æˆ‘ä»¬çš„å¯†ç .éªŒè¯æˆåŠŸä¹‹åå°±ä¼šè°ƒç”¨-(void)xmppStreamDidAuthenticate:(XMPPStream <em>)senderè¿™ä¸ªä»£ç†æ–¹æ³•,éªŒè¯å¤±è´¥å°±ä¼šè°ƒç”¨-(void)xmppStream:(XMPPStream </em>)sender didNotAuthenticate:(DDXMLElement *)error è¿™ä¸ªä»£ç†æ–¹æ³•,å½“ç„¶äº†,è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯å†™åœ¨æˆ‘ä»¬çš„ç™»å½•é¡µé¢çš„,å› ä¸ºæˆ‘ä»¬éœ€è¦å¯¹ä½¿ç”¨è€…æœ‰ä¸ªç”¨æˆ·çš„äº¤äº’ä¸æ˜¯?æ¯”å¦‚å¼¹å‡ºä¸€ä¸ªå¼¹çª—.æé†’ä¸€ä¸‹ç”¨æˆ·.xmppStreamDidConnectä¸ç®¡æ˜¯æ³¨å†Œå’Œç™»å½•éƒ½ä¼šè°ƒç”¨,æˆ‘ä»¬æ€ä¹ˆåŒºåˆ†å‘¢?æˆ‘ä»¬ç°åœ¨.mæ–‡ä»¶çš„é¡¶éƒ¨è®¾ç½®äº†ä¸€ä¸ªæšä¸¾å€¼,é€šè¿‡æšä¸¾å€¼çš„å€¼åˆ¤æ–­æˆ‘ä»¬æ‰€éœ€è¦çš„æ“ä½œ.</h5><p></p>
<h4 id="f-xmppStreamConnectDidTimeout"><a href="#f-xmppStreamConnectDidTimeout" class="headerlink" title="(f)xmppStreamConnectDidTimeout"></a>(f)<strong><em>xmppStreamConnectDidTimeout</em></strong></h4><p></p>
<h5 id="è¿™ä¸ªæ–¹æ³•å°±æ˜¯è¯´-å½“æˆ‘ä»¬ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥è¶…æ—¶çš„æ—¶å€™ä¼šè¿›è¡Œçš„æ“ä½œ-throw-NSException-exceptionWithName-â€CQ-Errorâ€-reason-â€ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥è¶…æ—¶-è¯·æŸ¥çœ‹ä»£ç â€-userInfo-nil-æ˜¯æˆ‘ä»¬æ‰‹åŠ¨çš„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸"><a href="#è¿™ä¸ªæ–¹æ³•å°±æ˜¯è¯´-å½“æˆ‘ä»¬ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥è¶…æ—¶çš„æ—¶å€™ä¼šè¿›è¡Œçš„æ“ä½œ-throw-NSException-exceptionWithName-â€CQ-Errorâ€-reason-â€ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥è¶…æ—¶-è¯·æŸ¥çœ‹ä»£ç â€-userInfo-nil-æ˜¯æˆ‘ä»¬æ‰‹åŠ¨çš„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸" class="headerlink" title="è¿™ä¸ªæ–¹æ³•å°±æ˜¯è¯´,å½“æˆ‘ä»¬ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥è¶…æ—¶çš„æ—¶å€™ä¼šè¿›è¡Œçš„æ“ä½œ.@throw [NSException exceptionWithName:@â€CQ_Errorâ€ reason:@â€ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥è¶…æ—¶,è¯·æŸ¥çœ‹ä»£ç â€ userInfo:nil];æ˜¯æˆ‘ä»¬æ‰‹åŠ¨çš„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸."></a>è¿™ä¸ªæ–¹æ³•å°±æ˜¯è¯´,å½“æˆ‘ä»¬ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥è¶…æ—¶çš„æ—¶å€™ä¼šè¿›è¡Œçš„æ“ä½œ.@throw [NSException exceptionWithName:@â€CQ_Errorâ€ reason:@â€ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥è¶…æ—¶,è¯·æŸ¥çœ‹ä»£ç â€ userInfo:nil];æ˜¯æˆ‘ä»¬æ‰‹åŠ¨çš„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸.</h5><hr>
<p><br></p>
<h2 id="æ³¨å†ŒåŠŸèƒ½"><a href="#æ³¨å†ŒåŠŸèƒ½" class="headerlink" title="æ³¨å†ŒåŠŸèƒ½"></a>æ³¨å†ŒåŠŸèƒ½</h2><hr>
<p>####æ³¨å†ŒåŠŸèƒ½ä¸ç™»å½•åŠŸèƒ½åœ¨å®ç°ä¸Šæ˜¯ç›¸ä¼¼çš„,ä¸‹é¢çš„å±æ€§å°±æ˜¯åŒºåˆ«çš„å¼€å§‹.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@property(nonatomic,strong)NSString *password;</span><br><span class="line"></span><br><span class="line">@property(nonatomic,strong)NSString *regiserPassword;</span><br></pre></td></tr></table></figure>
<p></p>
<h3 id="xmppStreamDidConnect"><a href="#xmppStreamDidConnect" class="headerlink" title="xmppStreamDidConnect"></a><strong><em>xmppStreamDidConnect</em></strong></h3><p></p>
<h5 id="åœ¨è¿™ä¸ªæ–¹æ³•ä¸­-æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„æ³¨å†Œæ–¹æ³•ä¸ç™»å½•æ–¹æ³•åˆ†åˆ«å¼€æ¥-self-stream-registerWithPassword-self-regiserPassword-error-amp-error-è¿™ä¸ªæ–¹æ³•å°±æ˜¯æˆ‘ä»¬æŠŠæ³¨å†Œçš„å¯†ç ä¼ åˆ°æœåŠ¡å™¨ä¸Šä¿å­˜çš„æ–¹æ³•-å½“ç„¶äº†-å½“æˆ‘ä»¬æ³¨å†ŒæˆåŠŸçš„æ—¶å€™-å°±ä¼šè°ƒåŠ¨-void-xmppStreamDidRegister-XMPPStream-senderè¿™ä¸ªåè®®æ–¹æ³•-å½“æ³¨å†Œä¸æˆåŠŸçš„æ—¶å€™-æˆ‘ä»¬å°±ä¼šè°ƒç”¨-void-xmppStream-XMPPStream-sender-didNotRegister-DDXMLElement-errorè¿™ä¸ªæ–¹æ³•-è¿™é‡Œæˆ‘ä»¬ä¹Ÿè¦æ‹ç»™æˆ‘ä»¬çš„ç”¨æˆ·ä¸€äº›äº¤äº’-è®©æˆ‘ä»¬ç”¨æˆ·çŸ¥é“è‡ªå·±æ³¨å†Œçš„ç»“æœ"><a href="#åœ¨è¿™ä¸ªæ–¹æ³•ä¸­-æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„æ³¨å†Œæ–¹æ³•ä¸ç™»å½•æ–¹æ³•åˆ†åˆ«å¼€æ¥-self-stream-registerWithPassword-self-regiserPassword-error-amp-error-è¿™ä¸ªæ–¹æ³•å°±æ˜¯æˆ‘ä»¬æŠŠæ³¨å†Œçš„å¯†ç ä¼ åˆ°æœåŠ¡å™¨ä¸Šä¿å­˜çš„æ–¹æ³•-å½“ç„¶äº†-å½“æˆ‘ä»¬æ³¨å†ŒæˆåŠŸçš„æ—¶å€™-å°±ä¼šè°ƒåŠ¨-void-xmppStreamDidRegister-XMPPStream-senderè¿™ä¸ªåè®®æ–¹æ³•-å½“æ³¨å†Œä¸æˆåŠŸçš„æ—¶å€™-æˆ‘ä»¬å°±ä¼šè°ƒç”¨-void-xmppStream-XMPPStream-sender-didNotRegister-DDXMLElement-errorè¿™ä¸ªæ–¹æ³•-è¿™é‡Œæˆ‘ä»¬ä¹Ÿè¦æ‹ç»™æˆ‘ä»¬çš„ç”¨æˆ·ä¸€äº›äº¤äº’-è®©æˆ‘ä»¬ç”¨æˆ·çŸ¥é“è‡ªå·±æ³¨å†Œçš„ç»“æœ" class="headerlink" title="åœ¨è¿™ä¸ªæ–¹æ³•ä¸­,æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„æ³¨å†Œæ–¹æ³•ä¸ç™»å½•æ–¹æ³•åˆ†åˆ«å¼€æ¥.            [self.stream registerWithPassword:self.regiserPassword error:&amp;error];è¿™ä¸ªæ–¹æ³•å°±æ˜¯æˆ‘ä»¬æŠŠæ³¨å†Œçš„å¯†ç ä¼ åˆ°æœåŠ¡å™¨ä¸Šä¿å­˜çš„æ–¹æ³•.å½“ç„¶äº†,å½“æˆ‘ä»¬æ³¨å†ŒæˆåŠŸçš„æ—¶å€™,å°±ä¼šè°ƒåŠ¨-(void)xmppStreamDidRegister:(XMPPStream )senderè¿™ä¸ªåè®®æ–¹æ³•,å½“æ³¨å†Œä¸æˆåŠŸçš„æ—¶å€™,æˆ‘ä»¬å°±ä¼šè°ƒç”¨-(void)xmppStream:(XMPPStream )sender didNotRegister:(DDXMLElement *)errorè¿™ä¸ªæ–¹æ³•.è¿™é‡Œæˆ‘ä»¬ä¹Ÿè¦æ‹ç»™æˆ‘ä»¬çš„ç”¨æˆ·ä¸€äº›äº¤äº’,è®©æˆ‘ä»¬ç”¨æˆ·çŸ¥é“è‡ªå·±æ³¨å†Œçš„ç»“æœ."></a>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­,æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„æ³¨å†Œæ–¹æ³•ä¸ç™»å½•æ–¹æ³•åˆ†åˆ«å¼€æ¥.            [self.stream registerWithPassword:self.regiserPassword error:&amp;error];è¿™ä¸ªæ–¹æ³•å°±æ˜¯æˆ‘ä»¬æŠŠæ³¨å†Œçš„å¯†ç ä¼ åˆ°æœåŠ¡å™¨ä¸Šä¿å­˜çš„æ–¹æ³•.å½“ç„¶äº†,å½“æˆ‘ä»¬æ³¨å†ŒæˆåŠŸçš„æ—¶å€™,å°±ä¼šè°ƒåŠ¨-(void)xmppStreamDidRegister:(XMPPStream <em>)senderè¿™ä¸ªåè®®æ–¹æ³•,å½“æ³¨å†Œä¸æˆåŠŸçš„æ—¶å€™,æˆ‘ä»¬å°±ä¼šè°ƒç”¨-(void)xmppStream:(XMPPStream </em>)sender didNotRegister:(DDXMLElement *)errorè¿™ä¸ªæ–¹æ³•.è¿™é‡Œæˆ‘ä»¬ä¹Ÿè¦æ‹ç»™æˆ‘ä»¬çš„ç”¨æˆ·ä¸€äº›äº¤äº’,è®©æˆ‘ä»¬ç”¨æˆ·çŸ¥é“è‡ªå·±æ³¨å†Œçš„ç»“æœ.</h5><hr>
<p><br></p>
<h2 id="å¥½å‹åˆ—è¡¨åŠŸèƒ½"><a href="#å¥½å‹åˆ—è¡¨åŠŸèƒ½" class="headerlink" title="å¥½å‹åˆ—è¡¨åŠŸèƒ½"></a>å¥½å‹åˆ—è¡¨åŠŸèƒ½</h2><hr>
<h4 id="åœ¨XMPPManager-mæ–‡ä»¶ä¸­-æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åœ¨-init-æ–¹æ³•ä¸­å¯¹ç®¡ç†å¥½å‹åˆ—è¡¨çš„rosterå¯¹è±¡è¿›è¡Œä¸€ä¸‹åˆå§‹åŒ–å¹¶ä¸”åˆ¶å®šä»£ç†-è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªåœ°æ–¹-å½“æˆ‘ä»¬è®¾ç½®rosterçš„åˆå§‹åŒ–çš„æ—¶å€™-æˆ‘ä»¬éœ€è¦ä½¿ç”¨-dispatch-get-global-queue-0-0-å…¨å±€çº¿ç¨‹-ä¸èƒ½ä½¿ç”¨ä¸»çº¿ç¨‹-åŸå› æ˜¯å¦‚æœä½¿ç”¨ä¸»çº¿ç¨‹ä¼šå‡ºç°ä¸€äº›è«åå…¶å¦™çš„Bug-self-roster-activate-self-stream-æ¿€æ´»rosterçš„æ„æ€å°±æ˜¯ç»™rosterå¯ä»¥é€šè¿‡streamé€šé“çš„æƒé™-PS-å¤§ç™½è¯-ğŸ˜‚"><a href="#åœ¨XMPPManager-mæ–‡ä»¶ä¸­-æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åœ¨-init-æ–¹æ³•ä¸­å¯¹ç®¡ç†å¥½å‹åˆ—è¡¨çš„rosterå¯¹è±¡è¿›è¡Œä¸€ä¸‹åˆå§‹åŒ–å¹¶ä¸”åˆ¶å®šä»£ç†-è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªåœ°æ–¹-å½“æˆ‘ä»¬è®¾ç½®rosterçš„åˆå§‹åŒ–çš„æ—¶å€™-æˆ‘ä»¬éœ€è¦ä½¿ç”¨-dispatch-get-global-queue-0-0-å…¨å±€çº¿ç¨‹-ä¸èƒ½ä½¿ç”¨ä¸»çº¿ç¨‹-åŸå› æ˜¯å¦‚æœä½¿ç”¨ä¸»çº¿ç¨‹ä¼šå‡ºç°ä¸€äº›è«åå…¶å¦™çš„Bug-self-roster-activate-self-stream-æ¿€æ´»rosterçš„æ„æ€å°±æ˜¯ç»™rosterå¯ä»¥é€šè¿‡streamé€šé“çš„æƒé™-PS-å¤§ç™½è¯-ğŸ˜‚" class="headerlink" title="åœ¨XMPPManager.mæ–‡ä»¶ä¸­,æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åœ¨  init  æ–¹æ³•ä¸­å¯¹ç®¡ç†å¥½å‹åˆ—è¡¨çš„rosterå¯¹è±¡è¿›è¡Œä¸€ä¸‹åˆå§‹åŒ–å¹¶ä¸”åˆ¶å®šä»£ç†,è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªåœ°æ–¹,å½“æˆ‘ä»¬è®¾ç½®rosterçš„åˆå§‹åŒ–çš„æ—¶å€™,æˆ‘ä»¬éœ€è¦ä½¿ç”¨  dispatch_get_global_queue(0, 0) å…¨å±€çº¿ç¨‹,ä¸èƒ½ä½¿ç”¨ä¸»çº¿ç¨‹,åŸå› æ˜¯å¦‚æœä½¿ç”¨ä¸»çº¿ç¨‹ä¼šå‡ºç°ä¸€äº›è«åå…¶å¦™çš„Bug.        [self.roster activate:self.stream]; æ¿€æ´»rosterçš„æ„æ€å°±æ˜¯ç»™rosterå¯ä»¥é€šè¿‡streamé€šé“çš„æƒé™..(PS:å¤§ç™½è¯ ğŸ˜‚)"></a>åœ¨XMPPManager.mæ–‡ä»¶ä¸­,æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åœ¨ <strong><em> init </em></strong> æ–¹æ³•ä¸­å¯¹ç®¡ç†å¥½å‹åˆ—è¡¨çš„rosterå¯¹è±¡è¿›è¡Œä¸€ä¸‹åˆå§‹åŒ–å¹¶ä¸”åˆ¶å®šä»£ç†,è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªåœ°æ–¹,å½“æˆ‘ä»¬è®¾ç½®rosterçš„åˆå§‹åŒ–çš„æ—¶å€™,æˆ‘ä»¬éœ€è¦ä½¿ç”¨ <strong><em> dispatch_get_global_queue(0, 0) </em></strong>å…¨å±€çº¿ç¨‹,ä¸èƒ½ä½¿ç”¨ä¸»çº¿ç¨‹,åŸå› æ˜¯å¦‚æœä½¿ç”¨ä¸»çº¿ç¨‹ä¼šå‡ºç°ä¸€äº›è«åå…¶å¦™çš„Bug.        [self.roster activate:self.stream]; æ¿€æ´»rosterçš„æ„æ€å°±æ˜¯ç»™rosterå¯ä»¥é€šè¿‡streamé€šé“çš„æƒé™..(PS:å¤§ç™½è¯ ğŸ˜‚)</h4><p><br></p>
<h4 id="åœ¨æˆ‘ä»¬çš„å¥½å‹åˆ—è¡¨é¡µé¢ä¸­-é¦–å…ˆæˆ‘ä»¬éœ€è¦ç¡®å®šä»–æ˜¯ä¸€ä¸ªUITableViewController-ç„¶åæˆ‘ä»¬éœ€è¦ä»æˆ‘ä»¬çš„æœåŠ¡å™¨æ‹¿åˆ°æˆ‘ä»¬çš„å¥½å‹çš„åˆ—è¡¨æ•°ç»„-é€šé“streamè¿æ¥åœ¨æˆ‘ä»¬çš„ç™»å½•çš„æ—¶å€™å·²ç»å®Œæˆäº†-æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å†ç®¡ç†é€šé“äº†-æˆ‘ä»¬éœ€è¦åœ¨å¥½å‹åˆ—è¡¨çš„æ§åˆ¶å™¨ä¸­å®ç°XMPPRosterDelegateçš„ä»£ç†æ–¹æ³•æ¥è·å–åˆ°æˆ‘ä»¬çš„å¥½å‹åˆ—è¡¨-ä»£ç å¦‚ä¸‹"><a href="#åœ¨æˆ‘ä»¬çš„å¥½å‹åˆ—è¡¨é¡µé¢ä¸­-é¦–å…ˆæˆ‘ä»¬éœ€è¦ç¡®å®šä»–æ˜¯ä¸€ä¸ªUITableViewController-ç„¶åæˆ‘ä»¬éœ€è¦ä»æˆ‘ä»¬çš„æœåŠ¡å™¨æ‹¿åˆ°æˆ‘ä»¬çš„å¥½å‹çš„åˆ—è¡¨æ•°ç»„-é€šé“streamè¿æ¥åœ¨æˆ‘ä»¬çš„ç™»å½•çš„æ—¶å€™å·²ç»å®Œæˆäº†-æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å†ç®¡ç†é€šé“äº†-æˆ‘ä»¬éœ€è¦åœ¨å¥½å‹åˆ—è¡¨çš„æ§åˆ¶å™¨ä¸­å®ç°XMPPRosterDelegateçš„ä»£ç†æ–¹æ³•æ¥è·å–åˆ°æˆ‘ä»¬çš„å¥½å‹åˆ—è¡¨-ä»£ç å¦‚ä¸‹" class="headerlink" title="åœ¨æˆ‘ä»¬çš„å¥½å‹åˆ—è¡¨é¡µé¢ä¸­,é¦–å…ˆæˆ‘ä»¬éœ€è¦ç¡®å®šä»–æ˜¯ä¸€ä¸ªUITableViewController,ç„¶åæˆ‘ä»¬éœ€è¦ä»æˆ‘ä»¬çš„æœåŠ¡å™¨æ‹¿åˆ°æˆ‘ä»¬çš„å¥½å‹çš„åˆ—è¡¨æ•°ç»„.é€šé“streamè¿æ¥åœ¨æˆ‘ä»¬çš„ç™»å½•çš„æ—¶å€™å·²ç»å®Œæˆäº†,æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å†ç®¡ç†é€šé“äº†,æˆ‘ä»¬éœ€è¦åœ¨å¥½å‹åˆ—è¡¨çš„æ§åˆ¶å™¨ä¸­å®ç°XMPPRosterDelegateçš„ä»£ç†æ–¹æ³•æ¥è·å–åˆ°æˆ‘ä»¬çš„å¥½å‹åˆ—è¡¨.ä»£ç å¦‚ä¸‹"></a>åœ¨æˆ‘ä»¬çš„å¥½å‹åˆ—è¡¨é¡µé¢ä¸­,é¦–å…ˆæˆ‘ä»¬éœ€è¦ç¡®å®šä»–æ˜¯ä¸€ä¸ªUITableViewController,ç„¶åæˆ‘ä»¬éœ€è¦ä»æˆ‘ä»¬çš„æœåŠ¡å™¨æ‹¿åˆ°æˆ‘ä»¬çš„å¥½å‹çš„åˆ—è¡¨æ•°ç»„.é€šé“streamè¿æ¥åœ¨æˆ‘ä»¬çš„ç™»å½•çš„æ—¶å€™å·²ç»å®Œæˆäº†,æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å†ç®¡ç†é€šé“äº†,æˆ‘ä»¬éœ€è¦åœ¨å¥½å‹åˆ—è¡¨çš„æ§åˆ¶å™¨ä¸­å®ç°XMPPRosterDelegateçš„ä»£ç†æ–¹æ³•æ¥è·å–åˆ°æˆ‘ä»¬çš„å¥½å‹åˆ—è¡¨.ä»£ç å¦‚ä¸‹</h4><p><br>åœ¨MainTableViewController.mä¸­</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#import &quot;MainTableViewController.h&quot;</span><br><span class="line"></span><br><span class="line">#import &quot;XMPPManager.h&quot;</span><br><span class="line"></span><br><span class="line">#import &quot;ChatTableViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface MainTableViewController ()&lt;XMPPRosterDelegate&gt;</span><br><span class="line"></span><br><span class="line">//ç”¨æ¥å­˜å‚¨æ‰€æœ‰çš„å¥½å‹ä¿¡æ¯çš„.</span><br><span class="line">@property(nonatomic,strong)NSMutableArray *dataArray;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation MainTableViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    self.dataArray = [NSMutableArray array];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    [[XMPPManager defaulManager].roster addDelegate:self delegateQueue:dispatch_get_main_queue()];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//rosterä»£ç†æ–¹æ³•</span><br><span class="line">//å¼€å§‹è·å–å¥½å‹åˆ—è¡¨çš„æ—¶å€™</span><br><span class="line">-(void)xmppRosterDidBeginPopulating:(XMPPRoster *)sender&#123;</span><br><span class="line"></span><br><span class="line">    NSLog(@&quot;å¼€å§‹è·å–å¥½å‹åˆ—è¡¨&quot;);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ç»“æŸè·å–å¥½å‹åˆ—è¡¨</span><br><span class="line">-(void)xmppRosterDidEndPopulating:(XMPPRoster *)sender&#123;</span><br><span class="line"></span><br><span class="line">    NSLog(@&quot;è·å–å¥½å‹åˆ—è¡¨å®Œæˆçš„æ—¶å€™.&quot;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//è·å–å¥½å‹ä¿¡æ¯çš„æ—¶å€™</span><br><span class="line">-(void)xmppRoster:(XMPPRoster *)sender didReceiveRosterItem:(DDXMLElement *)item&#123;</span><br><span class="line"></span><br><span class="line">//    //å°†æ¯ä¸€ä¸ªå¥½å‹å­˜å‚¨ä¸‹æ¥.</span><br><span class="line">//    NSLog(@&quot;%@&quot;,[item children]);</span><br><span class="line">//    </span><br><span class="line">//    NSLog(@&quot;%@&quot;,[item name]);</span><br><span class="line">    </span><br><span class="line">    NSString *SJid = [[item attributeForName:@&quot;jid&quot;] stringValue];</span><br><span class="line">    </span><br><span class="line">    //æŠŠå­—ç¬¦ä¸²ç±»å‹çš„JIDè½¬æ¢æˆXMPPJID</span><br><span class="line">    XMPPJID *jid = [XMPPJID jidWithString:SJid];</span><br><span class="line">    </span><br><span class="line">    //æŠŠJIDå­˜å‚¨åˆ°æ•°ç»„ä¸­,ç›¸å½“ä¿®æ”¹æ•°æ®æº</span><br><span class="line">    [self.dataArray addObject:jid];</span><br><span class="line">    </span><br><span class="line">    //æ›´æ–°UI</span><br><span class="line">    NSIndexPath *path = [NSIndexPath indexPathForRow:self.dataArray.count-1 inSection:0];</span><br><span class="line">    </span><br><span class="line">    [self.tableView insertRowsAtIndexPaths:@[path] withRowAnimation:UITableViewRowAnimationBottom];</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - Table view data source</span><br><span class="line"></span><br><span class="line">- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView &#123;</span><br><span class="line">    return 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section &#123;</span><br><span class="line">    return self.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    </span><br><span class="line">    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;MainCell&quot; forIndexPath:indexPath];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    //æŠŠå­—ç¬¦ä¸²ç±»å‹çš„JIDè½¬æ¢æˆXMPPJID</span><br><span class="line">    XMPPJID *jid = self.dataArray[indexPath.row];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    cell.textLabel.text = [NSString stringWithFormat:@&quot;%@    %@     %@&quot;,jid.user,jid.resource,jid.domain];</span><br><span class="line">    </span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender&#123;</span><br><span class="line"></span><br><span class="line">    UITableViewCell *cell = (UITableViewCell *)sender;</span><br><span class="line">    </span><br><span class="line">    //æ‹¿åˆ°ä¸‹ä¸€æ­¥è¦è·³è½¬çš„controllerå¯¹è±¡</span><br><span class="line">    ChatTableViewController *chatVC = segue.destinationViewController;</span><br><span class="line">    </span><br><span class="line">    //åˆ¤æ–­é€‰ä¸­çš„cellåœ¨å½“å‰çš„Tableä¸­çš„ä½ç½®</span><br><span class="line">    NSIndexPath *path = [self.tableView indexPathForCell:cell];</span><br><span class="line">    </span><br><span class="line">    chatVC.chatToJID = self.dataArray[path.row];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p></p>
<h3 id="æ–¹æ³•è§£é‡Š"><a href="#æ–¹æ³•è§£é‡Š" class="headerlink" title="æ–¹æ³•è§£é‡Š"></a>æ–¹æ³•è§£é‡Š</h3><h4 id="åœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬è¦è§£é‡Šçš„åªæœ‰ä¸¤ä¸ªæ–¹æ³•-ä¸€ä¸ªæ˜¯è·å–å¥½å‹ä¿¡æ¯çš„æ—¶å€™è°ƒç”¨çš„"><a href="#åœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬è¦è§£é‡Šçš„åªæœ‰ä¸¤ä¸ªæ–¹æ³•-ä¸€ä¸ªæ˜¯è·å–å¥½å‹ä¿¡æ¯çš„æ—¶å€™è°ƒç”¨çš„" class="headerlink" title="åœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬è¦è§£é‡Šçš„åªæœ‰ä¸¤ä¸ªæ–¹æ³• ,ä¸€ä¸ªæ˜¯è·å–å¥½å‹ä¿¡æ¯çš„æ—¶å€™è°ƒç”¨çš„"></a>åœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬è¦è§£é‡Šçš„åªæœ‰ä¸¤ä¸ªæ–¹æ³• ,ä¸€ä¸ªæ˜¯è·å–å¥½å‹ä¿¡æ¯çš„æ—¶å€™è°ƒç”¨çš„</h4><p>-(void)xmppRoster:(XMPPRoster <em>)sender didReceiveRosterItem:(DDXMLElement </em>)item</p>
<h4 id="å¦å¤–ä¸€ä¸ªæ˜¯æˆ‘ä»¬ç‚¹å‡»å¥½å‹è¿›å…¥èŠå¤©é¡µé¢æ‰€éœ€è¦çš„æ–¹æ³•"><a href="#å¦å¤–ä¸€ä¸ªæ˜¯æˆ‘ä»¬ç‚¹å‡»å¥½å‹è¿›å…¥èŠå¤©é¡µé¢æ‰€éœ€è¦çš„æ–¹æ³•" class="headerlink" title="å¦å¤–ä¸€ä¸ªæ˜¯æˆ‘ä»¬ç‚¹å‡»å¥½å‹è¿›å…¥èŠå¤©é¡µé¢æ‰€éœ€è¦çš„æ–¹æ³•."></a>å¦å¤–ä¸€ä¸ªæ˜¯æˆ‘ä»¬ç‚¹å‡»å¥½å‹è¿›å…¥èŠå¤©é¡µé¢æ‰€éœ€è¦çš„æ–¹æ³•.</h4><p>-(void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender</p>
<p></p>
<h3 id="void-xmppRoster-XMPPRoster-sender-didReceiveRosterItem-DDXMLElement-item"><a href="#void-xmppRoster-XMPPRoster-sender-didReceiveRosterItem-DDXMLElement-item" class="headerlink" title="-(void)xmppRoster:(XMPPRoster )sender didReceiveRosterItem:(DDXMLElement )item"></a><strong><em>-(void)xmppRoster:(XMPPRoster </em>)sender didReceiveRosterItem:(DDXMLElement <em>)item</em></strong></h3><p></p>
<h5 id="è¿™ä¸ªæ˜¯XMPPRosterDelegateåè®®ä¸­ä»£ç†æ–¹æ³•-å¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šçš„å¥½å‹-è¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨å¾ˆå¤šæ¬¡-çŸ¥é“æˆ‘ä»¬çš„å¥½å‹å…¨éƒ¨éå†å®Œ-NSString-SJid-item-attributeForName-â€jidâ€-stringValue-å’ŒXMPPJID-jid-XMPPJID-jidWithString-SJid-è¿™ä¸¤ä¸ªæ–¹æ³•å°±æ˜¯å½“æˆ‘ä»¬ä»æœåŠ¡å™¨æ¥åˆ°æˆ‘ä»¬çš„æ•°æ®æ—¶å€™-æˆ‘ä»¬è¦å…ˆå°†ä»–è½¬åŒ–æˆä¸€ä¸‹-è½¬æˆæˆæˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®-ç„¶åå­˜å…¥æˆ‘ä»¬çš„æ•°æ®æºæ•°ç»„ä¸­-æ›´æ–°UI-ä½¿ç”¨çš„æ–¹æ³•æ˜¯-self-tableView-insertRowsAtIndexPaths-path-withRowAnimation-UITableViewRowAnimationBottom-ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªæ–¹æ³•å‘¢-ä¸ºä»€ä¹ˆä¸ä½¿ç”¨reloadDataè¿™ä¸ªæ–¹æ³•-å› ä¸ºè¿™ä¸ªä»£ç†æ–¹æ³•ä¼šæ‰§è¡Œå¾ˆå¤šæ¬¡-æˆ‘ä»¬ä¸ºäº†é¿å…æ²¡æœ‰å¿…è¦çš„å†…å­˜è´Ÿæ‹…-æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ›´æ–°ä¸€ä¸‹æˆ‘ä»¬æœ€åä¸€æ¡æ•°æ®å°±è¡Œ-è¿™æ ·å¤§å¤§å‡å°‘äº†å†…å­˜çš„è´Ÿæ‹…-æé«˜äº†æˆ‘ä»¬çš„å·¥ç¨‹æ•ˆç‡"><a href="#è¿™ä¸ªæ˜¯XMPPRosterDelegateåè®®ä¸­ä»£ç†æ–¹æ³•-å¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šçš„å¥½å‹-è¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨å¾ˆå¤šæ¬¡-çŸ¥é“æˆ‘ä»¬çš„å¥½å‹å…¨éƒ¨éå†å®Œ-NSString-SJid-item-attributeForName-â€jidâ€-stringValue-å’ŒXMPPJID-jid-XMPPJID-jidWithString-SJid-è¿™ä¸¤ä¸ªæ–¹æ³•å°±æ˜¯å½“æˆ‘ä»¬ä»æœåŠ¡å™¨æ¥åˆ°æˆ‘ä»¬çš„æ•°æ®æ—¶å€™-æˆ‘ä»¬è¦å…ˆå°†ä»–è½¬åŒ–æˆä¸€ä¸‹-è½¬æˆæˆæˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®-ç„¶åå­˜å…¥æˆ‘ä»¬çš„æ•°æ®æºæ•°ç»„ä¸­-æ›´æ–°UI-ä½¿ç”¨çš„æ–¹æ³•æ˜¯-self-tableView-insertRowsAtIndexPaths-path-withRowAnimation-UITableViewRowAnimationBottom-ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªæ–¹æ³•å‘¢-ä¸ºä»€ä¹ˆä¸ä½¿ç”¨reloadDataè¿™ä¸ªæ–¹æ³•-å› ä¸ºè¿™ä¸ªä»£ç†æ–¹æ³•ä¼šæ‰§è¡Œå¾ˆå¤šæ¬¡-æˆ‘ä»¬ä¸ºäº†é¿å…æ²¡æœ‰å¿…è¦çš„å†…å­˜è´Ÿæ‹…-æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ›´æ–°ä¸€ä¸‹æˆ‘ä»¬æœ€åä¸€æ¡æ•°æ®å°±è¡Œ-è¿™æ ·å¤§å¤§å‡å°‘äº†å†…å­˜çš„è´Ÿæ‹…-æé«˜äº†æˆ‘ä»¬çš„å·¥ç¨‹æ•ˆç‡" class="headerlink" title="è¿™ä¸ªæ˜¯XMPPRosterDelegateåè®®ä¸­ä»£ç†æ–¹æ³•,å¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šçš„å¥½å‹,è¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨å¾ˆå¤šæ¬¡,çŸ¥é“æˆ‘ä»¬çš„å¥½å‹å…¨éƒ¨éå†å®Œ.    NSString SJid = [[item attributeForName:@â€jidâ€] stringValue];  å’ŒXMPPJID jid = [XMPPJID jidWithString:SJid];è¿™ä¸¤ä¸ªæ–¹æ³•å°±æ˜¯å½“æˆ‘ä»¬ä»æœåŠ¡å™¨æ¥åˆ°æˆ‘ä»¬çš„æ•°æ®æ—¶å€™,æˆ‘ä»¬è¦å…ˆå°†ä»–è½¬åŒ–æˆä¸€ä¸‹,è½¬æˆæˆæˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®,ç„¶åå­˜å…¥æˆ‘ä»¬çš„æ•°æ®æºæ•°ç»„ä¸­.æ›´æ–°UI ä½¿ç”¨çš„æ–¹æ³•æ˜¯[self.tableView insertRowsAtIndexPaths:@[path] withRowAnimation:UITableViewRowAnimationBottom];  ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªæ–¹æ³•å‘¢?ä¸ºä»€ä¹ˆä¸ä½¿ç”¨reloadDataè¿™ä¸ªæ–¹æ³•?å› ä¸ºè¿™ä¸ªä»£ç†æ–¹æ³•ä¼šæ‰§è¡Œå¾ˆå¤šæ¬¡,æˆ‘ä»¬ä¸ºäº†é¿å…æ²¡æœ‰å¿…è¦çš„å†…å­˜è´Ÿæ‹…,æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ›´æ–°ä¸€ä¸‹æˆ‘ä»¬æœ€åä¸€æ¡æ•°æ®å°±è¡Œ,è¿™æ ·å¤§å¤§å‡å°‘äº†å†…å­˜çš„è´Ÿæ‹…,æé«˜äº†æˆ‘ä»¬çš„å·¥ç¨‹æ•ˆç‡."></a>è¿™ä¸ªæ˜¯XMPPRosterDelegateåè®®ä¸­ä»£ç†æ–¹æ³•,å¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šçš„å¥½å‹,è¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨å¾ˆå¤šæ¬¡,çŸ¥é“æˆ‘ä»¬çš„å¥½å‹å…¨éƒ¨éå†å®Œ.    NSString <em>SJid = [[item attributeForName:@â€jidâ€] stringValue];  å’ŒXMPPJID </em>jid = [XMPPJID jidWithString:SJid];è¿™ä¸¤ä¸ªæ–¹æ³•å°±æ˜¯å½“æˆ‘ä»¬ä»æœåŠ¡å™¨æ¥åˆ°æˆ‘ä»¬çš„æ•°æ®æ—¶å€™,æˆ‘ä»¬è¦å…ˆå°†ä»–è½¬åŒ–æˆä¸€ä¸‹,è½¬æˆæˆæˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®,ç„¶åå­˜å…¥æˆ‘ä»¬çš„æ•°æ®æºæ•°ç»„ä¸­.æ›´æ–°UI ä½¿ç”¨çš„æ–¹æ³•æ˜¯[self.tableView insertRowsAtIndexPaths:@[path] withRowAnimation:UITableViewRowAnimationBottom];  ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªæ–¹æ³•å‘¢?ä¸ºä»€ä¹ˆä¸ä½¿ç”¨reloadDataè¿™ä¸ªæ–¹æ³•?å› ä¸ºè¿™ä¸ªä»£ç†æ–¹æ³•ä¼šæ‰§è¡Œå¾ˆå¤šæ¬¡,æˆ‘ä»¬ä¸ºäº†é¿å…æ²¡æœ‰å¿…è¦çš„å†…å­˜è´Ÿæ‹…,æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ›´æ–°ä¸€ä¸‹æˆ‘ä»¬æœ€åä¸€æ¡æ•°æ®å°±è¡Œ,è¿™æ ·å¤§å¤§å‡å°‘äº†å†…å­˜çš„è´Ÿæ‹…,æé«˜äº†æˆ‘ä»¬çš„å·¥ç¨‹æ•ˆç‡.</h5><p></p>
<h3 id="void-prepareForSegue-UIStoryboardSegue-segue-sender-id-sender"><a href="#void-prepareForSegue-UIStoryboardSegue-segue-sender-id-sender" class="headerlink" title="-(void)prepareForSegue:(UIStoryboardSegue )segue sender:(id)sender*"></a><strong><em>-(void)prepareForSegue:(UIStoryboardSegue </em>)segue sender:(id)sender*</strong></h3><p></p>
<h5 id="è¿™ä¸ªæ–¹æ³•æ˜¯å› ä¸ºæˆ‘ä½¿ç”¨storyboardçš„çƒŸç˜¾-æˆ‘ä»¬ä¸ºäº†èƒ½æ­£ç¡®æ‰¾åˆ°æˆ‘ä»¬ç‚¹å‡»å¯¹åº”çš„cellæ‰€ä½¿ç”¨çš„æ–¹æ³•-ä¼ å€¼çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠJIDä¼ åˆ°èŠå¤©ç•Œé¢-è¿™æ ·æœåŠ¡å™¨å°±ä¼šæ¸…æ¥šçš„çŸ¥é“æˆ‘ä»¬æ˜¯å¯¹è°è¿›è¡ŒèŠå¤©äº†"><a href="#è¿™ä¸ªæ–¹æ³•æ˜¯å› ä¸ºæˆ‘ä½¿ç”¨storyboardçš„çƒŸç˜¾-æˆ‘ä»¬ä¸ºäº†èƒ½æ­£ç¡®æ‰¾åˆ°æˆ‘ä»¬ç‚¹å‡»å¯¹åº”çš„cellæ‰€ä½¿ç”¨çš„æ–¹æ³•-ä¼ å€¼çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠJIDä¼ åˆ°èŠå¤©ç•Œé¢-è¿™æ ·æœåŠ¡å™¨å°±ä¼šæ¸…æ¥šçš„çŸ¥é“æˆ‘ä»¬æ˜¯å¯¹è°è¿›è¡ŒèŠå¤©äº†" class="headerlink" title="è¿™ä¸ªæ–¹æ³•æ˜¯å› ä¸ºæˆ‘ä½¿ç”¨storyboardçš„çƒŸç˜¾,æˆ‘ä»¬ä¸ºäº†èƒ½æ­£ç¡®æ‰¾åˆ°æˆ‘ä»¬ç‚¹å‡»å¯¹åº”çš„cellæ‰€ä½¿ç”¨çš„æ–¹æ³•.ä¼ å€¼çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠJIDä¼ åˆ°èŠå¤©ç•Œé¢,è¿™æ ·æœåŠ¡å™¨å°±ä¼šæ¸…æ¥šçš„çŸ¥é“æˆ‘ä»¬æ˜¯å¯¹è°è¿›è¡ŒèŠå¤©äº†."></a>è¿™ä¸ªæ–¹æ³•æ˜¯å› ä¸ºæˆ‘ä½¿ç”¨storyboardçš„çƒŸç˜¾,æˆ‘ä»¬ä¸ºäº†èƒ½æ­£ç¡®æ‰¾åˆ°æˆ‘ä»¬ç‚¹å‡»å¯¹åº”çš„cellæ‰€ä½¿ç”¨çš„æ–¹æ³•.ä¼ å€¼çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠJIDä¼ åˆ°èŠå¤©ç•Œé¢,è¿™æ ·æœåŠ¡å™¨å°±ä¼šæ¸…æ¥šçš„çŸ¥é“æˆ‘ä»¬æ˜¯å¯¹è°è¿›è¡ŒèŠå¤©äº†.</h5><hr>
<p><br></p>
<h2 id="èŠå¤©ç•Œé¢åŠŸèƒ½"><a href="#èŠå¤©ç•Œé¢åŠŸèƒ½" class="headerlink" title="èŠå¤©ç•Œé¢åŠŸèƒ½"></a>èŠå¤©ç•Œé¢åŠŸèƒ½</h2><hr>
<h4 id="å¯¹äºèŠå¤©ç•Œé¢çš„æ­å»º-æˆ‘ä»¬ä¹Ÿæ˜¯ä½¿ç”¨åˆ°UITableViewController-é€»è¾‘æ˜¯æˆ‘ä»¬éœ€è¦å¾€æœåŠ¡å™¨å‘é€æˆ‘ä»¬çš„æ¶ˆæ¯-ç„¶åæœåŠ¡å™¨åœ¨é€šè¿‡JIDå‘é€åˆ°æŒ‡å®šçš„æ¶ˆæ¯-å‘é€è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™å’Œæ¥æ”¶è€…æ¥æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™åˆ·æ–°æˆ‘ä»¬çš„UI"><a href="#å¯¹äºèŠå¤©ç•Œé¢çš„æ­å»º-æˆ‘ä»¬ä¹Ÿæ˜¯ä½¿ç”¨åˆ°UITableViewController-é€»è¾‘æ˜¯æˆ‘ä»¬éœ€è¦å¾€æœåŠ¡å™¨å‘é€æˆ‘ä»¬çš„æ¶ˆæ¯-ç„¶åæœåŠ¡å™¨åœ¨é€šè¿‡JIDå‘é€åˆ°æŒ‡å®šçš„æ¶ˆæ¯-å‘é€è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™å’Œæ¥æ”¶è€…æ¥æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™åˆ·æ–°æˆ‘ä»¬çš„UI" class="headerlink" title="å¯¹äºèŠå¤©ç•Œé¢çš„æ­å»º,æˆ‘ä»¬ä¹Ÿæ˜¯ä½¿ç”¨åˆ°UITableViewController,é€»è¾‘æ˜¯æˆ‘ä»¬éœ€è¦å¾€æœåŠ¡å™¨å‘é€æˆ‘ä»¬çš„æ¶ˆæ¯,ç„¶åæœåŠ¡å™¨åœ¨é€šè¿‡JIDå‘é€åˆ°æŒ‡å®šçš„æ¶ˆæ¯,å‘é€è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™å’Œæ¥æ”¶è€…æ¥æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™åˆ·æ–°æˆ‘ä»¬çš„UI."></a>å¯¹äºèŠå¤©ç•Œé¢çš„æ­å»º,æˆ‘ä»¬ä¹Ÿæ˜¯ä½¿ç”¨åˆ°UITableViewController,é€»è¾‘æ˜¯æˆ‘ä»¬éœ€è¦å¾€æœåŠ¡å™¨å‘é€æˆ‘ä»¬çš„æ¶ˆæ¯,ç„¶åæœåŠ¡å™¨åœ¨é€šè¿‡JIDå‘é€åˆ°æŒ‡å®šçš„æ¶ˆæ¯,å‘é€è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™å’Œæ¥æ”¶è€…æ¥æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™åˆ·æ–°æˆ‘ä»¬çš„UI.</h4><p></p>
<h4 id="é‚£æˆ‘ä»¬å°±å…ˆçœ‹çœ‹åœ¨XMPPManagerçš„ç±»ä¸­æˆ‘ä»¬éœ€è¦åšä¸€äº›ä»€ä¹ˆäº‹æƒ…å§"><a href="#é‚£æˆ‘ä»¬å°±å…ˆçœ‹çœ‹åœ¨XMPPManagerçš„ç±»ä¸­æˆ‘ä»¬éœ€è¦åšä¸€äº›ä»€ä¹ˆäº‹æƒ…å§" class="headerlink" title="é‚£æˆ‘ä»¬å°±å…ˆçœ‹çœ‹åœ¨XMPPManagerçš„ç±»ä¸­æˆ‘ä»¬éœ€è¦åšä¸€äº›ä»€ä¹ˆäº‹æƒ…å§."></a>é‚£æˆ‘ä»¬å°±å…ˆçœ‹çœ‹åœ¨XMPPManagerçš„ç±»ä¸­æˆ‘ä»¬éœ€è¦åšä¸€äº›ä»€ä¹ˆäº‹æƒ…å§.</h4><h4 id="åœ¨XMPPManager-hä¸­-æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªå±æ€§-ä¸€ä¸ªæ˜¯XMPPèŠå¤©æ¶ˆæ¯æœ¬åœ°åŒ–å¤„ç†å¯¹è±¡çš„messageArchiving-å¦å¤–ä¸€ä¸ªæ˜¯æ¶ˆæ¯ä¸Šä¸‹æ–‡å¯¹è±¡messageContext"><a href="#åœ¨XMPPManager-hä¸­-æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªå±æ€§-ä¸€ä¸ªæ˜¯XMPPèŠå¤©æ¶ˆæ¯æœ¬åœ°åŒ–å¤„ç†å¯¹è±¡çš„messageArchiving-å¦å¤–ä¸€ä¸ªæ˜¯æ¶ˆæ¯ä¸Šä¸‹æ–‡å¯¹è±¡messageContext" class="headerlink" title="åœ¨XMPPManager.hä¸­ æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªå±æ€§,ä¸€ä¸ªæ˜¯XMPPèŠå¤©æ¶ˆæ¯æœ¬åœ°åŒ–å¤„ç†å¯¹è±¡çš„messageArchiving,å¦å¤–ä¸€ä¸ªæ˜¯æ¶ˆæ¯ä¸Šä¸‹æ–‡å¯¹è±¡messageContext."></a>åœ¨XMPPManager.hä¸­ æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªå±æ€§,ä¸€ä¸ªæ˜¯XMPPèŠå¤©æ¶ˆæ¯æœ¬åœ°åŒ–å¤„ç†å¯¹è±¡çš„messageArchiving,å¦å¤–ä¸€ä¸ªæ˜¯æ¶ˆæ¯ä¸Šä¸‹æ–‡å¯¹è±¡messageContext.</h4><h4 id="åœ¨XMPPManager-mä¸­-çš„initæ–¹æ³•ä¸­-æˆ‘ä»¬å¯¹è¿™ä¸¤ä¸ªå±æ€§è¿›è¡Œäº†åˆå§‹åŒ–-å¦‚ä¸‹"><a href="#åœ¨XMPPManager-mä¸­-çš„initæ–¹æ³•ä¸­-æˆ‘ä»¬å¯¹è¿™ä¸¤ä¸ªå±æ€§è¿›è¡Œäº†åˆå§‹åŒ–-å¦‚ä¸‹" class="headerlink" title="åœ¨XMPPManager.mä¸­ çš„initæ–¹æ³•ä¸­,æˆ‘ä»¬å¯¹è¿™ä¸¤ä¸ªå±æ€§è¿›è¡Œäº†åˆå§‹åŒ–.å¦‚ä¸‹"></a>åœ¨XMPPManager.mä¸­ çš„initæ–¹æ³•ä¸­,æˆ‘ä»¬å¯¹è¿™ä¸¤ä¸ªå±æ€§è¿›è¡Œäº†åˆå§‹åŒ–.å¦‚ä¸‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//åˆå§‹åŒ–èŠå¤©è®°å½•ç®¡ç†å¯¹è±¡</span><br><span class="line">        </span><br><span class="line">        XMPPMessageArchivingCoreDataStorage  *messageArchivingCoreDataStorage= [XMPPMessageArchivingCoreDataStorage sharedInstance];</span><br><span class="line">        </span><br><span class="line">        self.messageArchiving = [[XMPPMessageArchiving alloc]initWithMessageArchivingStorage:messageArchivingCoreDataStorage dispatchQueue:dispatch_get_main_queue()];</span><br><span class="line">        </span><br><span class="line">        //æ¿€æ´»ç®¡ç†å¯¹è±¡</span><br><span class="line">        [self.messageArchiving activate:self.stream];</span><br><span class="line">        </span><br><span class="line">        //è®¾ç½®ç®¡ç†å¯¹è±¡ä»£ç†</span><br><span class="line">        [self.messageArchiving addDelegate:self delegateQueue:dispatch_get_main_queue()];</span><br><span class="line">        </span><br><span class="line">        self.messageContext = messageArchivingCoreDataStorage.mainThreadManagedObjectContext;</span><br></pre></td></tr></table></figure>
<h4 id="messageArchivingå¯¹è±¡ä¹Ÿæ˜¯éœ€è¦æˆ‘ä»¬æ¿€æ´»é€šé“æƒé™çš„-ç„¶åè®¾ç½®äº†ä»£ç†"><a href="#messageArchivingå¯¹è±¡ä¹Ÿæ˜¯éœ€è¦æˆ‘ä»¬æ¿€æ´»é€šé“æƒé™çš„-ç„¶åè®¾ç½®äº†ä»£ç†" class="headerlink" title="messageArchivingå¯¹è±¡ä¹Ÿæ˜¯éœ€è¦æˆ‘ä»¬æ¿€æ´»é€šé“æƒé™çš„.ç„¶åè®¾ç½®äº†ä»£ç†."></a>messageArchivingå¯¹è±¡ä¹Ÿæ˜¯éœ€è¦æˆ‘ä»¬æ¿€æ´»é€šé“æƒé™çš„.ç„¶åè®¾ç½®äº†ä»£ç†.</h4><p><br></p>
<h4 id="åœ¨ChatTableViewController-hç•Œé¢-æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªXMPPJIDå¯¹è±¡-æ¥æ¥å—å¥½å‹åˆ—è¡¨ä¼ æ¥çš„JIDå€¼-ä»£ç å¦‚ä¸‹"><a href="#åœ¨ChatTableViewController-hç•Œé¢-æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªXMPPJIDå¯¹è±¡-æ¥æ¥å—å¥½å‹åˆ—è¡¨ä¼ æ¥çš„JIDå€¼-ä»£ç å¦‚ä¸‹" class="headerlink" title="åœ¨ChatTableViewController.hç•Œé¢ æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªXMPPJIDå¯¹è±¡  æ¥æ¥å—å¥½å‹åˆ—è¡¨ä¼ æ¥çš„JIDå€¼.ä»£ç å¦‚ä¸‹."></a>åœ¨ChatTableViewController.hç•Œé¢ æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªXMPPJIDå¯¹è±¡  æ¥æ¥å—å¥½å‹åˆ—è¡¨ä¼ æ¥çš„JIDå€¼.ä»£ç å¦‚ä¸‹.</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">#import &quot;XMPPManager.h&quot;</span><br><span class="line"></span><br><span class="line">@interface ChatTableViewController : UITableViewController</span><br><span class="line"></span><br><span class="line">//æ¥æ”¶å¥½å‹åˆ—è¡¨ä¼ æ¥çš„JID</span><br><span class="line">@property(nonatomic,strong)XMPPJID *chatToJID;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p></p>
<p>####åœ¨ChatTableViewController.mæ–‡ä»¶ä¸­,æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å®ç°XMPPStreamDelegateçš„ä»£ç†æ–¹æ³•,ä»ä»£ç†æ–¹æ³•ä¸­å®ç°å¾€æœåŠ¡å™¨å‘é€æ•°æ®å’Œä»æœåŠ¡å™¨æ¥æ”¶æ•°æ®çš„æ“ä½œ.ä»£ç å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#import &quot;ChatTableViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface ChatTableViewController ()&lt;XMPPStreamDelegate&gt;</span><br><span class="line"></span><br><span class="line">//å­˜æ”¾æ‰€æœ‰çš„æ¶ˆæ¯</span><br><span class="line">@property(nonatomic,strong)NSMutableArray *messageArray;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ChatTableViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    self.messageArray = [NSMutableArray array];</span><br><span class="line">    </span><br><span class="line">    //æ·»åŠ ä»£ç†</span><br><span class="line">    [[XMPPManager defaulManager].stream addDelegate:self delegateQueue:dispatch_get_main_queue()];</span><br><span class="line">    </span><br><span class="line">    //æ›´æ–°èŠå¤©è®°å½•ä¿¡æ¯</span><br><span class="line">    [self reloadMessage];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    // Uncomment the following line to preserve selection between presentations.</span><br><span class="line">    // self.clearsSelectionOnViewWillAppear = NO;</span><br><span class="line">    </span><br><span class="line">    // Uncomment the following line to display an Edit button in the navigation bar for this view controller.</span><br><span class="line">    // self.navigationItem.rightBarButtonItem = self.editButtonItem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å±•ç°èŠå¤©è®°å½•</span><br><span class="line">-(void)reloadMessage&#123;</span><br><span class="line"></span><br><span class="line">    NSManagedObjectContext *context = [XMPPManager defaulManager].messageContext;</span><br><span class="line">    </span><br><span class="line">#pragma mark----ç›´æ¥ä¸€ä¸ª fet ä¸‹é¢å…¨éƒ½å‡ºæ¥äº†----</span><br><span class="line">    </span><br><span class="line">    NSFetchRequest *fetchRequest = [[NSFetchRequest alloc] init];</span><br><span class="line">    //è¿™é‡Œé¢è¦å¡«çš„æ˜¯XMPPARChiverçš„coreDataå®ä¾‹ç±»å‹</span><br><span class="line">    NSEntityDescription *entity = [NSEntityDescription entityForName:@&quot;XMPPMessageArchiving_Message_CoreDataObject&quot; inManagedObjectContext:context];</span><br><span class="line">    [fetchRequest setEntity:entity];</span><br><span class="line">    // Specify criteria for filtering which objects to fetch</span><br><span class="line">    </span><br><span class="line">    //å¯¹å–åˆ°çš„æ•°æ®è¿›è¡Œè¿‡æ»¤,ä¼ å…¥è¿‡æ»¤æ¡ä»¶.</span><br><span class="line">    NSPredicate *predicate = [NSPredicate predicateWithFormat:@&quot;streamBareJidStr == %@ AND bareJidStr == %@&quot;, [XMPPManager defaulManager].stream.myJID.bare,self.chatToJID.bare];</span><br><span class="line">    [fetchRequest setPredicate:predicate];</span><br><span class="line">    // Specify how the fetched objects should be sorted</span><br><span class="line">    </span><br><span class="line">    //è®¾ç½®æ’åºçš„å…³é”®å­—</span><br><span class="line">    NSSortDescriptor *sortDescriptor = [[NSSortDescriptor alloc] initWithKey:@&quot;timestamp&quot;</span><br><span class="line">                                                                   ascending:YES];</span><br><span class="line">    [fetchRequest setSortDescriptors:[NSArray arrayWithObjects:sortDescriptor, nil]];</span><br><span class="line">    </span><br><span class="line">    NSError *error = nil;</span><br><span class="line">    NSArray *fetchedObjects = [context executeFetchRequest:fetchRequest error:&amp;error];</span><br><span class="line">    if (fetchedObjects == nil) &#123;</span><br><span class="line"></span><br><span class="line">        //å®Œæˆä¹‹åå¹²ä»€ä¹ˆ?</span><br><span class="line">        NSLog(@&quot;å’Œæ­¤äººçš„æ¿€æƒ…äº¤è°ˆ&quot;);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /********è·å–å’Œè¿™ä¸ªäººæ‰€æœ‰çš„èŠå¤©è®°å½•***************/</span><br><span class="line">    </span><br><span class="line">    //æ¸…ç©ºèŠå¤©æ•°ç»„ä¸­çš„æ¶ˆæ¯</span><br><span class="line">    [self.messageArray removeAllObjects];</span><br><span class="line">    </span><br><span class="line">    //å°†æ–°çš„èŠå¤©è®°å½•æ·»åŠ åˆ°æ•°ç»„ä¸­</span><br><span class="line">    self.messageArray = [NSMutableArray arrayWithArray:fetchedObjects];</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;%ld&quot;,self.messageArray.count);</span><br><span class="line">    </span><br><span class="line">    //åˆ·æ–°UI</span><br><span class="line">    [self.tableView reloadData];</span><br><span class="line">    </span><br><span class="line">    //å°†tableviewç›´æ¥æ»‘åŠ¨åˆ°æœ€åº•éƒ¨</span><br><span class="line">    NSIndexPath * indexpath = [NSIndexPath indexPathForRow: self.messageArray.count-1 inSection:0];</span><br><span class="line">    </span><br><span class="line">    if (indexpath.row &gt; 0) &#123;</span><br><span class="line">        </span><br><span class="line">        [self.tableView selectRowAtIndexPath:indexpath animated:YES scrollPosition:UITableViewScrollPositionBottom];</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (void)didReceiveMemoryWarning &#123;</span><br><span class="line">    [super didReceiveMemoryWarning];</span><br><span class="line">    // Dispose of any resources that can be recreated.</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Table view data source</span><br><span class="line"></span><br><span class="line">- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView &#123;</span><br><span class="line">    return 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section &#123;</span><br><span class="line">    return self.messageArray.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;ChatCell&quot; forIndexPath:indexPath];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    //å–åˆ°æˆ‘ä»¬å¯¹åº”çš„ä¿¡æ¯</span><br><span class="line">    XMPPMessageArchiving_Message_CoreDataObject *message = self.messageArray[indexPath.row];</span><br><span class="line">    </span><br><span class="line">    if (message.isOutgoing == YES) &#123;</span><br><span class="line">        </span><br><span class="line">        cell.detailTextLabel.text  = message.body;</span><br><span class="line">        </span><br><span class="line">        cell.textLabel.text = @&quot;&quot;;</span><br><span class="line">        </span><br><span class="line">    &#125;else &#123;</span><br><span class="line">    </span><br><span class="line">        cell.textLabel.text = message.body;</span><br><span class="line">        </span><br><span class="line">        cell.detailTextLabel.text = @&quot;&quot;;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å‘é€æ¶ˆæ¯</span><br><span class="line">- (IBAction)sendAction:(id)sender &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    XMPPMessage *message = [XMPPMessage messageWithType:@&quot;chat&quot; to:self.chatToJID];</span><br><span class="line">    </span><br><span class="line">    [message addBody:@&quot;nice to meet you&quot;];</span><br><span class="line">    </span><br><span class="line">    //å‘é€æ¶ˆæ¯</span><br><span class="line">    [[XMPPManager defaulManager].stream sendElement:message];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)xmppStream:(XMPPStream *)sender didSendMessage:(XMPPMessage *)message&#123;</span><br><span class="line"></span><br><span class="line">//    tipWithMessage(@&quot;æ¶ˆæ¯å‘é€æˆåŠŸ!&quot;);</span><br><span class="line">    </span><br><span class="line">    [self reloadMessage];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-(void)xmppStream:(XMPPStream *)sender didFailToSendMessage:(XMPPMessage *)message error:(NSError *)error&#123;</span><br><span class="line"></span><br><span class="line">    tipWithMessage(@&quot;æ¶ˆæ¯å‘é€å¤±è´¥&quot;);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-(void)xmppStream:(XMPPStream *)sender didReceiveMessage:(XMPPMessage *)message&#123;</span><br><span class="line">    </span><br><span class="line">    [self reloadMessage];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p></p>
<h3 id="é¡µé¢çš„é€»è¾‘"><a href="#é¡µé¢çš„é€»è¾‘" class="headerlink" title="é¡µé¢çš„é€»è¾‘:"></a>é¡µé¢çš„é€»è¾‘:</h3><h4 id="å½“æˆ‘ä»¬è¿›å…¥èŠå¤©ç•Œé¢çš„æ—¶å€™-æˆ‘ä»¬ä¼šå…ˆè°ƒç”¨reloadMessageè¿™ä¸ªæ–¹æ³•-ä»æœåŠ¡å™¨ä¸‹è½½å½“å‰ç”¨æˆ·ä¸è¿™ä¸ªJIDçš„èŠå¤©è®°å½•-å½“æˆ‘ä»¬ç‚¹å‡»å‘é€æ¶ˆæ¯çš„æ—¶å€™-æˆ‘ä»¬å°±ä¼šè°ƒç”¨sendActionè¿™ä¸ªæ–¹æ³•-å‘é€åˆ°æœåŠ¡å™¨ä¸Šå»-å½“æˆ‘ä»¬å‘é€æˆåŠŸåè°ƒç”¨didSendMessageè¿™ä¸ªåè®®æ–¹æ³•-ç„¶ååœ¨è¿™åè®®æ–¹æ³•ä¸­è°ƒç”¨reloadMessageè¿™ä¸ªæ–¹æ³•é‡æ–°ä»æœåŠ¡å™¨ä¸‹è½½æ–°çš„èŠå¤©è®°å½•å¹¶ä¸”åˆ·æ–°UI-ç„¶åæœåŠ¡å™¨ä¸Šæœ‰å½“å‰ç”¨æˆ·æ–°çš„æ¶ˆæ¯çš„æ—¶å€™-å°±ä¼šè°ƒç”¨didReceiveMessageè¿™ä¸ªä»£ç†æ–¹æ³•-æˆ‘ä»¬åªéœ€è¦åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å†æ¬¡è°ƒç”¨reloadMessageæ–¹æ³•å°±å¯-PS-å› ä¸ºæˆ‘ç”¨çš„æ˜¯storyboard-æ‰€æœ‰æœ‰äº›åœ°æ–¹ä¼šæœ‰æ‰€ä¸åŒğŸ˜ƒ"><a href="#å½“æˆ‘ä»¬è¿›å…¥èŠå¤©ç•Œé¢çš„æ—¶å€™-æˆ‘ä»¬ä¼šå…ˆè°ƒç”¨reloadMessageè¿™ä¸ªæ–¹æ³•-ä»æœåŠ¡å™¨ä¸‹è½½å½“å‰ç”¨æˆ·ä¸è¿™ä¸ªJIDçš„èŠå¤©è®°å½•-å½“æˆ‘ä»¬ç‚¹å‡»å‘é€æ¶ˆæ¯çš„æ—¶å€™-æˆ‘ä»¬å°±ä¼šè°ƒç”¨sendActionè¿™ä¸ªæ–¹æ³•-å‘é€åˆ°æœåŠ¡å™¨ä¸Šå»-å½“æˆ‘ä»¬å‘é€æˆåŠŸåè°ƒç”¨didSendMessageè¿™ä¸ªåè®®æ–¹æ³•-ç„¶ååœ¨è¿™åè®®æ–¹æ³•ä¸­è°ƒç”¨reloadMessageè¿™ä¸ªæ–¹æ³•é‡æ–°ä»æœåŠ¡å™¨ä¸‹è½½æ–°çš„èŠå¤©è®°å½•å¹¶ä¸”åˆ·æ–°UI-ç„¶åæœåŠ¡å™¨ä¸Šæœ‰å½“å‰ç”¨æˆ·æ–°çš„æ¶ˆæ¯çš„æ—¶å€™-å°±ä¼šè°ƒç”¨didReceiveMessageè¿™ä¸ªä»£ç†æ–¹æ³•-æˆ‘ä»¬åªéœ€è¦åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å†æ¬¡è°ƒç”¨reloadMessageæ–¹æ³•å°±å¯-PS-å› ä¸ºæˆ‘ç”¨çš„æ˜¯storyboard-æ‰€æœ‰æœ‰äº›åœ°æ–¹ä¼šæœ‰æ‰€ä¸åŒğŸ˜ƒ" class="headerlink" title="å½“æˆ‘ä»¬è¿›å…¥èŠå¤©ç•Œé¢çš„æ—¶å€™,æˆ‘ä»¬ä¼šå…ˆè°ƒç”¨reloadMessageè¿™ä¸ªæ–¹æ³•,ä»æœåŠ¡å™¨ä¸‹è½½å½“å‰ç”¨æˆ·ä¸è¿™ä¸ªJIDçš„èŠå¤©è®°å½•,å½“æˆ‘ä»¬ç‚¹å‡»å‘é€æ¶ˆæ¯çš„æ—¶å€™,æˆ‘ä»¬å°±ä¼šè°ƒç”¨sendActionè¿™ä¸ªæ–¹æ³•,å‘é€åˆ°æœåŠ¡å™¨ä¸Šå»,å½“æˆ‘ä»¬å‘é€æˆåŠŸåè°ƒç”¨didSendMessageè¿™ä¸ªåè®®æ–¹æ³•,ç„¶ååœ¨è¿™åè®®æ–¹æ³•ä¸­è°ƒç”¨reloadMessageè¿™ä¸ªæ–¹æ³•é‡æ–°ä»æœåŠ¡å™¨ä¸‹è½½æ–°çš„èŠå¤©è®°å½•å¹¶ä¸”åˆ·æ–°UI,ç„¶åæœåŠ¡å™¨ä¸Šæœ‰å½“å‰ç”¨æˆ·æ–°çš„æ¶ˆæ¯çš„æ—¶å€™,å°±ä¼šè°ƒç”¨didReceiveMessageè¿™ä¸ªä»£ç†æ–¹æ³•,æˆ‘ä»¬åªéœ€è¦åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å†æ¬¡è°ƒç”¨reloadMessageæ–¹æ³•å°±å¯.(PS:å› ä¸ºæˆ‘ç”¨çš„æ˜¯storyboard  æ‰€æœ‰æœ‰äº›åœ°æ–¹ä¼šæœ‰æ‰€ä¸åŒğŸ˜ƒ)"></a>å½“æˆ‘ä»¬è¿›å…¥èŠå¤©ç•Œé¢çš„æ—¶å€™,æˆ‘ä»¬ä¼šå…ˆè°ƒç”¨reloadMessageè¿™ä¸ªæ–¹æ³•,ä»æœåŠ¡å™¨ä¸‹è½½å½“å‰ç”¨æˆ·ä¸è¿™ä¸ªJIDçš„èŠå¤©è®°å½•,å½“æˆ‘ä»¬ç‚¹å‡»å‘é€æ¶ˆæ¯çš„æ—¶å€™,æˆ‘ä»¬å°±ä¼šè°ƒç”¨sendActionè¿™ä¸ªæ–¹æ³•,å‘é€åˆ°æœåŠ¡å™¨ä¸Šå»,å½“æˆ‘ä»¬å‘é€æˆåŠŸåè°ƒç”¨didSendMessageè¿™ä¸ªåè®®æ–¹æ³•,ç„¶ååœ¨è¿™åè®®æ–¹æ³•ä¸­è°ƒç”¨reloadMessageè¿™ä¸ªæ–¹æ³•é‡æ–°ä»æœåŠ¡å™¨ä¸‹è½½æ–°çš„èŠå¤©è®°å½•å¹¶ä¸”åˆ·æ–°UI,ç„¶åæœåŠ¡å™¨ä¸Šæœ‰å½“å‰ç”¨æˆ·æ–°çš„æ¶ˆæ¯çš„æ—¶å€™,å°±ä¼šè°ƒç”¨didReceiveMessageè¿™ä¸ªä»£ç†æ–¹æ³•,æˆ‘ä»¬åªéœ€è¦åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å†æ¬¡è°ƒç”¨reloadMessageæ–¹æ³•å°±å¯.(PS:å› ä¸ºæˆ‘ç”¨çš„æ˜¯storyboard  æ‰€æœ‰æœ‰äº›åœ°æ–¹ä¼šæœ‰æ‰€ä¸åŒğŸ˜ƒ)</h4><hr>
<p><br></p>
<h3 id="æ–¹æ³•è§£é‡Š-1"><a href="#æ–¹æ³•è§£é‡Š-1" class="headerlink" title="æ–¹æ³•è§£é‡Š:"></a>æ–¹æ³•è§£é‡Š:</h3><hr>
<h4 id="void-reloadMessage"><a href="#void-reloadMessage" class="headerlink" title="-(void)reloadMessage"></a><strong><em>-(void)reloadMessage</em></strong></h4><h4 id="è¿™ä¸ªæ–¹æ³•æ˜¯æ•´ä¸ªèŠå¤©ç•Œé¢çš„æ ¸å¿ƒ-æˆ‘ä»¬åœ¨è¿™é‡Œé¢åšçš„å°±æ˜¯ä»æœåŠ¡å™¨ä¸‹è½½æˆ‘ä»¬çš„æ•°æ®-å½“æˆ‘ä»¬ä¸‹è½½å®Œæ•°æ®çš„æ—¶å€™-å°±è¦æŠŠæˆ‘ä»¬æ•°æ®æºæ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ æ¸…ç©º-ç„¶åå°†æ‰€æœ‰ä»æœåŠ¡å™¨ä¸­ä¸‹è½½çš„å…ƒç´ æ·»åŠ åˆ°æˆ‘ä»¬çš„æ•°ç»„ä¸­-ç„¶ååˆ·æ–°æˆ‘ä»¬çš„UI-å½“æˆ‘ä¸€åˆ·æ–°ä¹‹åtableViewå°±ä¼šé‡å¤´å¼€å§‹äº†-æ‰€ä»¥æˆ‘ä»¬è®¾ç½®è®©æœ€åä¸€ä¸ªcellæ˜¾ç¤ºåœ¨å±å¹•ä¸Š-è¿˜æœ‰å°±æ˜¯ä¸‹é¢çš„ä¸€æ®µä»£ç -è¿™æ˜¯æˆ‘ä»¬å…ˆå‰å†™å¥½çš„-æˆ‘ä»¬éœ€è¦æ•²å‡º-fetch-å°±ä¼šç»™æˆ‘ä»¬æç¤º-æ˜¯ä¸æ˜¯å¾ˆç®€ç­”-ğŸ˜‚-è¿™æ®µä»£ç å°±æ˜¯ä»ç½‘ä¸Šä¸‹è½½æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®-å½“ç„¶äº†-æˆ‘ä»¬éœ€è¦ä½¿ç”¨è°“è¯å¯¹è¿™äº›æ•°æ®è¿›è¡Œè¿‡æ»¤-è¿‡æ»¤åçš„æ•°æ®æ‰æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®"><a href="#è¿™ä¸ªæ–¹æ³•æ˜¯æ•´ä¸ªèŠå¤©ç•Œé¢çš„æ ¸å¿ƒ-æˆ‘ä»¬åœ¨è¿™é‡Œé¢åšçš„å°±æ˜¯ä»æœåŠ¡å™¨ä¸‹è½½æˆ‘ä»¬çš„æ•°æ®-å½“æˆ‘ä»¬ä¸‹è½½å®Œæ•°æ®çš„æ—¶å€™-å°±è¦æŠŠæˆ‘ä»¬æ•°æ®æºæ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ æ¸…ç©º-ç„¶åå°†æ‰€æœ‰ä»æœåŠ¡å™¨ä¸­ä¸‹è½½çš„å…ƒç´ æ·»åŠ åˆ°æˆ‘ä»¬çš„æ•°ç»„ä¸­-ç„¶ååˆ·æ–°æˆ‘ä»¬çš„UI-å½“æˆ‘ä¸€åˆ·æ–°ä¹‹åtableViewå°±ä¼šé‡å¤´å¼€å§‹äº†-æ‰€ä»¥æˆ‘ä»¬è®¾ç½®è®©æœ€åä¸€ä¸ªcellæ˜¾ç¤ºåœ¨å±å¹•ä¸Š-è¿˜æœ‰å°±æ˜¯ä¸‹é¢çš„ä¸€æ®µä»£ç -è¿™æ˜¯æˆ‘ä»¬å…ˆå‰å†™å¥½çš„-æˆ‘ä»¬éœ€è¦æ•²å‡º-fetch-å°±ä¼šç»™æˆ‘ä»¬æç¤º-æ˜¯ä¸æ˜¯å¾ˆç®€ç­”-ğŸ˜‚-è¿™æ®µä»£ç å°±æ˜¯ä»ç½‘ä¸Šä¸‹è½½æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®-å½“ç„¶äº†-æˆ‘ä»¬éœ€è¦ä½¿ç”¨è°“è¯å¯¹è¿™äº›æ•°æ®è¿›è¡Œè¿‡æ»¤-è¿‡æ»¤åçš„æ•°æ®æ‰æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®" class="headerlink" title="è¿™ä¸ªæ–¹æ³•æ˜¯æ•´ä¸ªèŠå¤©ç•Œé¢çš„æ ¸å¿ƒ.æˆ‘ä»¬åœ¨è¿™é‡Œé¢åšçš„å°±æ˜¯ä»æœåŠ¡å™¨ä¸‹è½½æˆ‘ä»¬çš„æ•°æ®.å½“æˆ‘ä»¬ä¸‹è½½å®Œæ•°æ®çš„æ—¶å€™,å°±è¦æŠŠæˆ‘ä»¬æ•°æ®æºæ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ æ¸…ç©º,ç„¶åå°†æ‰€æœ‰ä»æœåŠ¡å™¨ä¸­ä¸‹è½½çš„å…ƒç´ æ·»åŠ åˆ°æˆ‘ä»¬çš„æ•°ç»„ä¸­.ç„¶ååˆ·æ–°æˆ‘ä»¬çš„UI,å½“æˆ‘ä¸€åˆ·æ–°ä¹‹åtableViewå°±ä¼šé‡å¤´å¼€å§‹äº†,æ‰€ä»¥æˆ‘ä»¬è®¾ç½®è®©æœ€åä¸€ä¸ªcellæ˜¾ç¤ºåœ¨å±å¹•ä¸Š.è¿˜æœ‰å°±æ˜¯ä¸‹é¢çš„ä¸€æ®µä»£ç ,è¿™æ˜¯æˆ‘ä»¬å…ˆå‰å†™å¥½çš„,æˆ‘ä»¬éœ€è¦æ•²å‡º  fetch   å°±ä¼šç»™æˆ‘ä»¬æç¤º,æ˜¯ä¸æ˜¯å¾ˆç®€ç­”?ğŸ˜‚ è¿™æ®µä»£ç å°±æ˜¯ä»ç½‘ä¸Šä¸‹è½½æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®.å½“ç„¶äº†,æˆ‘ä»¬éœ€è¦ä½¿ç”¨è°“è¯å¯¹è¿™äº›æ•°æ®è¿›è¡Œè¿‡æ»¤.è¿‡æ»¤åçš„æ•°æ®æ‰æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®."></a>è¿™ä¸ªæ–¹æ³•æ˜¯æ•´ä¸ªèŠå¤©ç•Œé¢çš„æ ¸å¿ƒ.æˆ‘ä»¬åœ¨è¿™é‡Œé¢åšçš„å°±æ˜¯ä»æœåŠ¡å™¨ä¸‹è½½æˆ‘ä»¬çš„æ•°æ®.å½“æˆ‘ä»¬ä¸‹è½½å®Œæ•°æ®çš„æ—¶å€™,å°±è¦æŠŠæˆ‘ä»¬æ•°æ®æºæ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ æ¸…ç©º,ç„¶åå°†æ‰€æœ‰ä»æœåŠ¡å™¨ä¸­ä¸‹è½½çš„å…ƒç´ æ·»åŠ åˆ°æˆ‘ä»¬çš„æ•°ç»„ä¸­.ç„¶ååˆ·æ–°æˆ‘ä»¬çš„UI,å½“æˆ‘ä¸€åˆ·æ–°ä¹‹åtableViewå°±ä¼šé‡å¤´å¼€å§‹äº†,æ‰€ä»¥æˆ‘ä»¬è®¾ç½®è®©æœ€åä¸€ä¸ªcellæ˜¾ç¤ºåœ¨å±å¹•ä¸Š.è¿˜æœ‰å°±æ˜¯ä¸‹é¢çš„ä¸€æ®µä»£ç ,è¿™æ˜¯æˆ‘ä»¬å…ˆå‰å†™å¥½çš„,æˆ‘ä»¬éœ€è¦æ•²å‡º <strong><em> fetch  </em></strong> å°±ä¼šç»™æˆ‘ä»¬æç¤º,æ˜¯ä¸æ˜¯å¾ˆç®€ç­”?ğŸ˜‚ è¿™æ®µä»£ç å°±æ˜¯ä»ç½‘ä¸Šä¸‹è½½æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®.å½“ç„¶äº†,æˆ‘ä»¬éœ€è¦ä½¿ç”¨è°“è¯å¯¹è¿™äº›æ•°æ®è¿›è¡Œè¿‡æ»¤.è¿‡æ»¤åçš„æ•°æ®æ‰æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®.</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">NSFetchRequest *fetchRequest = [[NSFetchRequest alloc] init];</span><br><span class="line">//è¿™é‡Œé¢è¦å¡«çš„æ˜¯XMPPARChiverçš„coreDataå®ä¾‹ç±»å‹</span><br><span class="line">NSEntityDescription *entity = [NSEntityDescription entityForName:@&quot;XMPPMessageArchiving_Message_CoreDataObject&quot; inManagedObjectContext:context];</span><br><span class="line">[fetchRequest setEntity:entity];</span><br><span class="line">// Specify criteria for filtering which objects to fetch</span><br><span class="line"></span><br><span class="line">//å¯¹å–åˆ°çš„æ•°æ®è¿›è¡Œè¿‡æ»¤,ä¼ å…¥è¿‡æ»¤æ¡ä»¶.</span><br><span class="line">NSPredicate *predicate = [NSPredicate predicateWithFormat:@&quot;streamBareJidStr == %@ AND bareJidStr == %@&quot;, [XMPPManager defaulManager].stream.myJID.bare,self.chatToJID.bare];</span><br><span class="line">[fetchRequest setPredicate:predicate];</span><br><span class="line">// Specify how the fetched objects should be sorted</span><br><span class="line"></span><br><span class="line">//è®¾ç½®æ’åºçš„å…³é”®å­—</span><br><span class="line">NSSortDescriptor *sortDescriptor = [[NSSortDescriptor alloc] initWithKey:@&quot;timestamp&quot;</span><br><span class="line">                                                               ascending:YES];</span><br><span class="line">[fetchRequest setSortDescriptors:[NSArray arrayWithObjects:sortDescriptor, nil]];</span><br><span class="line"></span><br><span class="line">NSError *error = nil;</span><br><span class="line">NSArray *fetchedObjects = [context executeFetchRequest:fetchRequest error:&amp;error];</span><br><span class="line">if (fetchedObjects == nil) &#123;</span><br><span class="line"></span><br><span class="line">    //å®Œæˆä¹‹åå¹²ä»€ä¹ˆ?</span><br><span class="line">    NSLog(@&quot;å’Œæ­¤äººçš„æ¿€æƒ…äº¤è°ˆ&quot;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="XMPPåè®®å®ç°å³æ—¶é€šè®¯çš„è¿‡ç¨‹å¤§ä½“å°±æ˜¯è¿™æ ·äº†-å½“ç„¶äº†-æˆ‘è¿˜æœ‰ä¸€äº›åŠŸèƒ½æ²¡æœ‰å®Œå–„-æ¯”å¦‚æ·»åŠ å¥½å‹çš„åŠŸèƒ½-è¿™å°†åœ¨åæœŸè¿›è¡Œå†æ¬¡çš„å®Œå–„-è°¢è°¢å¤§å®¶çš„æŸ¥çœ‹"><a href="#XMPPåè®®å®ç°å³æ—¶é€šè®¯çš„è¿‡ç¨‹å¤§ä½“å°±æ˜¯è¿™æ ·äº†-å½“ç„¶äº†-æˆ‘è¿˜æœ‰ä¸€äº›åŠŸèƒ½æ²¡æœ‰å®Œå–„-æ¯”å¦‚æ·»åŠ å¥½å‹çš„åŠŸèƒ½-è¿™å°†åœ¨åæœŸè¿›è¡Œå†æ¬¡çš„å®Œå–„-è°¢è°¢å¤§å®¶çš„æŸ¥çœ‹" class="headerlink" title="XMPPåè®®å®ç°å³æ—¶é€šè®¯çš„è¿‡ç¨‹å¤§ä½“å°±æ˜¯è¿™æ ·äº†,å½“ç„¶äº†,æˆ‘è¿˜æœ‰ä¸€äº›åŠŸèƒ½æ²¡æœ‰å®Œå–„,æ¯”å¦‚æ·»åŠ å¥½å‹çš„åŠŸèƒ½.è¿™å°†åœ¨åæœŸè¿›è¡Œå†æ¬¡çš„å®Œå–„.è°¢è°¢å¤§å®¶çš„æŸ¥çœ‹.."></a>XMPPåè®®å®ç°å³æ—¶é€šè®¯çš„è¿‡ç¨‹å¤§ä½“å°±æ˜¯è¿™æ ·äº†,å½“ç„¶äº†,æˆ‘è¿˜æœ‰ä¸€äº›åŠŸèƒ½æ²¡æœ‰å®Œå–„,æ¯”å¦‚æ·»åŠ å¥½å‹çš„åŠŸèƒ½.è¿™å°†åœ¨åæœŸè¿›è¡Œå†æ¬¡çš„å®Œå–„.è°¢è°¢å¤§å®¶çš„æŸ¥çœ‹..</h4><h1 id="â€”-gt-XMPPçš„Demoèµ„æºä¸‹è½½"><a href="#â€”-gt-XMPPçš„Demoèµ„æºä¸‹è½½" class="headerlink" title="â€”&gt;XMPPçš„Demoèµ„æºä¸‹è½½ "></a><a href="http://yun.baidu.com/share/link?shareid=3488044018&amp;uk=4079807053" target="_blank" rel="external">â€”&gt;XMPPçš„Demoèµ„æºä¸‹è½½ </a></h1><p><br><br><br></p>
<blockquote>
<h4 id="åœ¨Demoæ‹¿åˆ°æ‰‹çš„æ—¶å€™-æˆ‘ä»¬é¦–å…ˆè¦å¯¹æˆ‘ä»¬çš„æœåŠ¡å™¨IPè¿›è¡Œè®¾ç½®-åœ¨XMPPConfig-hæ–‡ä»¶ä¸­è®¾ç½®æœåŠ¡å™¨ç›¸å…³ä¿¡æ¯"><a href="#åœ¨Demoæ‹¿åˆ°æ‰‹çš„æ—¶å€™-æˆ‘ä»¬é¦–å…ˆè¦å¯¹æˆ‘ä»¬çš„æœåŠ¡å™¨IPè¿›è¡Œè®¾ç½®-åœ¨XMPPConfig-hæ–‡ä»¶ä¸­è®¾ç½®æœåŠ¡å™¨ç›¸å…³ä¿¡æ¯" class="headerlink" title="åœ¨Demoæ‹¿åˆ°æ‰‹çš„æ—¶å€™,æˆ‘ä»¬é¦–å…ˆè¦å¯¹æˆ‘ä»¬çš„æœåŠ¡å™¨IPè¿›è¡Œè®¾ç½®.åœ¨XMPPConfig.hæ–‡ä»¶ä¸­è®¾ç½®æœåŠ¡å™¨ç›¸å…³ä¿¡æ¯!!!"></a>åœ¨Demoæ‹¿åˆ°æ‰‹çš„æ—¶å€™,æˆ‘ä»¬é¦–å…ˆè¦å¯¹æˆ‘ä»¬çš„æœåŠ¡å™¨IPè¿›è¡Œè®¾ç½®.åœ¨XMPPConfig.hæ–‡ä»¶ä¸­è®¾ç½®æœåŠ¡å™¨ç›¸å…³ä¿¡æ¯!!!</h4></blockquote>
<p><img src="http://ww1.sinaimg.cn/large/0060lm7Tgw1f1qkqxe6elj30yg0ghdhm.jpg
" alt="â€œç¥ç»éªšæ ‹â€/"></p>
<p><br></p>
<h4 id="å¦‚æœæœ‰æœ‰ä»€ä¹ˆç–‘é—®-å¯ä»¥å›å¤-è°¢è°¢å¤§å®¶"><a href="#å¦‚æœæœ‰æœ‰ä»€ä¹ˆç–‘é—®-å¯ä»¥å›å¤-è°¢è°¢å¤§å®¶" class="headerlink" title="å¦‚æœæœ‰æœ‰ä»€ä¹ˆç–‘é—®,å¯ä»¥å›å¤,è°¢è°¢å¤§å®¶"></a>å¦‚æœæœ‰æœ‰ä»€ä¹ˆç–‘é—®,å¯ä»¥å›å¤,è°¢è°¢å¤§å®¶</h4>
      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/06/22/åå±±è®ºå‰‘ä¹‹æµ…è°ˆiOSå•ä¾‹å¯¹è±¡/" rel="next" title="åå±±è®ºå‰‘ä¹‹æµ…è°ˆiOSå•ä¾‹å¯¹è±¡.">
                <i class="fa fa-chevron-left"></i> åå±±è®ºå‰‘ä¹‹æµ…è°ˆiOSå•ä¾‹å¯¹è±¡.
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/08/19/åå±±è®ºå‰‘ä¹‹æµ…è°ˆiOSç€‘å¸ƒæµ/" rel="prev" title="åå±±è®ºå‰‘ä¹‹æµ…è°ˆiOSç€‘å¸ƒæµ">
                åå±±è®ºå‰‘ä¹‹æµ…è°ˆiOSç€‘å¸ƒæµ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="ç¥ç»éªšæ ‹" />
          <p class="site-author-name" itemprop="name">ç¥ç»éªšæ ‹</p>
          <p class="site-description motion-element" itemprop="description">çºµç„¶ä¸€æ— æ‰€æœ‰.ä¹Ÿè¦å¿ƒæœ‰æ‰€å½’</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">23</span>
              <span class="site-state-item-name">æ—¥å¿—</span>
            </a>
          </div>
          
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/e39da354ce50/latest_articles" target="_blank">
                  
                    <i class="fa fa-globe"></i> github
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-6"><a class="nav-link" href="#ä¼˜ç§€çš„ä»£ç æ˜¯å®ƒè‡ªå·±æœ€å¥½çš„æ–‡æ¡£ã€‚å½“ä½ è€ƒè™‘è¦æ·»åŠ ä¸€ä¸ªæ³¨é‡Šæ—¶ï¼Œé—®é—®è‡ªå·±ï¼Œâ€œå¦‚ä½•èƒ½æ”¹è¿›è¿™æ®µä»£ç ï¼Œä»¥è®©å®ƒä¸éœ€è¦æ³¨é‡Šï¼Ÿâ€"><span class="nav-number">1.</span> <span class="nav-text">ä¼˜ç§€çš„ä»£ç æ˜¯å®ƒè‡ªå·±æœ€å¥½çš„æ–‡æ¡£ã€‚å½“ä½ è€ƒè™‘è¦æ·»åŠ ä¸€ä¸ªæ³¨é‡Šæ—¶ï¼Œé—®é—®è‡ªå·±ï¼Œâ€œå¦‚ä½•èƒ½æ”¹è¿›è¿™æ®µä»£ç ï¼Œä»¥è®©å®ƒä¸éœ€è¦æ³¨é‡Šï¼Ÿâ€</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XMPPç®€ä»‹"><span class="nav-number"></span> <span class="nav-text">XMPPç®€ä»‹</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#XMPPæ˜¯ä¸€ç§åŸºäºæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„å­é›†XMLçš„åè®®ï¼Œå®ƒç»§æ‰¿äº†åœ¨XMLç¯å¢ƒä¸­çµæ´»çš„å‘å±•æ€§ã€‚å› æ­¤ï¼ŒåŸºäºXMPPçš„åº”ç”¨å…·æœ‰è¶…å¼ºçš„å¯æ‰©å±•æ€§ã€‚ç»è¿‡æ‰©å±•ä»¥åçš„XMPPå¯ä»¥é€šè¿‡å‘é€æ‰©å±•çš„ä¿¡æ¯æ¥å¤„ç†ç”¨æˆ·çš„éœ€æ±‚ï¼Œä»¥åŠåœ¨XMPPçš„é¡¶ç«¯å»ºç«‹å¦‚å†…å®¹å‘å¸ƒç³»ç»Ÿå’ŒåŸºäºåœ°å€çš„æœåŠ¡ç­‰åº”ç”¨ç¨‹åºã€‚è€Œä¸”ï¼ŒXMPPåŒ…å«äº†é’ˆå¯¹æœåŠ¡å™¨ç«¯çš„è½¯ä»¶åè®®ï¼Œä½¿ä¹‹èƒ½ä¸å¦ä¸€ä¸ªè¿›è¡Œé€šè¯ï¼Œè¿™ä½¿å¾—å¼€å‘è€…æ›´å®¹æ˜“å»ºç«‹å®¢æˆ·åº”ç”¨ç¨‹åºæˆ–ç»™ä¸€ä¸ªé…å¥½ç³»ç»Ÿæ·»åŠ åŠŸèƒ½ã€‚"><span class="nav-number"></span> <span class="nav-text">XMPPæ˜¯ä¸€ç§åŸºäºæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„å­é›†XMLçš„åè®®ï¼Œå®ƒç»§æ‰¿äº†åœ¨XMLç¯å¢ƒä¸­çµæ´»çš„å‘å±•æ€§ã€‚å› æ­¤ï¼ŒåŸºäºXMPPçš„åº”ç”¨å…·æœ‰è¶…å¼ºçš„å¯æ‰©å±•æ€§ã€‚ç»è¿‡æ‰©å±•ä»¥åçš„XMPPå¯ä»¥é€šè¿‡å‘é€æ‰©å±•çš„ä¿¡æ¯æ¥å¤„ç†ç”¨æˆ·çš„éœ€æ±‚ï¼Œä»¥åŠåœ¨XMPPçš„é¡¶ç«¯å»ºç«‹å¦‚å†…å®¹å‘å¸ƒç³»ç»Ÿå’ŒåŸºäºåœ°å€çš„æœåŠ¡ç­‰åº”ç”¨ç¨‹åºã€‚è€Œä¸”ï¼ŒXMPPåŒ…å«äº†é’ˆå¯¹æœåŠ¡å™¨ç«¯çš„è½¯ä»¶åè®®ï¼Œä½¿ä¹‹èƒ½ä¸å¦ä¸€ä¸ªè¿›è¡Œé€šè¯ï¼Œè¿™ä½¿å¾—å¼€å‘è€…æ›´å®¹æ˜“å»ºç«‹å®¢æˆ·åº”ç”¨ç¨‹åºæˆ–ç»™ä¸€ä¸ªé…å¥½ç³»ç»Ÿæ·»åŠ åŠŸèƒ½ã€‚</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XMPPåè®®çš„å®ç°åŸç†è¿‡ç¨‹"><span class="nav-number"></span> <span class="nav-text">XMPPåè®®çš„å®ç°åŸç†è¿‡ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å½“æˆ‘ä»¬çŸ¥é“XMPPæ˜¯ä¸€ç§åè®®çš„æ—¶å€™-æˆ‘ä»¬å¦‚ä½•é€šè¿‡objective-c-ä»£ç å®ç°XMPPåè®®-è¿›è€Œå®ç°æˆ‘ä»¬çš„å³æ—¶é€šè®¯åŠŸèƒ½å‘¢-ä¸‹é¢çš„å›¾ç‰‡å°±æ˜¯ä¸ºæˆ‘ä»¬åšäº†å¾ˆå¥½çš„è§£é‡Š"><span class="nav-number"></span> <span class="nav-text">å½“æˆ‘ä»¬çŸ¥é“XMPPæ˜¯ä¸€ç§åè®®çš„æ—¶å€™,æˆ‘ä»¬å¦‚ä½•é€šè¿‡objective-c ä»£ç å®ç°XMPPåè®®,è¿›è€Œå®ç°æˆ‘ä»¬çš„å³æ—¶é€šè®¯åŠŸèƒ½å‘¢? ä¸‹é¢çš„å›¾ç‰‡å°±æ˜¯ä¸ºæˆ‘ä»¬åšäº†å¾ˆå¥½çš„è§£é‡Š.</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XMPPåè®®çš„ä»£ç å®ç°"><span class="nav-number"></span> <span class="nav-text">XMPPåè®®çš„ä»£ç å®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-å‡†å¤‡å·¥ä½œ"><span class="nav-number"></span> <span class="nav-text">1.å‡†å¤‡å·¥ä½œ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#æˆ‘ä»¬åšçš„å®¢æˆ·ç«¯ä¹ŸæœåŠ¡å™¨é€šè®¯é€šé“çš„å®ç°ä»¥åŠæ•°æ®äº¤æµ-é‚£ä¹ˆé¦–å…ˆè¦æœ‰æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨-å½“ç„¶äº†-åœ¨å…¬å¸çš„å¥½è¯´ä¸€äº›-å¦‚æœæ˜¯ä¸ªäººç ”ç©¶æŠ€æœ¯æ€ä¹ˆåŠå‘¢-æˆ‘ä»¬å¯ä»¥è‡ªå·±æ­å»ºä¸€ä¸ªæœåŠ¡å™¨æˆ–è€…ä½¿ç”¨leancloudè¿™ç§ç¬¬ä¸‰æ–¹æœåŠ¡å™¨-è¿™é‡Œæˆ‘ç»™å¤§å®¶æä¾›ä¸€äº›æ­å»ºæœåŠ¡å™¨çš„å·¥å…·-å½“ç„¶äº†-è‡ªå·±æ­å»ºçš„æœåŠ¡å™¨ç”Ÿå‘½æ¯”è¾ƒè„†å¼±-è¯·å¤§å®¶å¥½å¥½çˆ±æŠ¤-è¿˜æœ‰å°±æ˜¯leancloudä¹Ÿæ˜¯æˆ‘æ¨èçš„ä¸€ç§æ–¹æ³•"><span class="nav-number"></span> <span class="nav-text">æˆ‘ä»¬åšçš„å®¢æˆ·ç«¯ä¹ŸæœåŠ¡å™¨é€šè®¯é€šé“çš„å®ç°ä»¥åŠæ•°æ®äº¤æµ,é‚£ä¹ˆé¦–å…ˆè¦æœ‰æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨,å½“ç„¶äº†,åœ¨å…¬å¸çš„å¥½è¯´ä¸€äº›,å¦‚æœæ˜¯ä¸ªäººç ”ç©¶æŠ€æœ¯æ€ä¹ˆåŠå‘¢?æˆ‘ä»¬å¯ä»¥è‡ªå·±æ­å»ºä¸€ä¸ªæœåŠ¡å™¨æˆ–è€…ä½¿ç”¨leancloudè¿™ç§ç¬¬ä¸‰æ–¹æœåŠ¡å™¨,è¿™é‡Œæˆ‘ç»™å¤§å®¶æä¾›ä¸€äº›æ­å»ºæœåŠ¡å™¨çš„å·¥å…·,å½“ç„¶äº†,è‡ªå·±æ­å»ºçš„æœåŠ¡å™¨ç”Ÿå‘½æ¯”è¾ƒè„†å¼±,è¯·å¤§å®¶å¥½å¥½çˆ±æŠ¤~è¿˜æœ‰å°±æ˜¯leancloudä¹Ÿæ˜¯æˆ‘æ¨èçš„ä¸€ç§æ–¹æ³•.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#â€”â€“-gt-ç‚¹å‡»å‰å¾€LeanCloudå®˜æ–¹ç½‘ç«™"><span class="nav-number"></span> <span class="nav-text">â€”â€“>ç‚¹å‡»å‰å¾€LeanCloudå®˜æ–¹ç½‘ç«™</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#â€”â€“-gt-XMPPæœ¬åœ°æœåŠ¡å™¨æ­å»ºå·¥å…·ä¸‹è½½"><span class="nav-number"></span> <span class="nav-text">â€”â€“>XMPPæœ¬åœ°æœåŠ¡å™¨æ­å»ºå·¥å…·ä¸‹è½½</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-OCæ­å»ºClientå’Œè¿æ¥é€šé“"><span class="nav-number"></span> <span class="nav-text">2.OCæ­å»ºClientå’Œè¿æ¥é€šé“</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å·¥ç¨‹å®Œæˆç›®æ ‡"><span class="nav-number"></span> <span class="nav-text">å·¥ç¨‹å®Œæˆç›®æ ‡:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#é¦–å…ˆ-æˆ‘ä»¬éœ€è¦å¯¼å…¥æˆ‘ä»¬çš„æ‰€éœ€è¦å¯¼å…¥çš„-XMPPFramework-PS-ç‚¹å‡»æ‰“å¼€ä¸‹è½½-å®Œæˆä¹‹åç›´æ¥è§£å‹æ‹–åˆ°å·¥ç¨‹ä¸­ğŸ˜ƒ-è¿˜æœ‰æ‰‹åŠ¨çš„å¯¼å…¥ä¸¤ä¸ªåº“-å¦‚ä¸‹"><span class="nav-number"></span> <span class="nav-text">é¦–å…ˆ,æˆ‘ä»¬éœ€è¦å¯¼å…¥æˆ‘ä»¬çš„æ‰€éœ€è¦å¯¼å…¥çš„ XMPPFramework (PS:ç‚¹å‡»æ‰“å¼€ä¸‹è½½,å®Œæˆä¹‹åç›´æ¥è§£å‹æ‹–åˆ°å·¥ç¨‹ä¸­ğŸ˜ƒ),è¿˜æœ‰æ‰‹åŠ¨çš„å¯¼å…¥ä¸¤ä¸ªåº“.å¦‚ä¸‹.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç„¶å-æˆ‘ä»¬å°±è¦é…ç½®æˆ‘ä»¬çš„build-settingé¡µé¢çš„è®¾ç½®-search-paths-é€‰æ·»åŠ ä¸€ä¸ªå­—æ®µ-æ·»åŠ å¦‚ä¸‹"><span class="nav-number"></span> <span class="nav-text">ç„¶å,æˆ‘ä»¬å°±è¦é…ç½®æˆ‘ä»¬çš„build settingé¡µé¢çš„è®¾ç½® search paths é€‰æ·»åŠ ä¸€ä¸ªå­—æ®µ,æ·»åŠ å¦‚ä¸‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å®Œæˆä¸Šé¢çš„è®¾ç½®ä¹‹å-æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå•ä¾‹ç±»XMPPManager-ç”¨å®ƒæ¥åˆ›å»ºé€šè®¯é€šé“å®ç°ä¸Šé¢çš„å››ä¸ªåŠŸèƒ½"><span class="nav-number"></span> <span class="nav-text">å®Œæˆä¸Šé¢çš„è®¾ç½®ä¹‹å  æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå•ä¾‹ç±»XMPPManager,ç”¨å®ƒæ¥åˆ›å»ºé€šè®¯é€šé“å®ç°ä¸Šé¢çš„å››ä¸ªåŠŸèƒ½.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XMPPManager-hæ–‡ä»¶çš„è§£é‡Š"><span class="nav-number"></span> <span class="nav-text">XMPPManager.hæ–‡ä»¶çš„è§£é‡Š:</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#stream-è¿™æ˜¯Cå’ŒSä¹‹é—´çš„é€šè®¯é€šé“"><span class="nav-number"></span> <span class="nav-text">stream : è¿™æ˜¯Cå’ŒSä¹‹é—´çš„é€šè®¯é€šé“.</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#roster-è¿™ä¸ªå±æ€§ç®¡ç†å¥½å‹åˆ—è¡¨çš„ä¸€ä¸ªå±æ€§"><span class="nav-number"></span> <span class="nav-text">roster : è¿™ä¸ªå±æ€§ç®¡ç†å¥½å‹åˆ—è¡¨çš„ä¸€ä¸ªå±æ€§.</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#messageArchiving-è¿™ä¸ªå±æ€§ç”¨æ¥ç®¡ç†æœ¬åœ°èŠå¤©è®°å½•çš„ä¸€ä¸ªç±»"><span class="nav-number"></span> <span class="nav-text">messageArchiving : è¿™ä¸ªå±æ€§ç”¨æ¥ç®¡ç†æœ¬åœ°èŠå¤©è®°å½•çš„ä¸€ä¸ªç±»</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#messageContext-æ¶ˆæ¯ä¸Šä¸‹æ–‡å¯¹è±¡"><span class="nav-number"></span> <span class="nav-text">messageContext : æ¶ˆæ¯ä¸Šä¸‹æ–‡å¯¹è±¡.</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#instancetype-defaulManager-åˆ›å»ºå•ä¾‹çš„æ–¹æ³•"><span class="nav-number"></span> <span class="nav-text">+(instancetype)defaulManager:åˆ›å»ºå•ä¾‹çš„æ–¹æ³•</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#void-LoginWithUserName-NSString-name-AndPassWord-NSString-password-ç™»å½•çš„æ–¹æ³•"><span class="nav-number"></span> <span class="nav-text">-(void)LoginWithUserName:(NSString )name AndPassWord:(NSString )password : ç™»å½•çš„æ–¹æ³•</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#void-RegiserWithUserName-NSString-name-AndPassWord-NSString-password-æ³¨å†Œæ–°è´¦å·çš„æ–¹æ³•"><span class="nav-number"></span> <span class="nav-text">-(void)RegiserWithUserName:(NSString )name AndPassWord:(NSString )password : æ³¨å†Œæ–°è´¦å·çš„æ–¹æ³•</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#void-disconnectWithServer-ä¸æœåŠ¡å™¨æ–­å¼€é“¾æ¥"><span class="nav-number"></span> <span class="nav-text">-(void)disconnectWithServer;  ä¸æœåŠ¡å™¨æ–­å¼€é“¾æ¥</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#äº†è§£å®Œå„ä¸ªæ–¹æ³•ä¹‹å-æˆ‘ä»¬å°±è¦åœ¨XMPPManager-må®ç°ä¸€ä¸‹-å®ç°å¦‚ä¸‹"><span class="nav-number"></span> <span class="nav-text">äº†è§£å®Œå„ä¸ªæ–¹æ³•ä¹‹å,æˆ‘ä»¬å°±è¦åœ¨XMPPManager.må®ç°ä¸€ä¸‹,å®ç°å¦‚ä¸‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#çœ‹å®Œäº†ä¸Šé¢çš„ä»£ç -è¿æˆ‘è‡ªå·±éƒ½è§‰å¾—ä¹±ä¹±çš„-æ‰€ä»¥-æˆ‘ä»¬ä¸€ä¸ªåŠŸèƒ½ä¸€ä¸ªåŠŸèƒ½çœ‹è¿™äº›ä»£ç çš„å®ç°åŸç†"><span class="nav-number"></span> <span class="nav-text">çœ‹å®Œäº†ä¸Šé¢çš„ä»£ç ,è¿æˆ‘è‡ªå·±éƒ½è§‰å¾—ä¹±ä¹±çš„,æ‰€ä»¥ æˆ‘ä»¬ä¸€ä¸ªåŠŸèƒ½ä¸€ä¸ªåŠŸèƒ½çœ‹è¿™äº›ä»£ç çš„å®ç°åŸç†,</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç™»å½•åŠŸèƒ½"><span class="nav-number"></span> <span class="nav-text">ç™»å½•åŠŸèƒ½</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æˆ‘ä»¬æƒ³è¦ç™»å½•æˆ‘ä»¬çš„æœåŠ¡å™¨-é¦–å…ˆè¦æœ‰æˆ‘ä»¬çš„è´¦å·å’Œå¯†ç -ç„¶åæˆ‘ä»¬å°±éœ€è¦å»ºç«‹é€šé“"><span class="nav-number"></span> <span class="nav-text">æˆ‘ä»¬æƒ³è¦ç™»å½•æˆ‘ä»¬çš„æœåŠ¡å™¨,é¦–å…ˆè¦æœ‰æˆ‘ä»¬çš„è´¦å·å’Œå¯†ç ,ç„¶åæˆ‘ä»¬å°±éœ€è¦å»ºç«‹é€šé“</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-defaulManager"><span class="nav-number"></span> <span class="nav-text">(a)defaulManager</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#åˆ›å»ºå•ä¾‹è¿™ä¸ªæ–¹æ³•ä¸­å°±æ˜¯åˆ›å»ºäº†æˆ‘ä»¬çš„å•ä¾‹"><span class="nav-number"></span> <span class="nav-text">åˆ›å»ºå•ä¾‹è¿™ä¸ªæ–¹æ³•ä¸­å°±æ˜¯åˆ›å»ºäº†æˆ‘ä»¬çš„å•ä¾‹.</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-init"><span class="nav-number"></span> <span class="nav-text">(b)init</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#åˆå§‹åŒ–è¿™ä¸ªæ–¹æ³•ä¸­æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„é€šè®¯ç®¡é“å±æ€§streamè¿›è¡Œåˆå§‹åŒ–ä¸€ä¸‹-è®¾ç½®streamæœåŠ¡å™¨IPåœ°å€å’ŒæœåŠ¡å™¨ç«¯å£-è¿˜æœ‰å°±æ˜¯è®¾ç½®streamçš„ä»£ç†å¯¹è±¡-å®ç°XMPPStreamDelegateåè®®æ–¹æ³•-è¿™é‡Œè®¾ç½®ä»£ç†å¯¹è±¡çš„æ–¹æ³•ä¸åŒäºä»¥å‰-è¿™é‡Œæ˜¯ä½¿ç”¨runtimeè®¾è®¡æ¨¡å¼å¯ä»¥ä¸ºstreamè®¾ç½®å¤šä¸ªä»£ç†å¯¹è±¡"><span class="nav-number"></span> <span class="nav-text">åˆå§‹åŒ–è¿™ä¸ªæ–¹æ³•ä¸­æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„é€šè®¯ç®¡é“å±æ€§streamè¿›è¡Œåˆå§‹åŒ–ä¸€ä¸‹,è®¾ç½®streamæœåŠ¡å™¨IPåœ°å€å’ŒæœåŠ¡å™¨ç«¯å£,è¿˜æœ‰å°±æ˜¯è®¾ç½®streamçš„ä»£ç†å¯¹è±¡.å®ç°XMPPStreamDelegateåè®®æ–¹æ³•.è¿™é‡Œè®¾ç½®ä»£ç†å¯¹è±¡çš„æ–¹æ³•ä¸åŒäºä»¥å‰,è¿™é‡Œæ˜¯ä½¿ç”¨runtimeè®¾è®¡æ¨¡å¼å¯ä»¥ä¸ºstreamè®¾ç½®å¤šä¸ªä»£ç†å¯¹è±¡.</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#c-LoginWithUserName-NSString-name-AndPassWord-NSString-password"><span class="nav-number"></span> <span class="nav-text">(c)LoginWithUserName:(NSString )name AndPassWord:(NSString )password</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#è¿™ä¸ªæ–¹æ³•ä¸­é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¿å­˜æˆ‘ä»¬çš„å¯†ç -ç”¨äºä¼ å€¼åˆ°ä¸‹ä¸€ä¸ªæ–¹æ³•ä¸­-self-type-DoLgin-è¿™å¥ä»£ç æœ‰ä½œä½•è§£é‡Šå‘¢-å› ä¸ºä¸ç®¡æ˜¯ç™»å½•å’Œæ³¨å†Œ-æˆ‘ä»¬éƒ½è¦ä¸æˆ‘ä»¬çš„æœåŠ¡å™¨åˆ›å»ºè”ç³»-é‚£ä¹ˆæœåŠ¡å™¨æ˜¯å¦‚ä½•çŸ¥é“æˆ‘ä»¬æ˜¯åˆ›å»ºçš„ä»€ä¹ˆè”ç³»çš„å‘¢-å°±æ˜¯é€šè¿‡è¿™å¥ä»£ç å®ç°çš„-å½“ç„¶äº†-ç°åœ¨ä½ å¯èƒ½å¬å¾—ç³Šæ¶‚-å½“çœ‹åˆ°ä¸‹é¢çš„æ–¹æ³•çš„æ—¶å€™ä½ å°±æ˜ç™½äº†-self-connectToServerWintUser-name-è¿™å¥ä»£ç å°±æ˜¯è¦åˆ›å»ºäºæœåŠ¡å™¨ä¹‹é—´çš„è”ç³»-è¿™æ—¶å€™-è´¦å·nameå°±é€šè¿‡å‚æ•°çš„å½¢å¼ä¼ åˆ°äº†connectToServerWintUserè¿™ä¸ªå‡½æ•°-è€Œpasswordé€šè¿‡å±æ€§çš„ä¼ å€¼åˆ°xmppStreamDidConnect-å½“å®Œæˆé€šé“çš„å»ºç«‹çš„æ—¶å€™æ‰§è¡Œçš„ä»£ç†æ–¹æ³•"><span class="nav-number"></span> <span class="nav-text">è¿™ä¸ªæ–¹æ³•ä¸­é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¿å­˜æˆ‘ä»¬çš„å¯†ç ,ç”¨äºä¼ å€¼åˆ°ä¸‹ä¸€ä¸ªæ–¹æ³•ä¸­.self.type = DoLgin;è¿™å¥ä»£ç æœ‰ä½œä½•è§£é‡Šå‘¢?å› ä¸ºä¸ç®¡æ˜¯ç™»å½•å’Œæ³¨å†Œ,æˆ‘ä»¬éƒ½è¦ä¸æˆ‘ä»¬çš„æœåŠ¡å™¨åˆ›å»ºè”ç³»,é‚£ä¹ˆæœåŠ¡å™¨æ˜¯å¦‚ä½•çŸ¥é“æˆ‘ä»¬æ˜¯åˆ›å»ºçš„ä»€ä¹ˆè”ç³»çš„å‘¢?å°±æ˜¯é€šè¿‡è¿™å¥ä»£ç å®ç°çš„,å½“ç„¶äº†,ç°åœ¨ä½ å¯èƒ½å¬å¾—ç³Šæ¶‚,å½“çœ‹åˆ°ä¸‹é¢çš„æ–¹æ³•çš„æ—¶å€™ä½ å°±æ˜ç™½äº†.[self connectToServerWintUser:name];è¿™å¥ä»£ç å°±æ˜¯è¦åˆ›å»ºäºæœåŠ¡å™¨ä¹‹é—´çš„è”ç³».è¿™æ—¶å€™,è´¦å·nameå°±é€šè¿‡å‚æ•°çš„å½¢å¼ä¼ åˆ°äº†connectToServerWintUserè¿™ä¸ªå‡½æ•°,è€Œpasswordé€šè¿‡å±æ€§çš„ä¼ å€¼åˆ°xmppStreamDidConnect(å½“å®Œæˆé€šé“çš„å»ºç«‹çš„æ—¶å€™æ‰§è¡Œçš„ä»£ç†æ–¹æ³•).</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#d-connectToServerWintUser"><span class="nav-number"></span> <span class="nav-text">(d)connectToServerWintUser</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#self-stream-disconnect-è¿™å¥ä»£ç å°±æ˜¯è®©å®¢æˆ·ç«¯æ–­å¼€è¿æ¥é€šé“-ç»¼åˆä¸Šé¢æ¥çœ‹-å½“æˆ‘ä»¬å·²ç»å­˜åœ¨çš„è¿æ¥çš„é€šé“çš„æ—¶å€™-æˆ‘ä»¬å°±ä¼šè®©é€šé“æ–­å¼€-è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢-å› ä¸ºCä¸Sä¹‹é—´çš„é€šé“åªèƒ½åˆ›å»ºä¸€æ¡-å½“æˆ‘ä»¬é‡å¤åˆ›å»ºçš„æ—¶å€™-å°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºå´©æºƒ-æ‰€ä»¥æˆ‘ä»¬è¦ä¿éšœæˆ‘ä»¬çš„é€šé“æ˜¯åªæœ‰ä¸€æ¡çš„-self-stream-connectWithTimeout-30-0f-error-amp-error-è¿™å¥ä»£ç å°±æ˜¯æˆ‘ä»¬åˆ›å»ºé€šé“-å½“ç„¶äº†ç­‰å¾…æ—¶é—´æ˜¯30ç§’"><span class="nav-number"></span> <span class="nav-text">[self.stream disconnect];è¿™å¥ä»£ç å°±æ˜¯è®©å®¢æˆ·ç«¯æ–­å¼€è¿æ¥é€šé“,ç»¼åˆä¸Šé¢æ¥çœ‹,å½“æˆ‘ä»¬å·²ç»å­˜åœ¨çš„è¿æ¥çš„é€šé“çš„æ—¶å€™,æˆ‘ä»¬å°±ä¼šè®©é€šé“æ–­å¼€,è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢?å› ä¸ºCä¸Sä¹‹é—´çš„é€šé“åªèƒ½åˆ›å»ºä¸€æ¡,å½“æˆ‘ä»¬é‡å¤åˆ›å»ºçš„æ—¶å€™,å°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºå´©æºƒ.æ‰€ä»¥æˆ‘ä»¬è¦ä¿éšœæˆ‘ä»¬çš„é€šé“æ˜¯åªæœ‰ä¸€æ¡çš„.    [self.stream connectWithTimeout:30.0f error:&error];è¿™å¥ä»£ç å°±æ˜¯æˆ‘ä»¬åˆ›å»ºé€šé“,å½“ç„¶äº†ç­‰å¾…æ—¶é—´æ˜¯30ç§’.</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#e-xmppStreamDidConnect"><span class="nav-number"></span> <span class="nav-text">(e)xmppStreamDidConnect</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#è¿™æ˜¯ä¸€ä¸ªä»£ç†çš„æ–¹æ³•-å½“æˆ‘ä»¬å®Œæˆé€šé“çš„åˆ›å»ºä¹‹å-æˆ‘ä»¬å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•-åœ¨è¿™ä¸ªä»£ç†æ–¹æ³•ä¸­æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å¯¹æˆ‘ä»¬çš„å¯†ç è¿›è¡ŒéªŒè¯-self-stream-authenticateWithPassword-self-password-error-amp-error-è¿™å°±æ˜¯ç™»å½•éªŒè¯æˆ‘ä»¬çš„å¯†ç -éªŒè¯æˆåŠŸä¹‹åå°±ä¼šè°ƒç”¨-void-xmppStreamDidAuthenticate-XMPPStream-senderè¿™ä¸ªä»£ç†æ–¹æ³•-éªŒè¯å¤±è´¥å°±ä¼šè°ƒç”¨-void-xmppStream-XMPPStream-sender-didNotAuthenticate-DDXMLElement-error-è¿™ä¸ªä»£ç†æ–¹æ³•-å½“ç„¶äº†-è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯å†™åœ¨æˆ‘ä»¬çš„ç™»å½•é¡µé¢çš„-å› ä¸ºæˆ‘ä»¬éœ€è¦å¯¹ä½¿ç”¨è€…æœ‰ä¸ªç”¨æˆ·çš„äº¤äº’ä¸æ˜¯-æ¯”å¦‚å¼¹å‡ºä¸€ä¸ªå¼¹çª—-æé†’ä¸€ä¸‹ç”¨æˆ·-xmppStreamDidConnectä¸ç®¡æ˜¯æ³¨å†Œå’Œç™»å½•éƒ½ä¼šè°ƒç”¨-æˆ‘ä»¬æ€ä¹ˆåŒºåˆ†å‘¢-æˆ‘ä»¬ç°åœ¨-mæ–‡ä»¶çš„é¡¶éƒ¨è®¾ç½®äº†ä¸€ä¸ªæšä¸¾å€¼-é€šè¿‡æšä¸¾å€¼çš„å€¼åˆ¤æ–­æˆ‘ä»¬æ‰€éœ€è¦çš„æ“ä½œ"><span class="nav-number"></span> <span class="nav-text">è¿™æ˜¯ä¸€ä¸ªä»£ç†çš„æ–¹æ³•,å½“æˆ‘ä»¬å®Œæˆé€šé“çš„åˆ›å»ºä¹‹å,æˆ‘ä»¬å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•,åœ¨è¿™ä¸ªä»£ç†æ–¹æ³•ä¸­æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å¯¹æˆ‘ä»¬çš„å¯†ç è¿›è¡ŒéªŒè¯.[self.stream authenticateWithPassword:self.password error:&error];è¿™å°±æ˜¯ç™»å½•éªŒè¯æˆ‘ä»¬çš„å¯†ç .éªŒè¯æˆåŠŸä¹‹åå°±ä¼šè°ƒç”¨-(void)xmppStreamDidAuthenticate:(XMPPStream )senderè¿™ä¸ªä»£ç†æ–¹æ³•,éªŒè¯å¤±è´¥å°±ä¼šè°ƒç”¨-(void)xmppStream:(XMPPStream )sender didNotAuthenticate:(DDXMLElement *)error è¿™ä¸ªä»£ç†æ–¹æ³•,å½“ç„¶äº†,è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯å†™åœ¨æˆ‘ä»¬çš„ç™»å½•é¡µé¢çš„,å› ä¸ºæˆ‘ä»¬éœ€è¦å¯¹ä½¿ç”¨è€…æœ‰ä¸ªç”¨æˆ·çš„äº¤äº’ä¸æ˜¯?æ¯”å¦‚å¼¹å‡ºä¸€ä¸ªå¼¹çª—.æé†’ä¸€ä¸‹ç”¨æˆ·.xmppStreamDidConnectä¸ç®¡æ˜¯æ³¨å†Œå’Œç™»å½•éƒ½ä¼šè°ƒç”¨,æˆ‘ä»¬æ€ä¹ˆåŒºåˆ†å‘¢?æˆ‘ä»¬ç°åœ¨.mæ–‡ä»¶çš„é¡¶éƒ¨è®¾ç½®äº†ä¸€ä¸ªæšä¸¾å€¼,é€šè¿‡æšä¸¾å€¼çš„å€¼åˆ¤æ–­æˆ‘ä»¬æ‰€éœ€è¦çš„æ“ä½œ.</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#f-xmppStreamConnectDidTimeout"><span class="nav-number"></span> <span class="nav-text">(f)xmppStreamConnectDidTimeout</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#è¿™ä¸ªæ–¹æ³•å°±æ˜¯è¯´-å½“æˆ‘ä»¬ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥è¶…æ—¶çš„æ—¶å€™ä¼šè¿›è¡Œçš„æ“ä½œ-throw-NSException-exceptionWithName-â€CQ-Errorâ€-reason-â€ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥è¶…æ—¶-è¯·æŸ¥çœ‹ä»£ç â€-userInfo-nil-æ˜¯æˆ‘ä»¬æ‰‹åŠ¨çš„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸"><span class="nav-number"></span> <span class="nav-text">è¿™ä¸ªæ–¹æ³•å°±æ˜¯è¯´,å½“æˆ‘ä»¬ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥è¶…æ—¶çš„æ—¶å€™ä¼šè¿›è¡Œçš„æ“ä½œ.@throw [NSException exceptionWithName:@â€CQ_Errorâ€ reason:@â€ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥è¶…æ—¶,è¯·æŸ¥çœ‹ä»£ç â€ userInfo:nil];æ˜¯æˆ‘ä»¬æ‰‹åŠ¨çš„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸.</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ³¨å†ŒåŠŸèƒ½"><span class="nav-number"></span> <span class="nav-text">æ³¨å†ŒåŠŸèƒ½</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#xmppStreamDidConnect"><span class="nav-number"></span> <span class="nav-text">xmppStreamDidConnect</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#åœ¨è¿™ä¸ªæ–¹æ³•ä¸­-æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„æ³¨å†Œæ–¹æ³•ä¸ç™»å½•æ–¹æ³•åˆ†åˆ«å¼€æ¥-self-stream-registerWithPassword-self-regiserPassword-error-amp-error-è¿™ä¸ªæ–¹æ³•å°±æ˜¯æˆ‘ä»¬æŠŠæ³¨å†Œçš„å¯†ç ä¼ åˆ°æœåŠ¡å™¨ä¸Šä¿å­˜çš„æ–¹æ³•-å½“ç„¶äº†-å½“æˆ‘ä»¬æ³¨å†ŒæˆåŠŸçš„æ—¶å€™-å°±ä¼šè°ƒåŠ¨-void-xmppStreamDidRegister-XMPPStream-senderè¿™ä¸ªåè®®æ–¹æ³•-å½“æ³¨å†Œä¸æˆåŠŸçš„æ—¶å€™-æˆ‘ä»¬å°±ä¼šè°ƒç”¨-void-xmppStream-XMPPStream-sender-didNotRegister-DDXMLElement-errorè¿™ä¸ªæ–¹æ³•-è¿™é‡Œæˆ‘ä»¬ä¹Ÿè¦æ‹ç»™æˆ‘ä»¬çš„ç”¨æˆ·ä¸€äº›äº¤äº’-è®©æˆ‘ä»¬ç”¨æˆ·çŸ¥é“è‡ªå·±æ³¨å†Œçš„ç»“æœ"><span class="nav-number"></span> <span class="nav-text">åœ¨è¿™ä¸ªæ–¹æ³•ä¸­,æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„æ³¨å†Œæ–¹æ³•ä¸ç™»å½•æ–¹æ³•åˆ†åˆ«å¼€æ¥.            [self.stream registerWithPassword:self.regiserPassword error:&error];è¿™ä¸ªæ–¹æ³•å°±æ˜¯æˆ‘ä»¬æŠŠæ³¨å†Œçš„å¯†ç ä¼ åˆ°æœåŠ¡å™¨ä¸Šä¿å­˜çš„æ–¹æ³•.å½“ç„¶äº†,å½“æˆ‘ä»¬æ³¨å†ŒæˆåŠŸçš„æ—¶å€™,å°±ä¼šè°ƒåŠ¨-(void)xmppStreamDidRegister:(XMPPStream )senderè¿™ä¸ªåè®®æ–¹æ³•,å½“æ³¨å†Œä¸æˆåŠŸçš„æ—¶å€™,æˆ‘ä»¬å°±ä¼šè°ƒç”¨-(void)xmppStream:(XMPPStream )sender didNotRegister:(DDXMLElement *)errorè¿™ä¸ªæ–¹æ³•.è¿™é‡Œæˆ‘ä»¬ä¹Ÿè¦æ‹ç»™æˆ‘ä»¬çš„ç”¨æˆ·ä¸€äº›äº¤äº’,è®©æˆ‘ä»¬ç”¨æˆ·çŸ¥é“è‡ªå·±æ³¨å†Œçš„ç»“æœ.</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¥½å‹åˆ—è¡¨åŠŸèƒ½"><span class="nav-number"></span> <span class="nav-text">å¥½å‹åˆ—è¡¨åŠŸèƒ½</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#åœ¨XMPPManager-mæ–‡ä»¶ä¸­-æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åœ¨-init-æ–¹æ³•ä¸­å¯¹ç®¡ç†å¥½å‹åˆ—è¡¨çš„rosterå¯¹è±¡è¿›è¡Œä¸€ä¸‹åˆå§‹åŒ–å¹¶ä¸”åˆ¶å®šä»£ç†-è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªåœ°æ–¹-å½“æˆ‘ä»¬è®¾ç½®rosterçš„åˆå§‹åŒ–çš„æ—¶å€™-æˆ‘ä»¬éœ€è¦ä½¿ç”¨-dispatch-get-global-queue-0-0-å…¨å±€çº¿ç¨‹-ä¸èƒ½ä½¿ç”¨ä¸»çº¿ç¨‹-åŸå› æ˜¯å¦‚æœä½¿ç”¨ä¸»çº¿ç¨‹ä¼šå‡ºç°ä¸€äº›è«åå…¶å¦™çš„Bug-self-roster-activate-self-stream-æ¿€æ´»rosterçš„æ„æ€å°±æ˜¯ç»™rosterå¯ä»¥é€šè¿‡streamé€šé“çš„æƒé™-PS-å¤§ç™½è¯-ğŸ˜‚"><span class="nav-number"></span> <span class="nav-text">åœ¨XMPPManager.mæ–‡ä»¶ä¸­,æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åœ¨  init  æ–¹æ³•ä¸­å¯¹ç®¡ç†å¥½å‹åˆ—è¡¨çš„rosterå¯¹è±¡è¿›è¡Œä¸€ä¸‹åˆå§‹åŒ–å¹¶ä¸”åˆ¶å®šä»£ç†,è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªåœ°æ–¹,å½“æˆ‘ä»¬è®¾ç½®rosterçš„åˆå§‹åŒ–çš„æ—¶å€™,æˆ‘ä»¬éœ€è¦ä½¿ç”¨  dispatch_get_global_queue(0, 0) å…¨å±€çº¿ç¨‹,ä¸èƒ½ä½¿ç”¨ä¸»çº¿ç¨‹,åŸå› æ˜¯å¦‚æœä½¿ç”¨ä¸»çº¿ç¨‹ä¼šå‡ºç°ä¸€äº›è«åå…¶å¦™çš„Bug.        [self.roster activate:self.stream]; æ¿€æ´»rosterçš„æ„æ€å°±æ˜¯ç»™rosterå¯ä»¥é€šè¿‡streamé€šé“çš„æƒé™..(PS:å¤§ç™½è¯ ğŸ˜‚)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åœ¨æˆ‘ä»¬çš„å¥½å‹åˆ—è¡¨é¡µé¢ä¸­-é¦–å…ˆæˆ‘ä»¬éœ€è¦ç¡®å®šä»–æ˜¯ä¸€ä¸ªUITableViewController-ç„¶åæˆ‘ä»¬éœ€è¦ä»æˆ‘ä»¬çš„æœåŠ¡å™¨æ‹¿åˆ°æˆ‘ä»¬çš„å¥½å‹çš„åˆ—è¡¨æ•°ç»„-é€šé“streamè¿æ¥åœ¨æˆ‘ä»¬çš„ç™»å½•çš„æ—¶å€™å·²ç»å®Œæˆäº†-æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å†ç®¡ç†é€šé“äº†-æˆ‘ä»¬éœ€è¦åœ¨å¥½å‹åˆ—è¡¨çš„æ§åˆ¶å™¨ä¸­å®ç°XMPPRosterDelegateçš„ä»£ç†æ–¹æ³•æ¥è·å–åˆ°æˆ‘ä»¬çš„å¥½å‹åˆ—è¡¨-ä»£ç å¦‚ä¸‹"><span class="nav-number"></span> <span class="nav-text">åœ¨æˆ‘ä»¬çš„å¥½å‹åˆ—è¡¨é¡µé¢ä¸­,é¦–å…ˆæˆ‘ä»¬éœ€è¦ç¡®å®šä»–æ˜¯ä¸€ä¸ªUITableViewController,ç„¶åæˆ‘ä»¬éœ€è¦ä»æˆ‘ä»¬çš„æœåŠ¡å™¨æ‹¿åˆ°æˆ‘ä»¬çš„å¥½å‹çš„åˆ—è¡¨æ•°ç»„.é€šé“streamè¿æ¥åœ¨æˆ‘ä»¬çš„ç™»å½•çš„æ—¶å€™å·²ç»å®Œæˆäº†,æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å†ç®¡ç†é€šé“äº†,æˆ‘ä»¬éœ€è¦åœ¨å¥½å‹åˆ—è¡¨çš„æ§åˆ¶å™¨ä¸­å®ç°XMPPRosterDelegateçš„ä»£ç†æ–¹æ³•æ¥è·å–åˆ°æˆ‘ä»¬çš„å¥½å‹åˆ—è¡¨.ä»£ç å¦‚ä¸‹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ–¹æ³•è§£é‡Š"><span class="nav-number"></span> <span class="nav-text">æ–¹æ³•è§£é‡Š</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#åœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬è¦è§£é‡Šçš„åªæœ‰ä¸¤ä¸ªæ–¹æ³•-ä¸€ä¸ªæ˜¯è·å–å¥½å‹ä¿¡æ¯çš„æ—¶å€™è°ƒç”¨çš„"><span class="nav-number"></span> <span class="nav-text">åœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬è¦è§£é‡Šçš„åªæœ‰ä¸¤ä¸ªæ–¹æ³• ,ä¸€ä¸ªæ˜¯è·å–å¥½å‹ä¿¡æ¯çš„æ—¶å€™è°ƒç”¨çš„</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¦å¤–ä¸€ä¸ªæ˜¯æˆ‘ä»¬ç‚¹å‡»å¥½å‹è¿›å…¥èŠå¤©é¡µé¢æ‰€éœ€è¦çš„æ–¹æ³•"><span class="nav-number"></span> <span class="nav-text">å¦å¤–ä¸€ä¸ªæ˜¯æˆ‘ä»¬ç‚¹å‡»å¥½å‹è¿›å…¥èŠå¤©é¡µé¢æ‰€éœ€è¦çš„æ–¹æ³•.</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#void-xmppRoster-XMPPRoster-sender-didReceiveRosterItem-DDXMLElement-item"><span class="nav-number"></span> <span class="nav-text">-(void)xmppRoster:(XMPPRoster )sender didReceiveRosterItem:(DDXMLElement )item</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#è¿™ä¸ªæ˜¯XMPPRosterDelegateåè®®ä¸­ä»£ç†æ–¹æ³•-å¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šçš„å¥½å‹-è¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨å¾ˆå¤šæ¬¡-çŸ¥é“æˆ‘ä»¬çš„å¥½å‹å…¨éƒ¨éå†å®Œ-NSString-SJid-item-attributeForName-â€jidâ€-stringValue-å’ŒXMPPJID-jid-XMPPJID-jidWithString-SJid-è¿™ä¸¤ä¸ªæ–¹æ³•å°±æ˜¯å½“æˆ‘ä»¬ä»æœåŠ¡å™¨æ¥åˆ°æˆ‘ä»¬çš„æ•°æ®æ—¶å€™-æˆ‘ä»¬è¦å…ˆå°†ä»–è½¬åŒ–æˆä¸€ä¸‹-è½¬æˆæˆæˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®-ç„¶åå­˜å…¥æˆ‘ä»¬çš„æ•°æ®æºæ•°ç»„ä¸­-æ›´æ–°UI-ä½¿ç”¨çš„æ–¹æ³•æ˜¯-self-tableView-insertRowsAtIndexPaths-path-withRowAnimation-UITableViewRowAnimationBottom-ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªæ–¹æ³•å‘¢-ä¸ºä»€ä¹ˆä¸ä½¿ç”¨reloadDataè¿™ä¸ªæ–¹æ³•-å› ä¸ºè¿™ä¸ªä»£ç†æ–¹æ³•ä¼šæ‰§è¡Œå¾ˆå¤šæ¬¡-æˆ‘ä»¬ä¸ºäº†é¿å…æ²¡æœ‰å¿…è¦çš„å†…å­˜è´Ÿæ‹…-æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ›´æ–°ä¸€ä¸‹æˆ‘ä»¬æœ€åä¸€æ¡æ•°æ®å°±è¡Œ-è¿™æ ·å¤§å¤§å‡å°‘äº†å†…å­˜çš„è´Ÿæ‹…-æé«˜äº†æˆ‘ä»¬çš„å·¥ç¨‹æ•ˆç‡"><span class="nav-number"></span> <span class="nav-text">è¿™ä¸ªæ˜¯XMPPRosterDelegateåè®®ä¸­ä»£ç†æ–¹æ³•,å¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šçš„å¥½å‹,è¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨å¾ˆå¤šæ¬¡,çŸ¥é“æˆ‘ä»¬çš„å¥½å‹å…¨éƒ¨éå†å®Œ.    NSString SJid = [[item attributeForName:@â€jidâ€] stringValue];  å’ŒXMPPJID jid = [XMPPJID jidWithString:SJid];è¿™ä¸¤ä¸ªæ–¹æ³•å°±æ˜¯å½“æˆ‘ä»¬ä»æœåŠ¡å™¨æ¥åˆ°æˆ‘ä»¬çš„æ•°æ®æ—¶å€™,æˆ‘ä»¬è¦å…ˆå°†ä»–è½¬åŒ–æˆä¸€ä¸‹,è½¬æˆæˆæˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®,ç„¶åå­˜å…¥æˆ‘ä»¬çš„æ•°æ®æºæ•°ç»„ä¸­.æ›´æ–°UI ä½¿ç”¨çš„æ–¹æ³•æ˜¯[self.tableView insertRowsAtIndexPaths:@[path] withRowAnimation:UITableViewRowAnimationBottom];  ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªæ–¹æ³•å‘¢?ä¸ºä»€ä¹ˆä¸ä½¿ç”¨reloadDataè¿™ä¸ªæ–¹æ³•?å› ä¸ºè¿™ä¸ªä»£ç†æ–¹æ³•ä¼šæ‰§è¡Œå¾ˆå¤šæ¬¡,æˆ‘ä»¬ä¸ºäº†é¿å…æ²¡æœ‰å¿…è¦çš„å†…å­˜è´Ÿæ‹…,æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ›´æ–°ä¸€ä¸‹æˆ‘ä»¬æœ€åä¸€æ¡æ•°æ®å°±è¡Œ,è¿™æ ·å¤§å¤§å‡å°‘äº†å†…å­˜çš„è´Ÿæ‹…,æé«˜äº†æˆ‘ä»¬çš„å·¥ç¨‹æ•ˆç‡.</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#void-prepareForSegue-UIStoryboardSegue-segue-sender-id-sender"><span class="nav-number"></span> <span class="nav-text">-(void)prepareForSegue:(UIStoryboardSegue )segue sender:(id)sender*</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#è¿™ä¸ªæ–¹æ³•æ˜¯å› ä¸ºæˆ‘ä½¿ç”¨storyboardçš„çƒŸç˜¾-æˆ‘ä»¬ä¸ºäº†èƒ½æ­£ç¡®æ‰¾åˆ°æˆ‘ä»¬ç‚¹å‡»å¯¹åº”çš„cellæ‰€ä½¿ç”¨çš„æ–¹æ³•-ä¼ å€¼çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠJIDä¼ åˆ°èŠå¤©ç•Œé¢-è¿™æ ·æœåŠ¡å™¨å°±ä¼šæ¸…æ¥šçš„çŸ¥é“æˆ‘ä»¬æ˜¯å¯¹è°è¿›è¡ŒèŠå¤©äº†"><span class="nav-number"></span> <span class="nav-text">è¿™ä¸ªæ–¹æ³•æ˜¯å› ä¸ºæˆ‘ä½¿ç”¨storyboardçš„çƒŸç˜¾,æˆ‘ä»¬ä¸ºäº†èƒ½æ­£ç¡®æ‰¾åˆ°æˆ‘ä»¬ç‚¹å‡»å¯¹åº”çš„cellæ‰€ä½¿ç”¨çš„æ–¹æ³•.ä¼ å€¼çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠJIDä¼ åˆ°èŠå¤©ç•Œé¢,è¿™æ ·æœåŠ¡å™¨å°±ä¼šæ¸…æ¥šçš„çŸ¥é“æˆ‘ä»¬æ˜¯å¯¹è°è¿›è¡ŒèŠå¤©äº†.</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#èŠå¤©ç•Œé¢åŠŸèƒ½"><span class="nav-number"></span> <span class="nav-text">èŠå¤©ç•Œé¢åŠŸèƒ½</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å¯¹äºèŠå¤©ç•Œé¢çš„æ­å»º-æˆ‘ä»¬ä¹Ÿæ˜¯ä½¿ç”¨åˆ°UITableViewController-é€»è¾‘æ˜¯æˆ‘ä»¬éœ€è¦å¾€æœåŠ¡å™¨å‘é€æˆ‘ä»¬çš„æ¶ˆæ¯-ç„¶åæœåŠ¡å™¨åœ¨é€šè¿‡JIDå‘é€åˆ°æŒ‡å®šçš„æ¶ˆæ¯-å‘é€è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™å’Œæ¥æ”¶è€…æ¥æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™åˆ·æ–°æˆ‘ä»¬çš„UI"><span class="nav-number"></span> <span class="nav-text">å¯¹äºèŠå¤©ç•Œé¢çš„æ­å»º,æˆ‘ä»¬ä¹Ÿæ˜¯ä½¿ç”¨åˆ°UITableViewController,é€»è¾‘æ˜¯æˆ‘ä»¬éœ€è¦å¾€æœåŠ¡å™¨å‘é€æˆ‘ä»¬çš„æ¶ˆæ¯,ç„¶åæœåŠ¡å™¨åœ¨é€šè¿‡JIDå‘é€åˆ°æŒ‡å®šçš„æ¶ˆæ¯,å‘é€è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™å’Œæ¥æ”¶è€…æ¥æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™åˆ·æ–°æˆ‘ä»¬çš„UI.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#é‚£æˆ‘ä»¬å°±å…ˆçœ‹çœ‹åœ¨XMPPManagerçš„ç±»ä¸­æˆ‘ä»¬éœ€è¦åšä¸€äº›ä»€ä¹ˆäº‹æƒ…å§"><span class="nav-number"></span> <span class="nav-text">é‚£æˆ‘ä»¬å°±å…ˆçœ‹çœ‹åœ¨XMPPManagerçš„ç±»ä¸­æˆ‘ä»¬éœ€è¦åšä¸€äº›ä»€ä¹ˆäº‹æƒ…å§.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åœ¨XMPPManager-hä¸­-æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªå±æ€§-ä¸€ä¸ªæ˜¯XMPPèŠå¤©æ¶ˆæ¯æœ¬åœ°åŒ–å¤„ç†å¯¹è±¡çš„messageArchiving-å¦å¤–ä¸€ä¸ªæ˜¯æ¶ˆæ¯ä¸Šä¸‹æ–‡å¯¹è±¡messageContext"><span class="nav-number"></span> <span class="nav-text">åœ¨XMPPManager.hä¸­ æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªå±æ€§,ä¸€ä¸ªæ˜¯XMPPèŠå¤©æ¶ˆæ¯æœ¬åœ°åŒ–å¤„ç†å¯¹è±¡çš„messageArchiving,å¦å¤–ä¸€ä¸ªæ˜¯æ¶ˆæ¯ä¸Šä¸‹æ–‡å¯¹è±¡messageContext.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åœ¨XMPPManager-mä¸­-çš„initæ–¹æ³•ä¸­-æˆ‘ä»¬å¯¹è¿™ä¸¤ä¸ªå±æ€§è¿›è¡Œäº†åˆå§‹åŒ–-å¦‚ä¸‹"><span class="nav-number"></span> <span class="nav-text">åœ¨XMPPManager.mä¸­ çš„initæ–¹æ³•ä¸­,æˆ‘ä»¬å¯¹è¿™ä¸¤ä¸ªå±æ€§è¿›è¡Œäº†åˆå§‹åŒ–.å¦‚ä¸‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#messageArchivingå¯¹è±¡ä¹Ÿæ˜¯éœ€è¦æˆ‘ä»¬æ¿€æ´»é€šé“æƒé™çš„-ç„¶åè®¾ç½®äº†ä»£ç†"><span class="nav-number"></span> <span class="nav-text">messageArchivingå¯¹è±¡ä¹Ÿæ˜¯éœ€è¦æˆ‘ä»¬æ¿€æ´»é€šé“æƒé™çš„.ç„¶åè®¾ç½®äº†ä»£ç†.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åœ¨ChatTableViewController-hç•Œé¢-æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªXMPPJIDå¯¹è±¡-æ¥æ¥å—å¥½å‹åˆ—è¡¨ä¼ æ¥çš„JIDå€¼-ä»£ç å¦‚ä¸‹"><span class="nav-number"></span> <span class="nav-text">åœ¨ChatTableViewController.hç•Œé¢ æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªXMPPJIDå¯¹è±¡  æ¥æ¥å—å¥½å‹åˆ—è¡¨ä¼ æ¥çš„JIDå€¼.ä»£ç å¦‚ä¸‹.</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é¡µé¢çš„é€»è¾‘"><span class="nav-number"></span> <span class="nav-text">é¡µé¢çš„é€»è¾‘:</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å½“æˆ‘ä»¬è¿›å…¥èŠå¤©ç•Œé¢çš„æ—¶å€™-æˆ‘ä»¬ä¼šå…ˆè°ƒç”¨reloadMessageè¿™ä¸ªæ–¹æ³•-ä»æœåŠ¡å™¨ä¸‹è½½å½“å‰ç”¨æˆ·ä¸è¿™ä¸ªJIDçš„èŠå¤©è®°å½•-å½“æˆ‘ä»¬ç‚¹å‡»å‘é€æ¶ˆæ¯çš„æ—¶å€™-æˆ‘ä»¬å°±ä¼šè°ƒç”¨sendActionè¿™ä¸ªæ–¹æ³•-å‘é€åˆ°æœåŠ¡å™¨ä¸Šå»-å½“æˆ‘ä»¬å‘é€æˆåŠŸåè°ƒç”¨didSendMessageè¿™ä¸ªåè®®æ–¹æ³•-ç„¶ååœ¨è¿™åè®®æ–¹æ³•ä¸­è°ƒç”¨reloadMessageè¿™ä¸ªæ–¹æ³•é‡æ–°ä»æœåŠ¡å™¨ä¸‹è½½æ–°çš„èŠå¤©è®°å½•å¹¶ä¸”åˆ·æ–°UI-ç„¶åæœåŠ¡å™¨ä¸Šæœ‰å½“å‰ç”¨æˆ·æ–°çš„æ¶ˆæ¯çš„æ—¶å€™-å°±ä¼šè°ƒç”¨didReceiveMessageè¿™ä¸ªä»£ç†æ–¹æ³•-æˆ‘ä»¬åªéœ€è¦åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å†æ¬¡è°ƒç”¨reloadMessageæ–¹æ³•å°±å¯-PS-å› ä¸ºæˆ‘ç”¨çš„æ˜¯storyboard-æ‰€æœ‰æœ‰äº›åœ°æ–¹ä¼šæœ‰æ‰€ä¸åŒğŸ˜ƒ"><span class="nav-number"></span> <span class="nav-text">å½“æˆ‘ä»¬è¿›å…¥èŠå¤©ç•Œé¢çš„æ—¶å€™,æˆ‘ä»¬ä¼šå…ˆè°ƒç”¨reloadMessageè¿™ä¸ªæ–¹æ³•,ä»æœåŠ¡å™¨ä¸‹è½½å½“å‰ç”¨æˆ·ä¸è¿™ä¸ªJIDçš„èŠå¤©è®°å½•,å½“æˆ‘ä»¬ç‚¹å‡»å‘é€æ¶ˆæ¯çš„æ—¶å€™,æˆ‘ä»¬å°±ä¼šè°ƒç”¨sendActionè¿™ä¸ªæ–¹æ³•,å‘é€åˆ°æœåŠ¡å™¨ä¸Šå»,å½“æˆ‘ä»¬å‘é€æˆåŠŸåè°ƒç”¨didSendMessageè¿™ä¸ªåè®®æ–¹æ³•,ç„¶ååœ¨è¿™åè®®æ–¹æ³•ä¸­è°ƒç”¨reloadMessageè¿™ä¸ªæ–¹æ³•é‡æ–°ä»æœåŠ¡å™¨ä¸‹è½½æ–°çš„èŠå¤©è®°å½•å¹¶ä¸”åˆ·æ–°UI,ç„¶åæœåŠ¡å™¨ä¸Šæœ‰å½“å‰ç”¨æˆ·æ–°çš„æ¶ˆæ¯çš„æ—¶å€™,å°±ä¼šè°ƒç”¨didReceiveMessageè¿™ä¸ªä»£ç†æ–¹æ³•,æˆ‘ä»¬åªéœ€è¦åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å†æ¬¡è°ƒç”¨reloadMessageæ–¹æ³•å°±å¯.(PS:å› ä¸ºæˆ‘ç”¨çš„æ˜¯storyboard  æ‰€æœ‰æœ‰äº›åœ°æ–¹ä¼šæœ‰æ‰€ä¸åŒğŸ˜ƒ)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ–¹æ³•è§£é‡Š-1"><span class="nav-number"></span> <span class="nav-text">æ–¹æ³•è§£é‡Š:</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#void-reloadMessage"><span class="nav-number"></span> <span class="nav-text">-(void)reloadMessage</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è¿™ä¸ªæ–¹æ³•æ˜¯æ•´ä¸ªèŠå¤©ç•Œé¢çš„æ ¸å¿ƒ-æˆ‘ä»¬åœ¨è¿™é‡Œé¢åšçš„å°±æ˜¯ä»æœåŠ¡å™¨ä¸‹è½½æˆ‘ä»¬çš„æ•°æ®-å½“æˆ‘ä»¬ä¸‹è½½å®Œæ•°æ®çš„æ—¶å€™-å°±è¦æŠŠæˆ‘ä»¬æ•°æ®æºæ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ æ¸…ç©º-ç„¶åå°†æ‰€æœ‰ä»æœåŠ¡å™¨ä¸­ä¸‹è½½çš„å…ƒç´ æ·»åŠ åˆ°æˆ‘ä»¬çš„æ•°ç»„ä¸­-ç„¶ååˆ·æ–°æˆ‘ä»¬çš„UI-å½“æˆ‘ä¸€åˆ·æ–°ä¹‹åtableViewå°±ä¼šé‡å¤´å¼€å§‹äº†-æ‰€ä»¥æˆ‘ä»¬è®¾ç½®è®©æœ€åä¸€ä¸ªcellæ˜¾ç¤ºåœ¨å±å¹•ä¸Š-è¿˜æœ‰å°±æ˜¯ä¸‹é¢çš„ä¸€æ®µä»£ç -è¿™æ˜¯æˆ‘ä»¬å…ˆå‰å†™å¥½çš„-æˆ‘ä»¬éœ€è¦æ•²å‡º-fetch-å°±ä¼šç»™æˆ‘ä»¬æç¤º-æ˜¯ä¸æ˜¯å¾ˆç®€ç­”-ğŸ˜‚-è¿™æ®µä»£ç å°±æ˜¯ä»ç½‘ä¸Šä¸‹è½½æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®-å½“ç„¶äº†-æˆ‘ä»¬éœ€è¦ä½¿ç”¨è°“è¯å¯¹è¿™äº›æ•°æ®è¿›è¡Œè¿‡æ»¤-è¿‡æ»¤åçš„æ•°æ®æ‰æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®"><span class="nav-number"></span> <span class="nav-text">è¿™ä¸ªæ–¹æ³•æ˜¯æ•´ä¸ªèŠå¤©ç•Œé¢çš„æ ¸å¿ƒ.æˆ‘ä»¬åœ¨è¿™é‡Œé¢åšçš„å°±æ˜¯ä»æœåŠ¡å™¨ä¸‹è½½æˆ‘ä»¬çš„æ•°æ®.å½“æˆ‘ä»¬ä¸‹è½½å®Œæ•°æ®çš„æ—¶å€™,å°±è¦æŠŠæˆ‘ä»¬æ•°æ®æºæ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ æ¸…ç©º,ç„¶åå°†æ‰€æœ‰ä»æœåŠ¡å™¨ä¸­ä¸‹è½½çš„å…ƒç´ æ·»åŠ åˆ°æˆ‘ä»¬çš„æ•°ç»„ä¸­.ç„¶ååˆ·æ–°æˆ‘ä»¬çš„UI,å½“æˆ‘ä¸€åˆ·æ–°ä¹‹åtableViewå°±ä¼šé‡å¤´å¼€å§‹äº†,æ‰€ä»¥æˆ‘ä»¬è®¾ç½®è®©æœ€åä¸€ä¸ªcellæ˜¾ç¤ºåœ¨å±å¹•ä¸Š.è¿˜æœ‰å°±æ˜¯ä¸‹é¢çš„ä¸€æ®µä»£ç ,è¿™æ˜¯æˆ‘ä»¬å…ˆå‰å†™å¥½çš„,æˆ‘ä»¬éœ€è¦æ•²å‡º  fetch   å°±ä¼šç»™æˆ‘ä»¬æç¤º,æ˜¯ä¸æ˜¯å¾ˆç®€ç­”?ğŸ˜‚ è¿™æ®µä»£ç å°±æ˜¯ä»ç½‘ä¸Šä¸‹è½½æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®.å½“ç„¶äº†,æˆ‘ä»¬éœ€è¦ä½¿ç”¨è°“è¯å¯¹è¿™äº›æ•°æ®è¿›è¡Œè¿‡æ»¤.è¿‡æ»¤åçš„æ•°æ®æ‰æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XMPPåè®®å®ç°å³æ—¶é€šè®¯çš„è¿‡ç¨‹å¤§ä½“å°±æ˜¯è¿™æ ·äº†-å½“ç„¶äº†-æˆ‘è¿˜æœ‰ä¸€äº›åŠŸèƒ½æ²¡æœ‰å®Œå–„-æ¯”å¦‚æ·»åŠ å¥½å‹çš„åŠŸèƒ½-è¿™å°†åœ¨åæœŸè¿›è¡Œå†æ¬¡çš„å®Œå–„-è°¢è°¢å¤§å®¶çš„æŸ¥çœ‹"><span class="nav-number"></span> <span class="nav-text">XMPPåè®®å®ç°å³æ—¶é€šè®¯çš„è¿‡ç¨‹å¤§ä½“å°±æ˜¯è¿™æ ·äº†,å½“ç„¶äº†,æˆ‘è¿˜æœ‰ä¸€äº›åŠŸèƒ½æ²¡æœ‰å®Œå–„,æ¯”å¦‚æ·»åŠ å¥½å‹çš„åŠŸèƒ½.è¿™å°†åœ¨åæœŸè¿›è¡Œå†æ¬¡çš„å®Œå–„.è°¢è°¢å¤§å®¶çš„æŸ¥çœ‹..</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#â€”-gt-XMPPçš„Demoèµ„æºä¸‹è½½"><span class="nav-number"></span> <span class="nav-text">â€”>XMPPçš„Demoèµ„æºä¸‹è½½ </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#åœ¨Demoæ‹¿åˆ°æ‰‹çš„æ—¶å€™-æˆ‘ä»¬é¦–å…ˆè¦å¯¹æˆ‘ä»¬çš„æœåŠ¡å™¨IPè¿›è¡Œè®¾ç½®-åœ¨XMPPConfig-hæ–‡ä»¶ä¸­è®¾ç½®æœåŠ¡å™¨ç›¸å…³ä¿¡æ¯"><span class="nav-number"></span> <span class="nav-text">åœ¨Demoæ‹¿åˆ°æ‰‹çš„æ—¶å€™,æˆ‘ä»¬é¦–å…ˆè¦å¯¹æˆ‘ä»¬çš„æœåŠ¡å™¨IPè¿›è¡Œè®¾ç½®.åœ¨XMPPConfig.hæ–‡ä»¶ä¸­è®¾ç½®æœåŠ¡å™¨ç›¸å…³ä¿¡æ¯!!!</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¦‚æœæœ‰æœ‰ä»€ä¹ˆç–‘é—®-å¯ä»¥å›å¤-è°¢è°¢å¤§å®¶"><span class="nav-number"></span> <span class="nav-text">å¦‚æœæœ‰æœ‰ä»€ä¹ˆç–‘é—®,å¯ä»¥å›å¤,è°¢è°¢å¤§å®¶</span></a></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ç¥ç»éªšæ ‹</span>
</div>

<div class="powered-by">
  ç”± <a class="theme-link" href="http://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.scheme !== 'Pisces' && (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always')) {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  



  



  
  
  

  


</body>
</html>
